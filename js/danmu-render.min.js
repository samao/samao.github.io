!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("DanmuRender",[],t):"object"==typeof exports?exports.DanmuRender=t():e.DanmuRender=t()}(this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=9)}([function(e,t,n){"use strict";var r,o="object"==typeof Reflect?Reflect:null,i=o&&"function"==typeof o.apply?o.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function u(){u.init.call(this)}e.exports=u,u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var c=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function f(e){return void 0===e._maxListeners?u.defaultMaxListeners:e._maxListeners}function l(e,t,n,r){var o,i,a,u;if(s(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),a=i[t]),void 0===a)a=i[t]=n,++e._eventsCount;else if("function"==typeof a?a=i[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(o=f(e))>0&&a.length>o&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,u=c,console&&console.warn&&console.warn(u)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=h.bind(r);return o.listener=n,r.wrapFn=o,o}function p(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):v(o,o.length)}function y(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},u.prototype.getMaxListeners=function(){return f(this)},u.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var u=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw u.context=a,u}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var s=c.length,f=v(c,s);for(n=0;n<s;++n)i(f[n],this,t)}return!0},u.prototype.addListener=function(e,t){return l(this,e,t,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(e,t){return l(this,e,t,!0)},u.prototype.once=function(e,t){return s(t),this.on(e,d(this,e,t)),this},u.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,d(this,e,t)),this},u.prototype.removeListener=function(e,t){var n,r,o,i,a;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){a=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},u.prototype.listeners=function(e){return p(this,e,!0)},u.prototype.rawListeners=function(e){return p(this,e,!1)},u.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):y.call(e,t)},u.prototype.listenerCount=y,u.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";t.css=n(2),t.cx=n(3)},function(e,t,n){"use strict";e.exports=function(){throw new Error('Using the "css" tag in runtime is not supported. Make sure you have set up the Babel plugin correctly.')}},function(e,t,n){"use strict";e.exports=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")}},function(e,t,n){var r=n(5);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(7)(r,o);r.locals&&(e.exports=r.locals)},function(e,t,n){(t=n(6)(!1)).push([e.i,".c13la550{width:100px;height:36px;background-size:100% 100%;vertical-align:middle;display:inline-block;}\n.c12t5uoo{position:absolute;top:50%;padding:0 30px;color:#fff;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);}\n.cvyzygh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}\n.c1482y8w{background-size:100% 100%;line-height:36px;vertical-align:middle;display:inline-block;font-style:normal;-webkit-flex:auto;-ms-flex:auto;flex:auto;}\n.c1hkwb6p{background-size:100% 100%;width:84px;height:36px;vertical-align:middle;display:inline-block;}\n.cdz9rme{width:100%;height:100%;overflow:hidden !important;}\n.f80gt5q{-webkit-filter:drop-shadow(1px 1px #000);filter:drop-shadow(1px 1px #000);}\n.l1quo010{line-height:40px;}\n.i1tddzzr{will-change:transform;visibility:unset !important;}\n.absfnwn{position:absolute;}\n.t1ki4615{-webkit-filter:drop-shadow(1px 1px #fff9);filter:drop-shadow(1px 1px #fff9);}\n.d1kl3pta{position:absolute;box-sizing:border-box;text-align:start;white-space:nowrap;-moz-user-select:none;-o-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-ms-user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-perspective:500px;-moz-perspective:500px;-ms-perspective:500px;perspective:500px;padding:1px 0;font-family:-apple-system,Microsoft Yahei,SimHei,Helvetica Neue,Helvetica,Arial,Hiragino Sans GB,Heiti SC,WenQuanYi Micro Hei,sans-serif;pointer-events:none;visibility:hidden;}\n.d1hd3vq3{border:2px solid white;}\n",""]),t.locals={c13la550:"c13la550",c12t5uoo:"c12t5uoo",cvyzygh:"cvyzygh",c1482y8w:"c1482y8w",c1hkwb6p:"c1hkwb6p",cdz9rme:"cdz9rme",f80gt5q:"f80gt5q",l1quo010:"l1quo010",i1tddzzr:"i1tddzzr",absfnwn:"absfnwn",t1ki4615:"t1ki4615",d1kl3pta:"d1kl3pta",d1hd3vq3:"d1hd3vq3"},e.exports=t},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var o=(a=r,u=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(u),"/*# ".concat(c," */")),i=r.sources.map((function(e){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(e," */")}));return[n].concat(i).concat([o]).join("\n")}var a,u,c;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var o={};if(r)for(var i=0;i<this.length;i++){var a=this[i][0];null!=a&&(o[a]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);r&&o[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},function(e,t,n){var r,o,i={},a=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=r.apply(this,arguments)),o}),u=function(e,t){return t?t.querySelector(e):document.querySelector(e)},c=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var r=u.call(this,e,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),s=null,f=0,l=[],h=n(8);function d(e,t){for(var n=0;n<e.length;n++){var r=e[n],o=i[r.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](r.parts[a]);for(;a<r.parts.length;a++)o.parts.push(g(r.parts[a],t))}else{var u=[];for(a=0;a<r.parts.length;a++)u.push(g(r.parts[a],t));i[r.id]={id:r.id,refs:1,parts:u}}}}function p(e,t){for(var n=[],r={},o=0;o<e.length;o++){var i=e[o],a=t.base?i[0]+t.base:i[0],u={css:i[1],media:i[2],sourceMap:i[3]};r[a]?r[a].parts.push(u):n.push(r[a]={id:a,parts:[u]})}return n}function y(e,t){var n=c(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=l[l.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),l.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=c(e.insertAt.before,n);n.insertBefore(t,o)}}function v(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=l.indexOf(e);t>=0&&l.splice(t,1)}function m(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=function(){0;return n.nc}();r&&(e.attrs.nonce=r)}return b(t,e.attrs),y(e,t),t}function b(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function g(e,t){var n,r,o,i;if(t.transform&&e.css){if(!(i="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=i}if(t.singleton){var a=f++;n=s||(s=m(t)),r=O.bind(null,n,a,!1),o=O.bind(null,n,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",b(t,e.attrs),y(e,t),t}(t),r=E.bind(null,n,t),o=function(){v(n),n.href&&URL.revokeObjectURL(n.href)}):(n=m(t),r=k.bind(null,n),o=function(){v(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=a()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=p(e,t);return d(n,t),function(e){for(var r=[],o=0;o<n.length;o++){var a=n[o];(u=i[a.id]).refs--,r.push(u)}e&&d(p(e,t),t);for(o=0;o<r.length;o++){var u;if(0===(u=r[o]).refs){for(var c=0;c<u.parts.length;c++)u.parts[c]();delete i[u.id]}}}};var w,_=(w=[],function(e,t){return w[e]=t,w.filter(Boolean).join("\n")});function O(e,t,n,r){var o=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=_(t,o);else{var i=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(i,a[t]):e.appendChild(i)}}function k(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function E(e,t,n){var r=n.css,o=n.sourceMap,i=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||i)&&(r=h(r)),o&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([r],{type:"text/css"}),u=e.href;e.href=URL.createObjectURL(a),u&&URL.revokeObjectURL(u)}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var o,i=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?e:(o=0===i.indexOf("//")?i:0===i.indexOf("/")?n+i:r+i.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return St}));var r=n(0);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];u(this,e),this.islive=t,this.danmuMap=[],this.renderMap=new Map,this.danmuSet=new Set,this.IGNORE_SEEK_SECONDS=2,this.lastTime=-1,this._locked=!1,this._blockedConfig={top:!1,bottom:!1,move:!1,color:!1}}var t,n,r;return t=e,(n=[{key:"updateTime",value:function(e){var t=this;if(this.islive)return this.danmuMap.forEach((function(e){t.renderFilter(e)})),void(this.danmuMap.length=0);var n=e-this.lastTime;this.lastTime=e,n<=0||n>this.IGNORE_SEEK_SECONDS||this.danmuMap.forEach((function(r){var o=e-r.time;t.renderFilter(r,(function(){return o>=0&&o<=n&&!r.blocked}))}))}},{key:"add",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._locked||!this.islive){var r=Array.isArray(e)?e:[e];r.forEach((function(e){t.danmuSet.has(e.id)||(t.danmuSet.add(e.id),t.danmuMap.push(e),n&&t.renderFilter(e))}))}}},{key:"removeFromRendered",value:function(e){var t=this;e.forEach((function(e){t.renderMap.has(e.id)&&t.renderMap.delete(e.id)}))}},{key:"removeAllRendered",value:function(){this.renderMap.clear(),this.islive&&(this.danmuMap.length=0)}},{key:"clear",value:function(){this.danmuMap.length=0,this.renderMap.clear()}},{key:"renderFilter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};this.renderVaild(e)&&t()&&(e.renderInit=Date.now(),this.renderMap.set(e.id,e))}},{key:"renderVaild",value:function(e){return!e.blocked&&!this._blockedConfig[e.mode]&&!this.renderMap.has(e.id)}},{key:"blockedType",set:function(e){var t=this;this._blockedConfig=i(i({},this._blockedConfig),"boolean"==typeof e?{top:e,move:e,bottom:e}:e),this.danmuMap.forEach((function(e){e.blocked=t._blockedConfig[e.mode]}))}},{key:"locked",set:function(e){this._locked=e}},{key:"current",get:function(){return this.renderMap}}])&&c(t.prototype,n),r&&c(t,r),e}();function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y(e);if(t){var o=y(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p(this,n)}}function p(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(n,e);var t=d(n);function n(){var e;return l(this,n),(e=t.apply(this,arguments))._playing=!1,e}return n}(r.EventEmitter);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=k(e);if(t){var o=k(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return O(this,n)}}function O(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(i,e);var t,n,r,o=_(i);function i(){var e;return b(this,i),(e=o.apply(this,arguments)).destroy=function(){e.detach()},e.pause=function(){e._playing=!1},e.resume=function(){e._playing=!0},e.timeupdate=function(){e._playing&&e.emit("timeUpdate",e._media.currentTime)},e}return t=i,(n=[{key:"attach",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._media=e,this.addMediaListeners(),this._playing=t}},{key:"detach",value:function(){this.removeMediaListeners(),this._media=null}},{key:"addMediaListeners",value:function(){this._media.addEventListener("timeupdate",this.timeupdate)}},{key:"removeMediaListeners",value:function(){this._media.removeEventListener("timeupdate",this.timeupdate)}}])&&g(t.prototype,n),r&&g(t,r),i}(v);function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=A(e);if(t){var o=A(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return P(this,n)}}function P(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var L,I=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(i,e);var t,n,r,o=R(i);function i(){var e;return S(this,i),(e=o.apply(this,arguments)).INTERVAL=300,e._attachTime=0,e.destroy=function(){e.detach()},e.pause=function(){e._playing=!1},e.resume=function(){e._playing=!0},e.timeupdate=function(){e._playing&&e.emit("timeUpdate",(Date.now()-e._attachTime)/1e3)},e}return t=i,(n=[{key:"attach",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._playing=t,this._attachTime=Date.now(),this._timerTask=setInterval(this.timeupdate,this.INTERVAL)}},{key:"detach",value:function(){clearInterval(this._timerTask),this._timerTask=null}}])&&j(t.prototype,n),r&&j(t,r),i}(v);function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.ATTACH="attach",e.DETACH="detach",e.PAUSE="pause",e.RESUME="resume",e.DESTROY="destroy",e.TIME_UPDATE="timeUpdate"}(L||(L={}));var D=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"live";M(this,e),this.type=t,this._playing=!1,this._destroyed=!1,this.createTypedRunner(),this.fire=this._runner.emit.bind(this),this.on=this._runner.on.bind(this),this.once=this._runner.once.bind(this),this.off=this._runner.off.bind(this)}var t,n,r;return t=e,(n=[{key:"attach",value:function(e){this._runner.attach(e),this._playing=!0,this.fire(L.ATTACH,e)}},{key:"detach",value:function(){this._runner.detach(),this.fire(L.DETACH)}},{key:"pause",value:function(){!this._destroyed&&this._playing&&(this._runner.pause(),this._playing=!1,this.fire(L.PAUSE,this._playing))}},{key:"resume",value:function(){this._destroyed||this._playing||(this._runner.resume(),this._playing=!0,this.fire(L.RESUME,this._playing))}},{key:"toggle",value:function(){this._destroyed||(this._playing?(this._runner.pause(),this.fire(L.PAUSE,!1)):(this._runner.resume(),this.fire(L.RESUME,!0)),this._playing=!this._playing)}},{key:"destroy",value:function(){this._runner.removeAllListeners(),this._runner.destroy(),this._playing=!1,this._destroyed=!0,this.fire(L.DESTROY)}},{key:"createTypedRunner",value:function(){var e=this;"vod"===this.type?this._runner=new E:this._runner=new I,this._runner.on("timeUpdate",(function(t){e.fire(L.TIME_UPDATE,t)}))}},{key:"playing",get:function(){return this._playing}}])&&C(t.prototype,n),r&&C(t,r),e}();function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=B(e);if(t){var o=B(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return G(this,n)}}function G(e,t){return!t||"object"!==H(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(i,e);var t,n,r,o=F(i);function i(){return z(this,i),o.apply(this,arguments)}return t=i,(n=[{key:"destroy",value:function(){this._container.innerHTML=""}}])&&U(t.prototype,n),r&&U(t,r),i}(r.EventEmitter),V={random:function(){return Number(crypto.getRandomValues(new Uint8Array(1)))/254},randomInt:function(e){return this.floor(this.random()*e)},ceil:function(e){return Math.ceil(e)},floor:function(e){return Math.floor(e)}},Y=(n(1),"-apple-system, Microsoft Yahei, SimHei, Helvetica Neue, Helvetica, Arial, \nHiragino Sans GB, Heiti SC, WenQuanYi Micro Hei,sans-serif");function $(e){return($="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Z(e);if(t){var o=Z(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return X(this,n)}}function X(e,t){return!t||"object"!==$(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n(4);var ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(i,e);var t,n,r,o=Q(i);function i(){return W(this,i),o.apply(this,arguments)}return t=i,(n=[{key:"attach",value:function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1],this._container=e,e.classList.remove("f80gt5q"),this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.classList.add("absfnwn"),this._ctx=this._canvas.getContext("2d")),this._container.append(this._canvas),this.alignCanvas()}},{key:"detach",value:function(){this._canvas&&this._canvas.remove()}},{key:"drawDanmus",value:function(e){var t=this;e.forEach((function(e,n){t.renderAt(n,e)}))}},{key:"reset",value:function(){!this.alignCanvas()&&this._ctx&&(/Firefox/gi.test(navigator.userAgent)?this._canvas.width=this._canvas.width:this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height))}},{key:"clearRendered",value:function(){this._ctx&&this._canvas&&this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)}},{key:"renderAt",value:function(e,t){this._ctx&&e.render&&this._ctx.drawImage(e.render,t.point.x,t.point.y)}},{key:"alignCanvas",value:function(){if(this._container){var e=V.floor(this._container.clientWidth),t=V.floor(this._container.clientHeight);if(this._canvas.width!==e||this._canvas.height!==t)return this._canvas.width=e,this._canvas.height=t,!0}return!1}}])&&K(t.prototype,n),r&&K(t,r),i}(q),te=new Map,ne=new Set;function re(e){return te.has(e)?Promise.resolve(te.get(e)):ne.has(e)?function(e){return new Promise((function(t){var n=setInterval((function(){te.has(e)&&(clearInterval(n),t(te.get(e)))}),1e3)}))}(e):(ne.add(e),fetch(e).then((function(e){return e.blob()})).then((function(e){return URL.createObjectURL(e)})).catch((function(){return e})).then((function(t){return ne.delete(e),te.set(e,t),t})))}function oe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ie(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ue(e){return[14,20,26].reduce((function(t,n){var r=e-n;return r>0&&r<t.distance?{distance:Math.abs(n-e),size:n}:t}),{distance:Number.MAX_VALUE,size:e}).size}var ce=function(e){return e.message.length>35?e.message.substr(0,35)+"...":e.message};function se(e,t){return new Promise((function(n){e.onload=function(){n(),e.onload=null},e.src=t}))}var fe=function(e){return e.toString(16).padStart(6,"000000")},le=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._canvasPool=[]}var t,n,r;return t=e,(n=[{key:"create",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._htmlLine||this.createMeasureSpan();var r=(t=this._canvasPool.length>0?this._canvasPool.shift():document.createElement("canvas")).getContext("2d");if(r){var o,i=ce(e),a=this.calc((e.background?"".concat(null===(o=e.from)||void 0===o?void 0:o.n,":"):"")+i,{ctx:r,fontSize:"".concat(ue(e.size),"px"),textBaseline:"middle",textAlign:"start",border:n});this.drawDanmu(i,n,{canvas:t,ctx:r,bounds:a,danmu:e}),e.render=t}}},{key:"draw",value:function(e,t,n,r){var o=n.canvas,i=n.ctx,a=n.danmu,u=n.bounds;if(r){var c=u.width+30+30>r.head.width+r.tail.width;o.width=c?u.width+30+30:u.width,o.height=r.body.height,i.clearRect(0,0,o.width,o.height),i.drawImage(r.head,0,0),c&&i.drawImage(r.body,0,0,r.body.width,r.body.height,r.head.width,0,u.width,r.body.height),i.clearRect(30+u.width,0,30,r.tail.height),i.drawImage(r.tail,0,0,r.tail.width,r.tail.height,30+u.width,0,30,r.tail.height)}else o.width=u.width,o.height=u.height,i.clearRect(0,0,o.width,o.height);i.font="".concat(ue(a.size),"px ").concat(Y),i.fillStyle="#".concat(a.background?"FFFFFF":fe(a.color));var s,f,l=0===a.color?"#fff9":"#000";(/Safari/gi.test(navigator.userAgent)?(i.shadowColor=l,i.shadowBlur=0,i.shadowOffsetX=i.shadowOffsetY=1):i.filter="drop-shadow(1px 1px ".concat(l,")"),i.textBaseline="middle",i.textAlign="start",r)?i.fillText("".concat(null!==(s=null==a||null===(f=a.from)||void 0===f?void 0:f.n)&&void 0!==s?s:"",": ").concat(e),30,V.floor(.56*o.height)):(i.fillText(e,t?1:0,V.floor(.56*u.height)+(t?1:0)),t&&(i.strokeStyle="white",i.lineWidth=2,i.strokeRect(1,1,u.width-2,u.height-2)))}},{key:"drawDanmu",value:function(e,t,n){var r,o=this,i=n.canvas,a=n.ctx,u=n.bounds,c=n.danmu;if(c.background){var s=document.createElement("img"),f=document.createElement("img"),l=document.createElement("img"),h=c.background,d=h.headImg,p=h.bodyImg,y=h.tailImg;i.width=30+u.width+30,i.height=u.height,(r=[d,p,y],Promise.all(r.map((function(e){return re(e)})))).then((function(n){var r=oe(n,3),h=r[0],d=r[1],p=r[2];c.background={headImg:h,bodyImg:d,tailImg:p,loaded:!0},Promise.all([se(s,h),se(f,d),se(l,p)]).then((function(){o.draw(e,t,{canvas:i,ctx:a,bounds:u,danmu:c},{head:s,body:f,tail:l})})).catch(console.warn)}))}else this.draw(e,t,{canvas:i,ctx:a,bounds:u,danmu:c})}},{key:"recyle",value:function(e){e.render&&(this._canvasPool.push(e.render),delete e.render)}},{key:"calc",value:function(e,t){var n=t.ctx,r=t.fontSize,o=t.textBaseline,i=t.textAlign,a=t.border,u=void 0!==a&&a;this._htmlLine.innerText=e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),this._htmlLine.style.fontSize=r,u?this._htmlLine.classList.add("d1hd3vq3"):this._htmlLine.classList.remove("d1hd3vq3"),document.body.appendChild(this._htmlLine);var c=this._htmlLine.getBoundingClientRect(),s=c.width,f=c.height;this._htmlLine.remove(),n.font="".concat(r," ").concat(Y),n.textBaseline=o,n.textAlign=i;var l=n.measureText(e);return{width:Math.max(l.width,s),height:Math.min(40,f)}}},{key:"createMeasureSpan",value:function(){this._htmlLine=document.createElement("span"),this._htmlLine.classList.add("d1kl3pta","f80gt5q")}}])&&ae(t.prototype,n),r&&ae(t,r),e}());function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function de(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ye(e,t){return(ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=be(e);if(t){var o=be(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return me(this,n)}}function me(e,t){return!t||"object"!==he(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function be(e){return(be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ge,we=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ye(e,t)}(i,e);var t,n,r,o=ve(i);function i(){var e;return de(this,i),(e=o.apply(this,arguments)).normalPool=[],e.colorPool=[],e.itemsRender=new Map,e}return t=i,(n=[{key:"attach",value:function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1],this._container=e,e.classList.add("f80gt5q","l1quo010"),this.fragment=document.createDocumentFragment()}},{key:"detach",value:function(){}},{key:"drawDanmus",value:function(e){var t,n=this;e.forEach((function(e,r){if(t=null,n.itemsRender.has(e)){var o=n.itemsRender.get(e);t=o instanceof HTMLSpanElement?o:o.main}else if(r.background){if(r.background.loaded){var i,a,u=n.getColorElement();u.head.style.backgroundImage="url(".concat(r.background.headImg,")"),u.body.style.cssText="background-image: url(".concat(r.background.bodyImg,");"),u.tail.style.backgroundImage="url(".concat(r.background.tailImg,")"),u.text.style.cssText="font-size: ".concat(ue(r.size),"px;"),u.text.innerText="".concat(null===(i=r.from)||void 0===i?void 0:i.n,": ").concat(r.message),u.main.style.width="".concat(null===(a=r.render)||void 0===a?void 0:a.width,"px"),t=u.main,n.fragment.appendChild(t),n.itemsRender.set(e,u)}}else(t=n.getNormalElement()).classList.add("i1tddzzr"),t.style.color="#".concat(fe(r.color)),t.style.fontSize="".concat(ue(r.size),"px"),0===r.color&&t.classList.add("t1ki4615"),t.innerText=r.message,n.fragment.appendChild(t),n.itemsRender.set(e,t);t&&(t.style.transform="translate3d(".concat(Math.round(e.point.x),"px, ").concat(Math.round(e.point.y),"px, 0px)"))})),this._container.appendChild(this.fragment)}},{key:"clearRendered",value:function(){this._container.innerHTML=""}},{key:"reset",value:function(){var e=this;this.itemsRender.forEach((function(t,n){n.needRemove&&(t instanceof HTMLSpanElement?(e.normalPool.push(t),t.classList.remove("i1tddzzr","t1ki4615")):e.colorPool.push(t),e.itemsRender.delete(n))}))}},{key:"getNormalElement",value:function(){var e;return 0===this.normalPool.length?(e=document.createElement("span")).classList.add("d1kl3pta"):e=this.normalPool.shift(),e}},{key:"getColorElement",value:function(){if(0===this.colorPool.length){var e=document.createElement("i"),t=document.createElement("i"),n=document.createElement("i");e.classList.add("c13la550"),t.classList.add("c1482y8w"),n.classList.add("c1hkwb6p");var r=document.createElement("div");r.classList.add("cvyzygh"),r.append(e,t,n);var o=document.createElement("div");o.classList.add("d1kl3pta","i1tddzzr");var i=document.createElement("span");return i.classList.add("c12t5uoo"),o.append(r,i),{head:e,body:t,tail:n,bg:r,main:o,text:i}}return this.colorPool.shift()}}])&&pe(t.prototype,n),r&&pe(t,r),i}(q);function _e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.ATTACH="attach",e.DETACH="detach"}(ge||(ge={}));var ke=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"canvas";_e(this,e),this.type=t,this.createTypedRender(),this.fire=this._render.emit.bind(this),this.on=this._render.on.bind(this),this.once=this._render.once.bind(this),this.off=this._render.off.bind(this)}var t,n,r;return t=e,(n=[{key:"drawDanmus",value:function(e){this._render.drawDanmus(e)}},{key:"reset",value:function(){this._render.reset()}},{key:"attach",value:function(e){this._render.attach(e),e.classList.add("cdz9rme"),this.fire(ge.ATTACH,e)}},{key:"detach",value:function(){this._render.detach(),this.fire(ge.DETACH)}},{key:"destroy",value:function(){this._render.destroy()}},{key:"clearRendered",value:function(){this._render.clearRendered()}},{key:"createTypedRender",value:function(){"css"===this.type?this._render=new we:this._render=new ee}}])&&Oe(t.prototype,n),r&&Oe(t,r),e}();function Ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||Se(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xe(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Se(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function Se(e,t){if(e){if("string"==typeof e)return je(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?je(e,t):void 0}}function je(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Re=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lineMap=new Map,this._maxLineInViewPort=0,this.LINE_HEIGHT=40,this.rendered=new Map,this._size={width:0,height:0},this.prepareInit()}var t,n,r;return t=e,(n=[{key:"findNodeUnderPoint",value:function(e){var t,n=this.getIndexByYpos(e.y),r=xe(Array.from(this.rendered).reverse());try{for(r.s();!(t=r.n()).done;){var o=Ee(t.value,2),i=o[0],a=o[1];if(a.lineIndex===n){var u=e.x-a.point.x;if(u>0&&u<a.size.width)return i}}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"getNode",value:function(e){return this.rendered.get(e)}},{key:"measure",value:function(e){return e.render?{width:e.render.width,height:e.render.height}:{width:0,height:0}}},{key:"remove",value:function(e){if(!this.rendered.has(e))return!1;this.rendered.delete(e);var t,n=xe(this.lineMap);try{for(n.s();!(t=n.n()).done;){var r=Ee(t.value,2),o=r[0],i=r[1];if("EMPTY"!==i&&i.danmuVo===e)return this.lineMap.set(o,"EMPTY"),!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"clear",value:function(){var e=this;this.rendered.clear(),this.lineMap.forEach((function(t,n){return e.lineMap.set(n,"EMPTY")}))}},{key:"prepareInit",value:function(){for(var e=0;e<80;++e)this.lineMap.set(e,"EMPTY")}},{key:"getIndexByYpos",value:function(e){return V.floor(e/this.LINE_HEIGHT)}},{key:"size",set:function(e){var t=e.height,n=e.width;this._size.width=n,this._size.height=t,this._maxLineInViewPort=V.floor(t/this.LINE_HEIGHT)}},{key:"width",get:function(){return this._size.width}},{key:"height",get:function(){return this._size.height}}])&&Te(t.prototype,n),r&&Te(t,r),e}();function Pe(e){return(Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ae(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Le(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ce(e,t,n){return(Ce="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ue(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function De(e,t){return(De=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function He(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ue(e);if(t){var o=Ue(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ze(this,n)}}function ze(e,t){return!t||"object"!==Pe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ue(e){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ne=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&De(e,t)}(i,e);var t,n,r,o=He(i);function i(){var e;return Ie(this,i),(e=o.apply(this,arguments)).duration=4e3,e}return t=i,(n=[{key:"update",value:function(e){for(var t=this.rendered.values();;){var n=t.next(),r=n.done,o=n.value;if(r)break;o.established+=e;var i=this.measure(o.danmuVo);o.point.x=V.floor((this.width-i.width)/2),o.point.y=V.floor(this.height-(o.lineIndex+1)*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-i.height)),o.needRemove=o.established>=this.duration}}},{key:"flush",value:function(){this.update(0)}},{key:"add",value:function(e){if(this.rendered.has(e))return!1;var t=this.getFreeline(),n=this.measure(e),r=Date.now()-(e.renderInit||Date.now()),o={point:{x:V.floor((this.width-n.width)/2),y:V.floor(this.height-(t+1)*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-n.height))},size:n,established:r,speed:6,danmuVo:e,lineIndex:t,needRemove:r>=this.duration};return!o.needRemove&&(this.rendered.set(e,o),this.lineMap.set(t,o),!0)}},{key:"getFreeline",value:function(){for(var e=this.lineMap.entries();;){var t=e.next(),n=t.done,r=Ae(t.value,2),o=r[0],i=r[1];if(n||o>=this._maxLineInViewPort)break;if("EMPTY"===i)return o}return V.randomInt(this._maxLineInViewPort)}},{key:"getIndexByYpos",value:function(e){return Ce(Ue(i.prototype),"getIndexByYpos",this).call(this,this.height-e)}}])&&Me(t.prototype,n),r&&Me(t,r),i}(Re);function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Be(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ye(e,t){return(Ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $e(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ke(e);if(t){var o=Ke(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return We(this,n)}}function We(e,t){return!t||"object"!==Fe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ke(e){return(Ke=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Je=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ye(e,t)}(i,e);var t,n,r,o=$e(i);function i(){var e;return qe(this,i),(e=o.apply(this,arguments)).SPEED=100,e.STEP=10,e.GAP=30,e}return t=i,(n=[{key:"getFreeline",value:function(e){for(var t=this.lineMap.entries();;){var n=t.next(),r=n.done,o=n.value;if(r)break;var i=Ge(o,2),a=i[0],u=i[1];if(a>=this._maxLineInViewPort)break;if("EMPTY"===u)return a;if(V.floor(this.width-e*(this.SPEED+this.STEP*a)/1e3)-(u.point.x+u.size.width)>this.GAP)return a}return V.randomInt(this._maxLineInViewPort)}},{key:"update",value:function(e){for(var t=this.rendered.values();;){var n=t.next(),r=n.done,o=n.value;if(r)break;o.established+=e,o.point.x=V.floor(this.width-o.established*o.speed/1e3),o.needRemove=o.point.x<-o.size.width}}},{key:"flush",value:function(){this.update(0)}},{key:"add",value:function(e){if(this.rendered.has(e))return!1;var t=Date.now()-(e.renderInit||Date.now()),n=this.getFreeline(t),r=this.SPEED+this.STEP*(n%3),o={x:V.floor(this.width-t*r/1e3),y:n*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-e.size)},i={width:e.render?e.render.width:0,height:e.size},a={point:o,size:i,established:t,speed:r,danmuVo:e,lineIndex:n,needRemove:o.x<-i.width};return!a.needRemove&&(this.rendered.set(e,a),this.lineMap.set(n,a),!0)}}])&&Ve(t.prototype,n),r&&Ve(t,r),i}(Re);function Qe(e){return(Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ze(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ze(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function et(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nt(e,t){return(nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function rt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=it(e);if(t){var o=it(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ot(this,n)}}function ot(e,t){return!t||"object"!==Qe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function it(e){return(it=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var at,ut=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nt(e,t)}(i,e);var t,n,r,o=rt(i);function i(){var e;return et(this,i),(e=o.apply(this,arguments)).duration=4e3,e}return t=i,(n=[{key:"update",value:function(e){for(var t=this.rendered.values();;){var n=t.next(),r=n.done,o=n.value;if(r)break;o.established+=e;var i=this.measure(o.danmuVo);o.point.x=V.floor((this.width-i.width)/2),o.point.y=V.floor(o.lineIndex*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-i.height)),o.needRemove=o.established>=this.duration}}},{key:"flush",value:function(){this.update(0)}},{key:"add",value:function(e){if(this.rendered.has(e))return!1;var t=this.getFreeline(),n=this.measure(e),r=Date.now()-(e.renderInit||Date.now()),o={point:{x:V.floor((this.width-n.width)/2),y:V.floor(t*this.LINE_HEIGHT+V.floor(this.LINE_HEIGHT-n.height))},size:n,established:r,speed:6,danmuVo:e,lineIndex:t,needRemove:r>=this.duration};return!o.needRemove&&(this.rendered.set(e,o),this.lineMap.set(t,o),!0)}},{key:"getFreeline",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var e=this.lineMap.entries();;){var t=e.next(),n=t.done,r=Xe(t.value,2),o=r[0],i=r[1];if(n||o>=this._maxLineInViewPort)break;if("EMPTY"===i)return o}return V.randomInt(this._maxLineInViewPort)}}])&&tt(t.prototype,n),r&&tt(t,r),i}(Re),ct=requestAnimationFrame||webkitRequestAnimationFrame||mozRequestAnimationFrame||oRequestAnimationFrame||msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)},st=cancelAnimationFrame||webkitCancelAnimationFrame||mozCancelAnimationFrame||msCancelAnimationFrame||oCancelAnimationFrame||function(e){clearTimeout(e)},ft={raf:ct.bind(window),caf:st.bind(window)};function lt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||ht(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ht(e,t){if(e){if("string"==typeof e)return dt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dt(e,t):void 0}}function dt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.BOTTOM="bottom",e.TOP="top",e.MOVE="move",e.COLOR="color"}(at||(at={}));var yt=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.controlers=new Map,this.preTime=-1,this._pausedGap=0,this._paused=!1,this._destroyed=!1,this._size={width:0,height:0},this.update=function(){if(!t._paused&&!t._destroyed){var e=Date.now();t.controlers.forEach((function(n){n.update(e-t.preTime-t._pausedGap)})),t._pausedGap=0,t.preTime=e,t.rafid=ft.raf(t.update)}},this.createControler()}var t,n,r;return t=e,(n=[{key:"addToControler",value:function(e){this.controlers.has(e.mode)&&this.controlers.get(e.mode).add(e)}},{key:"getNode",value:function(e){if(this.controlers.has(e.mode))return this.controlers.get(e.mode).getNode(e)}},{key:"remvoeFromControler",value:function(e){this.controlers.has(e.mode)&&this.controlers.get(e.mode).remove(e)}},{key:"findNodeUnderPoint",value:function(e){var t,n=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=ht(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}(this.controlers);try{for(n.s();!(t=n.n()).done;){var r=lt(t.value,2)[1].findNodeUnderPoint(e);if(r)return r}}catch(e){n.e(e)}finally{n.f()}}},{key:"clear",value:function(){this.controlers.forEach((function(e){e.clear()}))}},{key:"size",value:function(e,t){return(e!==this._size.width||t!==this._size.height)&&(this.controlers.forEach((function(n){return n.size={width:e,height:t}})),this._size.width=e,this._size.height=t,this.flush(),!0)}},{key:"pause",value:function(){this._paused||(this._pausedGap=Date.now(),this._paused=!0),ft.caf(this.rafid)}},{key:"resume",value:function(){this._paused&&(this._pausedGap=Date.now()-this._pausedGap,this._paused=!1),ft.caf(this.rafid),this.update()}},{key:"toggle",value:function(){this._paused?this.resume():this.pause()}},{key:"destroy",value:function(){this._destroyed=!0,ft.caf(this.rafid)}},{key:"createControler",value:function(){this.controlers.set(at.BOTTOM,new Ne),this.controlers.set(at.MOVE,new Je),this.controlers.set(at.TOP,new ut),this.update()}},{key:"flush",value:function(){this.controlers.forEach((function(e){e.flush()}))}}])&&pt(t.prototype,n),r&&pt(t,r),e}();function vt(e){return(vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mt(Object(n),!0).forEach((function(t){gt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function gt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _t(e,t){return(_t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ot(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Et(e);if(t){var o=Et(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return kt(this,n)}}function kt(e,t){return!t||"object"!==vt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Et(e){return(Et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var xt=function(){if("hidden"in document)return"hidden";var e;["webkit","moz","ms","o"].some((function(t){return"".concat(t,"Hidden")in document&&(e="".concat(t,"Hidden"),!0)}));return e},St=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_t(e,t)}(i,e);var t,n,r,o=Ot(i);function i(e){var t;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this))._destroyed=!1,t._actived=!0,t.attach=function(e){var n=e.video,r=e.container;Object.assign(t.config,{video:n,container:r}),t._runner.detach(),t._runner.attach(n),t._render.detach(),t._render.attach(r)},t.destroy=function(){t._runner.destroy(),t._render.destroy(),t._mode.clear(),t._destroyed=!0,t.stop(),t.removeAllListeners()},t.onRunnerAttach=function(e){t.emit(L.ATTACH,e)},t.onRunnerDetach=function(){t.emit(L.DETACH)},t.timeupdate=function(e){t._actived&&t._mode.updateTime(e)},t.onRenerAttach=function(e){t.emit(ge.ATTACH,e)},t.onRenerDetach=function(){t.emit(ge.DETACH)},t.activeHandler=function(){var e;(e=xt())&&document[e]?t._clearTask=setTimeout((function(){t.pause(),t._space.clear(),t._mode.removeAllRendered(),t._mode.locked=!0,t._render.clearRendered(),t._actived=!1}),5e3):(clearTimeout(t._clearTask),t._actived||(t.resume(),t._mode.locked=!1,t._actived=!0))},t.update=function(){t.drawToCanvas(),t._rafid=ft.raf(t.update)},t.config=bt(bt({},{islive:!0,renderType:"canvas"}),e),!(t.config.container&&t.config.container instanceof HTMLDivElement))throw new Error("\u9700\u8981\u6307\u5b9acontainer\u6e32\u67d3\u5bb9\u5668");if(!(t.config.islive||t.config.video&&t.config.video instanceof HTMLVideoElement))throw new Error("\u70b9\u64ad\u6a21\u5f0f\u9700\u8981\u6307\u5b9avideo\u53c2\u6570\uff0c\u7528\u4e8e\u9a71\u52a8\u5f39\u5e55\u6570\u636e");return t._mode=new s(t.config.islive),t._space=new yt,t.createRunner(t.config.islive?"live":"vod",t.config.video),t.createRender(t.config.renderType,t.config.container),t.start(),t}return t=i,(n=[{key:"add",value:function(e){this._mode.add(e)}},{key:"pause",value:function(){this._destroyed||(this._runner.pause(),this._space.pause(),this._mode.locked=this.config.islive)}},{key:"resume",value:function(){this._destroyed||(this._runner.resume(),this._space.resume(),this._mode.locked=!1)}},{key:"toggle",value:function(){this._destroyed||(this._runner.toggle(),this._space.toggle(),this._mode.locked=this.config.islive&&!this._runner.playing)}},{key:"clearAll",value:function(){this._space.clear(),this._render.clearRendered(),this._mode.clear()}},{key:"createRunner",value:function(e,t){this._runner=new D(e),this._runner.on(L.TIME_UPDATE,this.timeupdate),this._runner.on(L.ATTACH,this.onRunnerAttach),this._runner.on(L.DETACH,this.onRunnerDetach),this._runner.attach(t)}},{key:"createRender",value:function(e,t){this._render=new ke(e),this._render.on(ge.ATTACH,this.onRenerAttach),this._render.on(ge.DETACH,this.onRenerDetach),this._render.attach(t)}},{key:"start",value:function(){ft.caf(this._rafid),this.addActiveHandler(),this.update()}},{key:"stop",value:function(){ft.caf(this._rafid),this.addActiveHandler(!0)}},{key:"addActiveHandler",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=xt();if(t){var n=t.replace(/[H|h]idden/,"")+"visibilitychange";e?document.removeEventListener(n,this.activeHandler):document.addEventListener(n,this.activeHandler)}}},{key:"drawToCanvas",value:function(){var e=this,t=new Map,n=[];this._render.reset(),this.alignSpace(),this._mode.current.forEach((function(r){r.render||le.create(r),e._space.addToControler(r);var o=e._space.getNode(r);o?o.needRemove?(e._space.remvoeFromControler(r),le.recyle(r),n.push(r)):t.set(r,o):n.push(r)})),this._render.drawDanmus(t),n.length>0&&this._mode.removeFromRendered(n)}},{key:"alignSpace",value:function(){var e=V.floor(this.config.container.clientWidth),t=V.floor(this.config.container.clientHeight);this._space.size(e,t)}},{key:"density",get:function(){return this._mode.current.size}},{key:"blockedType",set:function(e){this._mode.blockedType=e}}])&&wt(t.prototype,n),r&&wt(t,r),i}(r.EventEmitter);St.version="1.0.1"}]).default}));