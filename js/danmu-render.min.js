!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("DanmuRender",[],t):"object"==typeof exports?exports.DanmuRender=t():e.DanmuRender=t()}(this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t,n){"use strict";var r,o="object"==typeof Reflect?Reflect:null,i=o&&"function"==typeof o.apply?o.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function u(){u.init.call(this)}e.exports=u,u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var c=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?u.defaultMaxListeners:e._maxListeners}function f(e,t,n,r){var o,i,a,u;if(s(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),a=i[t]),void 0===a)a=i[t]=n,++e._eventsCount;else if("function"==typeof a?a=i[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(o=l(e))>0&&a.length>o&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,u=c,console&&console.warn&&console.warn(u)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=h.bind(r);return o.listener=n,r.wrapFn=o,o}function p(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):v(o,o.length)}function y(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},u.prototype.getMaxListeners=function(){return l(this)},u.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var u=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw u.context=a,u}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var s=c.length,l=v(c,s);for(n=0;n<s;++n)i(l[n],this,t)}return!0},u.prototype.addListener=function(e,t){return f(this,e,t,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(e,t){return f(this,e,t,!0)},u.prototype.once=function(e,t){return s(t),this.on(e,d(this,e,t)),this},u.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,d(this,e,t)),this},u.prototype.removeListener=function(e,t){var n,r,o,i,a;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){a=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},u.prototype.listeners=function(e){return p(this,e,!0)},u.prototype.rawListeners=function(e){return p(this,e,!1)},u.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):y.call(e,t)},u.prototype.listenerCount=y,u.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var r,o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},a=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},u=("undefined"==typeof window?{}:window).log,c=void 0===u?{getLoggers:function(){return{}}}:u;!function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR"}(r||(r={}));var s=c.getLoggers(),l=function(e){var t=i(e),n=t[0],r=t[1],o=t.slice(2);return"["+(new Date).toLocaleTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")+"] "+n+" "+r+": "+o.join()},f=function(e){var t=this;void 0===e&&(e="root"),this.name=e,this.levels=r,this.level=0,this.enabled=!0,this.trace=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.enabled&&t.level<=r.TRACE&&console.trace(l(a(["[TRACE]",t.name],e)))},this.debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.enabled&&t.level<=r.DEBUG&&console.log(l(a(["[DEBUG]",t.name],e)))},this.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.enabled&&t.level<=r.INFO&&console.log(l(a(["[INFO]",t.name],e)))},this.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.enabled&&t.level<=r.WARN&&console.warn(l(a(["[WARN]",t.name],e)))},this.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.enabled&&t.level<=r.ERROR&&console.error(l(a(["[ERROR]",t.name],e)))},this.setLevel=function(e){t.level=Math.max(Math.min(e,r.ERROR),r.TRACE)},this.getLevel=function(){return t.level},this.getLevelTag=function(){return t.levels[t.level]},this.enabledAll=function(e){void 0===e&&(e=!0),t.enabled=e},this.disableAll=function(e){void 0===e&&(e=!1),t.enabled=e}};t.default=o(o({},new f),{getLogger:function(e){return void 0===s[e]&&(s[e]=new f(e)),s[e]},getLoggers:function(){return s}})}]).default},function(e,t,n){"use strict";t.css=n(3),t.cx=n(4)},function(e,t,n){"use strict";e.exports=function(){throw new Error('Using the "css" tag in runtime is not supported. Make sure you have set up the Babel plugin correctly.')}},function(e,t,n){"use strict";e.exports=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")}},function(e,t,n){var r=n(6);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(8)(r,o);r.locals&&(e.exports=r.locals)},function(e,t,n){(t=n(7)(!1)).push([e.i,".c13la550{width:100px;height:36px;background-size:100% 100%;vertical-align:middle;display:inline-block;}\n.c12t5uoo{position:absolute;top:50%;padding:0 30px;color:#fff;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);}\n.cvyzygh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}\n.c1482y8w{background-size:100% 100%;line-height:36px;vertical-align:middle;display:inline-block;font-style:normal;-webkit-flex:auto;-ms-flex:auto;flex:auto;}\n.c1hkwb6p{background-size:100% 100%;width:84px;height:36px;vertical-align:middle;display:inline-block;}\n.cdz9rme{margin-top:4px;}\n.c80gt5q{width:100%;height:100%;overflow:hidden !important;}\n.f1quo010{-webkit-filter:drop-shadow(1px 1px #000);filter:drop-shadow(1px 1px #000);}\n.l1tddzzr{line-height:40px;}\n.ibsfnwn{will-change:transform;visibility:unset !important;}\n.a1ki4615{position:absolute;}\n.t1kl3pta{-webkit-filter:drop-shadow(1px 1px #fff9);filter:drop-shadow(1px 1px #fff9);}\n.d1hd3vq3{display:inline;position:absolute;box-sizing:border-box;text-align:start;white-space:nowrap;-moz-user-select:none;-o-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-ms-user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-perspective:500px;-moz-perspective:500px;-ms-perspective:500px;perspective:500px;padding:1px 0;font-family:-apple-system,Microsoft Yahei,SimHei,Helvetica Neue,Helvetica,Arial,Hiragino Sans GB,Heiti SC,WenQuanYi Micro Hei,sans-serif;pointer-events:none;visibility:hidden;}\n.dwpqo3m{border:2px solid white;}\n",""]),t.locals={c13la550:"c13la550",c12t5uoo:"c12t5uoo",cvyzygh:"cvyzygh",c1482y8w:"c1482y8w",c1hkwb6p:"c1hkwb6p",cdz9rme:"cdz9rme",c80gt5q:"c80gt5q",f1quo010:"f1quo010",l1tddzzr:"l1tddzzr",ibsfnwn:"ibsfnwn",a1ki4615:"a1ki4615",t1kl3pta:"t1kl3pta",d1hd3vq3:"d1hd3vq3",dwpqo3m:"dwpqo3m"},e.exports=t},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var o=(a=r,u=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(u),"/*# ".concat(c," */")),i=r.sources.map((function(e){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(e," */")}));return[n].concat(i).concat([o]).join("\n")}var a,u,c;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var o={};if(r)for(var i=0;i<this.length;i++){var a=this[i][0];null!=a&&(o[a]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);r&&o[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},function(e,t,n){var r,o,i={},a=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=r.apply(this,arguments)),o}),u=function(e,t){return t?t.querySelector(e):document.querySelector(e)},c=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var r=u.call(this,e,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),s=null,l=0,f=[],h=n(9);function d(e,t){for(var n=0;n<e.length;n++){var r=e[n],o=i[r.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](r.parts[a]);for(;a<r.parts.length;a++)o.parts.push(g(r.parts[a],t))}else{var u=[];for(a=0;a<r.parts.length;a++)u.push(g(r.parts[a],t));i[r.id]={id:r.id,refs:1,parts:u}}}}function p(e,t){for(var n=[],r={},o=0;o<e.length;o++){var i=e[o],a=t.base?i[0]+t.base:i[0],u={css:i[1],media:i[2],sourceMap:i[3]};r[a]?r[a].parts.push(u):n.push(r[a]={id:a,parts:[u]})}return n}function y(e,t){var n=c(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=f[f.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),f.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=c(e.insertAt.before,n);n.insertBefore(t,o)}}function v(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=f.indexOf(e);t>=0&&f.splice(t,1)}function m(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=function(){0;return n.nc}();r&&(e.attrs.nonce=r)}return b(t,e.attrs),y(e,t),t}function b(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function g(e,t){var n,r,o,i;if(t.transform&&e.css){if(!(i="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=i}if(t.singleton){var a=l++;n=s||(s=m(t)),r=O.bind(null,n,a,!1),o=O.bind(null,n,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",b(t,e.attrs),y(e,t),t}(t),r=E.bind(null,n,t),o=function(){v(n),n.href&&URL.revokeObjectURL(n.href)}):(n=m(t),r=k.bind(null,n),o=function(){v(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=a()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=p(e,t);return d(n,t),function(e){for(var r=[],o=0;o<n.length;o++){var a=n[o];(u=i[a.id]).refs--,r.push(u)}e&&d(p(e,t),t);for(o=0;o<r.length;o++){var u;if(0===(u=r[o]).refs){for(var c=0;c<u.parts.length;c++)u.parts[c]();delete i[u.id]}}}};var w,_=(w=[],function(e,t){return w[e]=t,w.filter(Boolean).join("\n")});function O(e,t,n,r){var o=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=_(t,o);else{var i=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(i,a[t]):e.appendChild(i)}}function k(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function E(e,t,n){var r=n.css,o=n.sourceMap,i=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||i)&&(r=h(r)),o&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([r],{type:"text/css"}),u=e.href;e.href=URL.createObjectURL(a),u&&URL.revokeObjectURL(u)}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var o,i=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?e:(o=0===i.indexOf("//")?i:0===i.indexOf("/")?n+i:r+i.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},function(e,t){self.fetch||(self.fetch=function(e,t){return t=t||{},new Promise((function(n,r){var o=new XMLHttpRequest,i=[],a=[],u={},c=function(){return{ok:2==(o.status/100|0),statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:c,headers:{keys:function(){return i},entries:function(){return a},get:function(e){return u[e.toLowerCase()]},has:function(e){return e.toLowerCase()in u}}}};for(var s in o.open(t.method||"get",e,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,n){i.push(t=t.toLowerCase()),a.push([t,n]),u[t]=u[t]?u[t]+","+n:n})),n(c())},o.onerror=r,o.withCredentials="include"==t.credentials,t.headers)o.setRequestHeader(s,t.headers[s]);o.send(t.body||null)}))})},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return It}));var r=n(0);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];u(this,e),this.islive=t,this.danmuMap=[],this.renderMap=new Map,this.danmuSet=new Set,this.IGNORE_SEEK_SECONDS=2,this.lastTime=-1,this._locked=!1,this._blockedConfig={top:!1,bottom:!1,move:!1,color:!1}}var t,n,r;return t=e,(n=[{key:"updateTime",value:function(e){var t=this;if(this.islive)return this.danmuMap.forEach((function(e){t.renderFilter(e)})),void(this.danmuMap.length=0);var n=e-this.lastTime;this.lastTime=e,n<=0||n>this.IGNORE_SEEK_SECONDS||this.danmuMap.forEach((function(r){var o=e-r.time;t.renderFilter(r,(function(){return o>=0&&o<=n&&!r.blocked}))}))}},{key:"add",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._locked||!this.islive){var r=Array.isArray(e)?e:[e];r.forEach((function(e){t.danmuSet.has(e.id)||(t.danmuSet.add(e.id),t.danmuMap.push(e),n&&t.renderFilter(e))}))}}},{key:"removeFromRendered",value:function(e){var t=this;e.forEach((function(e){t.renderMap.has(e.id)&&t.renderMap.delete(e.id)}))}},{key:"removeAllRendered",value:function(){this.renderMap.clear(),this.islive&&(this.danmuMap.length=0)}},{key:"clear",value:function(){this.danmuMap.length=0,this.renderMap.clear()}},{key:"renderFilter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};this.renderVaild(e)&&t()&&(e.renderInit=Date.now(),this.renderMap.set(e.id,e))}},{key:"renderVaild",value:function(e){return!e.blocked&&!this._blockedConfig[e.mode]&&!this.renderMap.has(e.id)}},{key:"blockedType",set:function(e){var t=this;this._blockedConfig=i(i({},this._blockedConfig),"boolean"==typeof e?{top:e,move:e,bottom:e}:e),this.danmuMap.forEach((function(e){e.blocked=t._blockedConfig[e.mode]}))}},{key:"locked",set:function(e){this._locked=e}},{key:"current",get:function(){return this.renderMap}}])&&c(t.prototype,n),r&&c(t,r),e}();function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y(e);if(t){var o=y(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p(this,n)}}function p(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(n,e);var t=d(n);function n(){var e;return f(this,n),(e=t.apply(this,arguments))._playing=!1,e}return n}(r.EventEmitter);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=k(e);if(t){var o=k(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return O(this,n)}}function O(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(i,e);var t,n,r,o=_(i);function i(){var e;return b(this,i),(e=o.apply(this,arguments)).destroy=function(){e.detach()},e.pause=function(){e._playing=!1},e.resume=function(){e._playing=!0},e.timeupdate=function(){e._playing&&e.emit("timeUpdate",e._media.currentTime)},e}return t=i,(n=[{key:"attach",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._media=e,this.addMediaListeners(),this._playing=t}},{key:"detach",value:function(){this.removeMediaListeners(),this._media=null}},{key:"addMediaListeners",value:function(){this._media.addEventListener("timeupdate",this.timeupdate)}},{key:"removeMediaListeners",value:function(){this._media.removeEventListener("timeupdate",this.timeupdate)}}])&&g(t.prototype,n),r&&g(t,r),i}(v);function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var o=P(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return A(this,n)}}function A(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var L,I=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(i,e);var t,n,r,o=T(i);function i(){var e;return S(this,i),(e=o.apply(this,arguments)).INTERVAL=300,e._attachTime=0,e.destroy=function(){e.detach()},e.pause=function(){e._playing=!1},e.resume=function(){e._playing=!0},e.timeupdate=function(){e._playing&&e.emit("timeUpdate",(Date.now()-e._attachTime)/1e3)},e}return t=i,(n=[{key:"attach",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._playing=t,this._attachTime=Date.now(),this._timerTask=setInterval(this.timeupdate,this.INTERVAL)}},{key:"detach",value:function(){clearInterval(this._timerTask),this._timerTask=null}}])&&R(t.prototype,n),r&&R(t,r),i}(v);function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.ATTACH="attach",e.DETACH="detach",e.PAUSE="pause",e.RESUME="resume",e.DESTROY="destroy",e.TIME_UPDATE="timeUpdate"}(L||(L={}));var D=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"live";M(this,e),this.type=t,this._playing=!1,this._destroyed=!1,this.createTypedRunner(),this.fire=this._runner.emit.bind(this),this.on=this._runner.on.bind(this),this.once=this._runner.once.bind(this),this.off=this._runner.off.bind(this)}var t,n,r;return t=e,(n=[{key:"attach",value:function(e){this._runner.attach(e),this._playing=!0,this.fire(L.ATTACH,e)}},{key:"detach",value:function(){this._runner.detach(),this.fire(L.DETACH)}},{key:"pause",value:function(){!this._destroyed&&this._playing&&(this._runner.pause(),this._playing=!1,this.fire(L.PAUSE,this._playing))}},{key:"resume",value:function(){this._destroyed||this._playing||(this._runner.resume(),this._playing=!0,this.fire(L.RESUME,this._playing))}},{key:"toggle",value:function(){this._destroyed||(this._playing?(this._runner.pause(),this.fire(L.PAUSE,!1)):(this._runner.resume(),this.fire(L.RESUME,!0)),this._playing=!this._playing)}},{key:"destroy",value:function(){this._runner.removeAllListeners(),this._runner.destroy(),this._playing=!1,this._destroyed=!0,this.fire(L.DESTROY)}},{key:"createTypedRunner",value:function(){var e=this;"vod"===this.type?this._runner=new E:this._runner=new I,this._runner.on("timeUpdate",(function(t){e.fire(L.TIME_UPDATE,t)}))}},{key:"playing",get:function(){return this._playing}}])&&C(t.prototype,n),r&&C(t,r),e}();function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G(e);if(t){var o=G(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return q(this,n)}}function q(e,t){return!t||"object"!==H(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}(i,e);var t,n,r,o=F(i);function i(){return z(this,i),o.apply(this,arguments)}return t=i,(n=[{key:"destroy",value:function(){this._container.innerHTML=""}}])&&N(t.prototype,n),r&&N(t,r),i}(r.EventEmitter),V={random:function(){return Number(crypto.getRandomValues(new Uint8Array(1)))/254},randomInt:function(e){return this.floor(this.random()*e)},ceil:function(e){return Math.ceil(e)},floor:function(e){return Math.floor(e)}},Y=(n(2),"f1quo010"),$="-apple-system, Microsoft Yahei, SimHei, Helvetica Neue, Helvetica, Arial, \nHiragino Sans GB, Heiti SC, WenQuanYi Micro Hei,sans-serif";function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function X(e,t){return(X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ee(e);if(t){var o=ee(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Z(this,n)}}function Z(e,t){return!t||"object"!==W(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ee(e){return(ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n(5);var te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}(i,e);var t,n,r,o=Q(i);function i(){return J(this,i),o.apply(this,arguments)}return t=i,(n=[{key:"attach",value:function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1],this._container=e,e.classList.remove(Y),this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.classList.add("a1ki4615"),this._ctx=this._canvas.getContext("2d")),this._container.append(this._canvas),this.alignCanvas()}},{key:"detach",value:function(){this._canvas&&this._canvas.remove()}},{key:"drawDanmus",value:function(e){var t=this;e.forEach((function(e,n){t.renderAt(n,e)}))}},{key:"reset",value:function(){!this.alignCanvas()&&this._ctx&&(/Firefox/gi.test(navigator.userAgent)?this._canvas.width=this._canvas.width:this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height))}},{key:"clearRendered",value:function(){this._ctx&&this._canvas&&this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)}},{key:"renderAt",value:function(e,t){this._ctx&&e.render&&this._ctx.drawImage(e.render,t.point.x,t.point.y)}},{key:"alignCanvas",value:function(){if(this._container){var e=V.floor(this._container.clientWidth),t=V.floor(this._container.clientHeight);if(this._canvas.width!==e||this._canvas.height!==t)return this._canvas.width=e,this._canvas.height=t,!0}return!1}}])&&K(t.prototype,n),r&&K(t,r),i}(B),ne=new Map,re=new Set;function oe(e){return ne.has(e)?Promise.resolve(ne.get(e)):re.has(e)?function(e){return new Promise((function(t){var n=setInterval((function(){ne.has(e)&&(clearInterval(n),t(ne.get(e)))}),1e3)}))}(e):(re.add(e),fetch(e).then((function(e){return e.blob()})).then((function(e){return URL.createObjectURL(e)})).catch((function(){return e})).then((function(t){return re.delete(e),ne.set(e,t),t})))}function ie(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ae(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ae(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ce(e){return[14,20,26].reduce((function(t,n){var r=e-n;return r>0&&r<t.distance?{distance:Math.abs(n-e),size:n}:t}),{distance:Number.MAX_VALUE,size:e}).size}var se=function(e){return e.message.length>35?e.message.substr(0,35)+"...":e.message},le=new Map;function fe(e,t,n){return new Promise((function(r){e.onload=function(){r(),e.onload=null,le.has(n)||le.set(n,{src:t,img:e})},e.src=t}))}var he=function(e){return e.toString(16).padStart(6,"000000")},de=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._canvasPool=[]}var t,n,r;return t=e,(n=[{key:"create",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._htmlLine||this.createMeasureSpan();var r=(t=this._canvasPool.length>0?this._canvasPool.shift():document.createElement("canvas")).getContext("2d");if(r){var o,i=se(e),a=this.calc((e.background?"".concat(null===(o=e.from)||void 0===o?void 0:o.n,":"):"")+i,void 0!==e.background,{ctx:r,fontSize:"".concat(ce(e.size),"px"),textBaseline:"middle",textAlign:"start",border:n});this.drawDanmu(i,n,{canvas:t,ctx:r,bounds:a,danmu:e}),e.render=t}}},{key:"draw",value:function(e,t,n,r){var o=n.canvas,i=n.ctx,a=n.danmu,u=n.bounds;if(r){var c=u.width+30+30>r.head.width+r.tail.width;o.height=36,i.clearRect(0,0,o.width,o.height),i.drawImage(r.head,0,0),c&&i.drawImage(r.body,0,0,r.body.width,r.body.height,r.head.width,0,u.width,36),i.clearRect(u.width-30,0,30,36),i.drawImage(r.tail,0,0,r.tail.width,r.tail.height,u.width-30,0,30,36)}else o.width=u.width,o.height=u.height,i.clearRect(0,0,o.width,o.height);i.font="".concat(ce(a.size),"px ").concat($),i.fillStyle="#".concat(a.background?"FFFFFF":he(a.color));var s,l,f=0===a.color?"#fff9":"#000";(/Safari/gi.test(navigator.userAgent)?(i.shadowColor=f,i.shadowBlur=0,i.shadowOffsetX=i.shadowOffsetY=1):i.filter="drop-shadow(1px 1px ".concat(f,")"),i.textBaseline="middle",i.textAlign="start",r)?i.fillText("".concat(null!==(s=null==a||null===(l=a.from)||void 0===l?void 0:l.n)&&void 0!==s?s:"",": ").concat(e),30,V.floor(.56*o.height)):(i.fillText(e,t?1:0,V.floor(.56*u.height)+(t?1:0)),t&&(i.strokeStyle="white",i.lineWidth=2,i.strokeRect(1,1,u.width-2,u.height-2)))}},{key:"drawDanmu",value:function(e,t,n){var r,o=this,i=n.canvas,a=n.ctx,u=n.bounds,c=n.danmu;if(c.background){var s=c.background,l=s.headImg,f=s.bodyImg,h=s.tailImg;if(i.width=u.width,i.height=36,function(e){var t=e.headImg,n=e.bodyImg,r=e.tailImg;return le.has(t)&&le.has(n)&&le.has(r)}(c.background)){var d=function(e){var t=e.headImg,n=e.bodyImg,r=e.tailImg;return{headInfo:le.get(t),bodyInfo:le.get(n),tailInfo:le.get(r)}}(c.background),p=d.headInfo,y=d.bodyInfo,v=d.tailInfo;return c.background={headImg:p.src,bodyImg:y.src,tailImg:v.src,loaded:!0},void this.draw(e,t,{canvas:i,ctx:a,bounds:u,danmu:c},{head:p.img,body:y.img,tail:v.img})}var m=document.createElement("img"),b=document.createElement("img"),g=document.createElement("img");(r=[l,f,h],Promise.all(r.map((function(e){return oe(e)})))).then((function(n){var r=ie(n,3),s=r[0],d=r[1],p=r[2];c.background={headImg:s,bodyImg:d,tailImg:p,loaded:!0},Promise.all([fe(m,s,l),fe(b,d,f),fe(g,p,h)]).then((function(){o.draw(e,t,{canvas:i,ctx:a,bounds:u,danmu:c},{head:m,body:b,tail:g})})).catch(console.warn)}))}else this.draw(e,t,{canvas:i,ctx:a,bounds:u,danmu:c})}},{key:"recyle",value:function(e){e.render&&(this._canvasPool.push(e.render),delete e.render)}},{key:"calc",value:function(e,t,n){var r=n.ctx,o=n.fontSize,i=n.textBaseline,a=n.textAlign,u=n.border,c=void 0!==u&&u;this._htmlLine.innerText=e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),this._htmlLine.style.fontSize=o,c?this._htmlLine.classList.add("dwpqo3m"):this._htmlLine.classList.remove("dwpqo3m"),document.body.appendChild(this._htmlLine);var s=this._htmlLine.getBoundingClientRect(),l=s.width,f=s.height;this._htmlLine.remove(),r.font="".concat(o," ").concat($),r.textBaseline=i,r.textAlign=a;var h=r.measureText(e);return{width:Math.max(h.width,l)+(t?60:0),height:Math.min(40,f)}}},{key:"createMeasureSpan",value:function(){this._htmlLine=document.createElement("span"),this._htmlLine.classList.add("d1hd3vq3",Y)}}])&&ue(t.prototype,n),r&&ue(t,r),e}());function pe(e){return(pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ye(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function me(e,t){return(me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=we(e);if(t){var o=we(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ge(this,n)}}function ge(e,t){return!t||"object"!==pe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function we(e){return(we=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _e,Oe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&me(e,t)}(i,e);var t,n,r,o=be(i);function i(){var e;return ye(this,i),(e=o.apply(this,arguments)).normalPool=[],e.colorPool={},e.itemsRender=new Map,e}return t=i,(n=[{key:"attach",value:function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1],this._container=e,e.classList.add(Y,"l1tddzzr"),this.fragment=document.createDocumentFragment()}},{key:"detach",value:function(){}},{key:"drawDanmus",value:function(e){var t,n=this;e.forEach((function(e,r){if(t=null,n.itemsRender.has(e)){var o=n.itemsRender.get(e);t=o instanceof HTMLSpanElement?o:o.main}else if(r.background){if(r.background.loaded){var i,a,u=n.getColorElement(r.color),c=u.isCached,s=u.shape;c||(s.head.style.backgroundImage="url(".concat(r.background.headImg,")"),s.body.style.cssText="background-image: url(".concat(r.background.bodyImg,");"),s.tail.style.backgroundImage="url(".concat(r.background.tailImg,")")),s.text.style.cssText="font-size: ".concat(ce(r.size),"px;"),s.text.innerText="".concat(null===(i=r.from)||void 0===i?void 0:i.n,": ").concat(r.message),s.main.style.width="".concat(null===(a=r.render)||void 0===a?void 0:a.width,"px"),t=s.main,n.fragment.appendChild(t),n.itemsRender.set(e,s)}}else(t=n.getNormalElement()).classList.add("ibsfnwn"),t.style.color="#".concat(he(r.color)),t.style.fontSize="".concat(ce(r.size),"px"),0===r.color&&t.classList.add("t1kl3pta"),t.innerText=r.message,n.fragment.appendChild(t),n.itemsRender.set(e,t);t&&(t.style.transform="translate3d(".concat(Math.round(e.point.x),"px, ").concat(Math.round(e.point.y),"px, 0px)"))})),this._container.appendChild(this.fragment)}},{key:"clearRendered",value:function(){this._container.innerHTML=""}},{key:"reset",value:function(){var e=this;this.itemsRender.forEach((function(t,n){if(n.needRemove){if(t instanceof HTMLSpanElement)e.normalPool.push(t),t.classList.remove("ibsfnwn","t1kl3pta");else{var r,o=null!==(r=e.colorPool[n.danmuVo.color])&&void 0!==r?r:[];o.push(t),e.colorPool[n.danmuVo.color]=o}e.itemsRender.delete(n)}}))}},{key:"getNormalElement",value:function(){var e;return 0===this.normalPool.length?(e=document.createElement("span")).classList.add("d1hd3vq3"):e=this.normalPool.shift(),e}},{key:"getColorElement",value:function(e){var t,n=null!==(t=this.colorPool[e])&&void 0!==t?t:[];if(0===n.length){var r=document.createElement("i"),o=document.createElement("i"),i=document.createElement("i");r.classList.add("c13la550"),o.classList.add("c1482y8w"),i.classList.add("c1hkwb6p");var a=document.createElement("div");a.classList.add("cvyzygh"),a.append(r,o,i);var u=document.createElement("div");u.classList.add("d1hd3vq3","cdz9rme","ibsfnwn");var c=document.createElement("span");return c.classList.add("c12t5uoo"),u.append(a,c),{isCached:!1,shape:{head:r,body:o,tail:i,bg:a,main:u,text:c}}}return{isCached:!0,shape:n.shift()}}}])&&ve(t.prototype,n),r&&ve(t,r),i}(B);function ke(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.ATTACH="attach",e.DETACH="detach"}(_e||(_e={}));var xe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"canvas";ke(this,e),this.type=t,this.createTypedRender(),this.fire=this._render.emit.bind(this),this.on=this._render.on.bind(this),this.once=this._render.once.bind(this),this.off=this._render.off.bind(this)}var t,n,r;return t=e,(n=[{key:"drawDanmus",value:function(e){this._render.drawDanmus(e)}},{key:"reset",value:function(){this._render.reset()}},{key:"attach",value:function(e){this._render.attach(e),e.classList.add("c80gt5q"),this.fire(_e.ATTACH,e)}},{key:"detach",value:function(){this._render.detach(),this.fire(_e.DETACH)}},{key:"destroy",value:function(){this._render.destroy()}},{key:"clearRendered",value:function(){this._render.clearRendered()}},{key:"createTypedRender",value:function(){"css"===this.type?this._render=new Oe:this._render=new te}}])&&Ee(t.prototype,n),r&&Ee(t,r),e}();function Se(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||je(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Re(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=je(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function je(e,t){if(e){if("string"==typeof e)return Te(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Te(e,t):void 0}}function Te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Pe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lineMap=new Map,this._maxLineInViewPort=0,this.LINE_HEIGHT=40,this.rendered=new Map,this._size={width:0,height:0},this.prepareInit()}var t,n,r;return t=e,(n=[{key:"findNodeUnderPoint",value:function(e){var t,n=this.getIndexByYpos(e.y),r=Re(Array.from(this.rendered).reverse());try{for(r.s();!(t=r.n()).done;){var o=Se(t.value,2),i=o[0],a=o[1];if(a.lineIndex===n){var u=e.x-a.point.x;if(u>0&&u<a.size.width)return i}}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"getNode",value:function(e){return this.rendered.get(e)}},{key:"measure",value:function(e){return e.render?{width:e.render.width,height:e.render.height}:{width:0,height:0}}},{key:"remove",value:function(e){if(!this.rendered.has(e))return!1;this.rendered.delete(e);var t,n=Re(this.lineMap);try{for(n.s();!(t=n.n()).done;){var r=Se(t.value,2),o=r[0],i=r[1];if("EMPTY"!==i&&i.danmuVo===e)return this.lineMap.set(o,"EMPTY"),!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"clear",value:function(){var e=this;this.rendered.clear(),this.lineMap.forEach((function(t,n){return e.lineMap.set(n,"EMPTY")}))}},{key:"prepareInit",value:function(){for(var e=0;e<80;++e)this.lineMap.set(e,"EMPTY")}},{key:"getIndexByYpos",value:function(e){return V.floor(e/this.LINE_HEIGHT)}},{key:"size",set:function(e){var t=e.height,n=e.width;this._size.width=n,this._size.height=t,this._maxLineInViewPort=V.floor(t/this.LINE_HEIGHT)}},{key:"width",get:function(){return this._size.width}},{key:"height",get:function(){return this._size.height}}])&&Ae(t.prototype,n),r&&Ae(t,r),e}();function Le(e){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ie(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Me(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Me(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function De(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function He(e,t,n){return(He="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Fe(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ze(e,t){return(ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Fe(e);if(t){var o=Fe(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ue(this,n)}}function Ue(e,t){return!t||"object"!==Le(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Fe(e){return(Fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var qe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ze(e,t)}(i,e);var t,n,r,o=Ne(i);function i(){var e;return Ce(this,i),(e=o.apply(this,arguments)).duration=4e3,e}return t=i,(n=[{key:"update",value:function(e){for(var t=this.rendered.values();;){var n=t.next(),r=n.done,o=n.value;if(r)break;o.established+=e;var i=this.measure(o.danmuVo);o.point.x=V.floor((this.width-i.width)/2),o.point.y=V.floor(this.height-(o.lineIndex+1)*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-i.height)),o.needRemove=o.established>=this.duration}}},{key:"flush",value:function(){this.update(0)}},{key:"add",value:function(e){if(this.rendered.has(e))return!1;var t=this.getFreeline(),n=this.measure(e),r=Date.now()-(e.renderInit||Date.now()),o={point:{x:V.floor((this.width-n.width)/2),y:V.floor(this.height-(t+1)*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-n.height))},size:n,established:r,speed:6,danmuVo:e,lineIndex:t,needRemove:r>=this.duration};return!o.needRemove&&(this.rendered.set(e,o),this.lineMap.set(t,o),!0)}},{key:"getFreeline",value:function(){for(var e=this.lineMap.entries();;){var t=e.next(),n=t.done,r=Ie(t.value,2),o=r[0],i=r[1];if(n||o>=this._maxLineInViewPort)break;if("EMPTY"===i)return o}return V.randomInt(this._maxLineInViewPort)}},{key:"getIndexByYpos",value:function(e){return He(Fe(i.prototype),"getIndexByYpos",this).call(this,this.height-e)}}])&&De(t.prototype,n),r&&De(t,r),i}(Pe);function Ge(e){return(Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ve(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ve(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ye(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function We(e,t){return(We=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Je(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Xe(e);if(t){var o=Xe(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ke(this,n)}}function Ke(e,t){return!t||"object"!==Ge(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Xe(e){return(Xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Qe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&We(e,t)}(i,e);var t,n,r,o=Je(i);function i(){var e;return Ye(this,i),(e=o.apply(this,arguments)).SPEED=100,e.STEP=10,e.GAP=30,e}return t=i,(n=[{key:"getFreeline",value:function(e){for(var t=this.lineMap.entries();;){var n=t.next(),r=n.done,o=n.value;if(r)break;var i=Be(o,2),a=i[0],u=i[1];if(a>=this._maxLineInViewPort)break;if("EMPTY"===u)return a;if(V.floor(this.width-e*(this.SPEED+this.STEP*a)/1e3)-(u.point.x+u.size.width)>this.GAP)return a}return V.randomInt(this._maxLineInViewPort)}},{key:"update",value:function(e){for(var t=this.rendered.values();;){var n=t.next(),r=n.done,o=n.value;if(r)break;o.established+=e,o.point.x=V.floor(this.width-o.established*o.speed/1e3),o.needRemove=o.point.x<-o.size.width}}},{key:"flush",value:function(){this.update(0)}},{key:"add",value:function(e){if(this.rendered.has(e))return!1;var t=Date.now()-(e.renderInit||Date.now()),n=this.getFreeline(t),r=this.SPEED+this.STEP*(n%3),o={x:V.floor(this.width-t*r/1e3),y:n*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-(void 0===e.background?e.size:36))},i={width:e.render?e.render.width:0,height:e.size},a={point:o,size:i,established:t,speed:r,danmuVo:e,lineIndex:n,needRemove:o.x<-i.width};return!a.needRemove&&(this.rendered.set(e,a),this.lineMap.set(n,a),!0)}}])&&$e(t.prototype,n),r&&$e(t,r),i}(Pe);function Ze(e){return(Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function et(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return tt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function nt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function rt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ot(e,t){return(ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function it(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ut(e);if(t){var o=ut(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return at(this,n)}}function at(e,t){return!t||"object"!==Ze(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ut(e){return(ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ct,st=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}(i,e);var t,n,r,o=it(i);function i(){var e;return nt(this,i),(e=o.apply(this,arguments)).duration=4e3,e}return t=i,(n=[{key:"update",value:function(e){for(var t=this.rendered.values();;){var n=t.next(),r=n.done,o=n.value;if(r)break;o.established+=e;var i=this.measure(o.danmuVo);o.point.x=V.floor((this.width-i.width)/2),o.point.y=V.floor(o.lineIndex*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-i.height)),o.needRemove=o.established>=this.duration}}},{key:"flush",value:function(){this.update(0)}},{key:"add",value:function(e){if(this.rendered.has(e))return!1;var t=this.getFreeline(),n=this.measure(e),r=Date.now()-(e.renderInit||Date.now()),o={point:{x:V.floor((this.width-n.width)/2),y:V.floor(t*this.LINE_HEIGHT+V.floor(this.LINE_HEIGHT-n.height))},size:n,established:r,speed:6,danmuVo:e,lineIndex:t,needRemove:r>=this.duration};return!o.needRemove&&(this.rendered.set(e,o),this.lineMap.set(t,o),!0)}},{key:"getFreeline",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var e=this.lineMap.entries();;){var t=e.next(),n=t.done,r=et(t.value,2),o=r[0],i=r[1];if(n||o>=this._maxLineInViewPort)break;if("EMPTY"===i)return o}return V.randomInt(this._maxLineInViewPort)}}])&&rt(t.prototype,n),r&&rt(t,r),i}(Pe),lt=requestAnimationFrame||webkitRequestAnimationFrame||mozRequestAnimationFrame||oRequestAnimationFrame||msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)},ft=cancelAnimationFrame||webkitCancelAnimationFrame||mozCancelAnimationFrame||msCancelAnimationFrame||oCancelAnimationFrame||function(e){clearTimeout(e)},ht={raf:lt.bind(window),caf:ft.bind(window)};function dt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||pt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pt(e,t){if(e){if("string"==typeof e)return yt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yt(e,t):void 0}}function yt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function vt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.BOTTOM="bottom",e.TOP="top",e.MOVE="move",e.COLOR="color"}(ct||(ct={}));var mt=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.controlers=new Map,this.preTime=-1,this._pausedGap=0,this._paused=!1,this._destroyed=!1,this._size={width:0,height:0},this.update=function(){if(!t._paused&&!t._destroyed){var e=Date.now();t.controlers.forEach((function(n){n.update(e-t.preTime-t._pausedGap)})),t._pausedGap=0,t.preTime=e,t.rafid=ht.raf(t.update)}},this.createControler()}var t,n,r;return t=e,(n=[{key:"addToControler",value:function(e){this.controlers.has(e.mode)&&this.controlers.get(e.mode).add(e)}},{key:"getNode",value:function(e){if(this.controlers.has(e.mode))return this.controlers.get(e.mode).getNode(e)}},{key:"remvoeFromControler",value:function(e){this.controlers.has(e.mode)&&this.controlers.get(e.mode).remove(e)}},{key:"findNodeUnderPoint",value:function(e){var t,n=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=pt(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}(this.controlers);try{for(n.s();!(t=n.n()).done;){var r=dt(t.value,2)[1].findNodeUnderPoint(e);if(r)return r}}catch(e){n.e(e)}finally{n.f()}}},{key:"clear",value:function(){this.controlers.forEach((function(e){e.clear()}))}},{key:"size",value:function(e,t){return(e!==this._size.width||t!==this._size.height)&&(this.controlers.forEach((function(n){return n.size={width:e,height:t}})),this._size.width=e,this._size.height=t,this.flush(),!0)}},{key:"pause",value:function(){this._paused||(this._pausedGap=Date.now(),this._paused=!0),ht.caf(this.rafid)}},{key:"resume",value:function(){this._paused&&(this._pausedGap=Date.now()-this._pausedGap,this._paused=!1),ht.caf(this.rafid),this.update()}},{key:"toggle",value:function(){this._paused?this.resume():this.pause()}},{key:"destroy",value:function(){this._destroyed=!0,ht.caf(this.rafid)}},{key:"createControler",value:function(){this.controlers.set(ct.BOTTOM,new qe),this.controlers.set(ct.MOVE,new Qe),this.controlers.set(ct.TOP,new st),this.update()}},{key:"flush",value:function(){this.controlers.forEach((function(e){e.flush()}))}}])&&vt(t.prototype,n),r&&vt(t,r),e}(),bt=n(1),gt=n.n(bt);n(10);function wt(e){return(wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _t(e){return function(e){if(Array.isArray(e))return Ot(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Ot(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ot(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ot(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kt(Object(n),!0).forEach((function(t){xt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function St(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Rt(e,t){return(Rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function jt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=At(e);if(t){var o=At(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Tt(this,n)}}function Tt(e,t){return!t||"object"!==wt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function At(e){return(At=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Pt=gt.a.getLogger("RENDER").info.bind(null,"[@index]"),Lt=function(){if("hidden"in document)return"hidden";var e;["webkit","moz","ms","o"].some((function(t){return"".concat(t,"Hidden")in document&&(e="".concat(t,"Hidden"),!0)}));return e},It=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rt(e,t)}(i,e);var t,n,r,o=jt(i);function i(e){var t;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this))._destroyed=!1,t._actived=!0,t._queue=[],t.attach=function(e){var n=e.video,r=e.container;Object.assign(t.config,{video:n,container:r}),t._runner.detach(),t._runner.attach(n),t._render.detach(),t._render.attach(r)},t.delayAppend=function(){t._delayAppendTask||(t._delayAppendTask=setTimeout((function(){t._delayAppendTask=null,t._mode.add(t._queue.splice(0,2)),t._queue.length&&t.delayAppend()}),200))},t.destroy=function(){t._runner.destroy(),t._render.destroy(),t._mode.clear(),t._destroyed=!0,t.clearDelayTask(),t.stop(),t.removeAllListeners()},t.onRunnerAttach=function(e){t.emit(L.ATTACH,e)},t.onRunnerDetach=function(){t.emit(L.DETACH)},t.timeupdate=function(e){t._actived&&t._mode.updateTime(e)},t.onRenerAttach=function(e){t.emit(_e.ATTACH,e)},t.onRenerDetach=function(){t.emit(_e.DETACH)},t.activeHandler=function(){if((n=Lt())&&document[n])t.pause(),t._actived=!1,t.inactiveTime=Date.now();else if(!t._actived){t.resume(),t._actived=!0;var e=Date.now()-t.inactiveTime;Pt("\u524d\u53f0\u6fc0\u6d3b",e),e>5e3&&(Pt("\u95f4\u9694\u8d85\u8fc7\u9650\u5236\uff0c \u6e05\u5c4f"),t._space.clear(),t._mode.removeAllRendered(),t._render.clearRendered(),t.clearDelayTask())}var n},t.update=function(){t.drawToCanvas(),t._rafid=ht.raf(t.update)},t.config=Et(Et({},{islive:!0,renderType:"canvas"}),e),!(t.config.container&&t.config.container instanceof HTMLDivElement))throw new Error("\u9700\u8981\u6307\u5b9acontainer\u6e32\u67d3\u5bb9\u5668");if(!(t.config.islive||t.config.video&&t.config.video instanceof HTMLVideoElement))throw new Error("\u70b9\u64ad\u6a21\u5f0f\u9700\u8981\u6307\u5b9avideo\u53c2\u6570\uff0c\u7528\u4e8e\u9a71\u52a8\u5f39\u5e55\u6570\u636e");return t._version="".concat("1.0.2","_").concat(t.config.renderType),t._mode=new s(t.config.islive),t._space=new mt,t.createRunner(t.config.islive?"live":"vod",t.config.video),t.createRender(t.config.renderType,t.config.container),t.start(),t}return t=i,(n=[{key:"add",value:function(e){var t;Array.isArray(e)?(t=this._queue).push.apply(t,_t(e)):this._queue.push(e),this.delayAppend()}},{key:"pause",value:function(){this._destroyed||(this._runner.pause(),this._space.pause(),this._mode.locked=this.config.islive)}},{key:"resume",value:function(){this._destroyed||(this._runner.resume(),this._space.resume(),this._mode.locked=!1)}},{key:"toggle",value:function(){this._destroyed||(this._runner.toggle(),this._space.toggle(),this._mode.locked=this.config.islive&&!this._runner.playing)}},{key:"clearAll",value:function(){this._space.clear(),this._render.clearRendered(),this._mode.clear(),this.clearDelayTask()}},{key:"clearDelayTask",value:function(){this._queue.length=0,clearTimeout(this._delayAppendTask),this._delayAppendTask=null}},{key:"createRunner",value:function(e,t){this._runner=new D(e),this._runner.on(L.TIME_UPDATE,this.timeupdate),this._runner.on(L.ATTACH,this.onRunnerAttach),this._runner.on(L.DETACH,this.onRunnerDetach),this._runner.attach(t)}},{key:"createRender",value:function(e,t){this._render=new xe(e),this._render.on(_e.ATTACH,this.onRenerAttach),this._render.on(_e.DETACH,this.onRenerDetach),this._render.attach(t)}},{key:"start",value:function(){ht.caf(this._rafid),this.addActiveHandler(),this.update()}},{key:"stop",value:function(){ht.caf(this._rafid),this.addActiveHandler(!0)}},{key:"addActiveHandler",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Lt();if(t){var n=t.replace(/[H|h]idden/,"")+"visibilitychange";e?document.removeEventListener(n,this.activeHandler):document.addEventListener(n,this.activeHandler)}}},{key:"drawToCanvas",value:function(){var e=this,t=new Map,n=[];this._render.reset(),this.alignSpace(),this._mode.current.forEach((function(r){r.render||de.create(r),e._space.addToControler(r);var o=e._space.getNode(r);o?o.needRemove?(e._space.remvoeFromControler(r),de.recyle(r),n.push(r)):t.set(r,o):n.push(r)})),this._render.drawDanmus(t),n.length>0&&this._mode.removeFromRendered(n)}},{key:"alignSpace",value:function(){var e=V.floor(this.config.container.clientWidth),t=V.floor(this.config.container.clientHeight);this._space.size(e,t)}},{key:"density",get:function(){return this._mode.current.size}},{key:"blockedType",set:function(e){this._mode.blockedType=e}},{key:"version",get:function(){return this._version}}])&&St(t.prototype,n),r&&St(t,r),i}(r.EventEmitter);It.version="1.0.2"}]).default}));