window.DanmuRender=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=9)}([function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var u=10;function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function f(e,t,n,r){var i,o,a,s;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=c(e))>0&&a.length>i&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,console&&console.warn&&console.warn(s)}return e}function l(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,e))}.bind(r);return i.listener=n,r.wrapFn=i,i}function h(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):p(i,i.length)}function d(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var u=i[e];if(void 0===u)return!1;if("function"==typeof u)o(u,this,t);else{var c=u.length,f=p(u,c);for(n=0;n<c;++n)o(f[n],this,t)}return!0},s.prototype.addListener=function(e,t){return f(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return f(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,l(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,l(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,o,a;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},s.prototype.listenerCount=d,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";t.css=n(2),t.cx=n(3)},function(e,t,n){"use strict";e.exports=function(){throw new Error('Using the "css" tag in runtime is not supported. Make sure you have set up the Babel plugin correctly.')}},function(e,t,n){"use strict";e.exports=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")}},function(e,t,n){var r=n(5);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(7)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(t=e.exports=n(6)(!1)).push([e.i,".c13la550{width:100%;height:100%;overflow:hidden !important;}\n.f12t5uoo{-webkit-filter:drop-shadow(1px 1px #000);filter:drop-shadow(1px 1px #000);}\n.wvyzygh{will-change:transform;}\n.a1482y8w{position:absolute;}\n.d1hkwb6p{position:absolute;box-sizing:border-box;text-align:start;white-space:nowrap;-moz-user-select:none;-o-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-ms-user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-perspective:500px;-moz-perspective:500px;-ms-perspective:500px;perspective:500px;padding:1px 0;font-family:-apple-system,Microsoft Yahei,SimHei,Helvetica Neue,Helvetica,Arial,Hiragino Sans GB,Heiti SC,WenQuanYi Micro Hei,sans-serif;pointer-events:none;}\n.ddz9rme{border:2px solid white;}\n",""]),t.locals={c13la550:"c13la550",f12t5uoo:"f12t5uoo",wvyzygh:"wvyzygh",a1482y8w:"a1482y8w",d1hkwb6p:"d1hkwb6p",ddz9rme:"ddz9rme"}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var i=(a=r,s=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),u="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(u," */")),o=r.sources.map(function(e){return"/*# sourceURL=".concat(r.sourceRoot).concat(e," */")});return[n].concat(o).concat([i]).join("\n")}var a,s,u;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2],"{").concat(n,"}"):n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},i=0;i<this.length;i++){var o=this[i][0];null!=o&&(r[o]=!0)}for(var a=0;a<e.length;a++){var s=e[a];null!=s[0]&&r[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="(".concat(s[2],") and (").concat(n,")")),t.push(s))}},t}},function(e,t,n){var r,i,o={},a=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=r.apply(this,arguments)),i}),s=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var r=function(e,t){return t?t.querySelector(e):document.querySelector(e)}.call(this,e,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),u=null,c=0,f=[],l=n(8);function h(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=o[r.id];if(i){i.refs++;for(var a=0;a<i.parts.length;a++)i.parts[a](r.parts[a]);for(;a<r.parts.length;a++)i.parts.push(b(r.parts[a],t))}else{var s=[];for(a=0;a<r.parts.length;a++)s.push(b(r.parts[a],t));o[r.id]={id:r.id,refs:1,parts:s}}}}function d(e,t){for(var n=[],r={},i=0;i<e.length;i++){var o=e[i],a=t.base?o[0]+t.base:o[0],s={css:o[1],media:o[2],sourceMap:o[3]};r[a]?r[a].parts.push(s):n.push(r[a]={id:a,parts:[s]})}return n}function p(e,t){var n=s(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=f[f.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),f.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=s(e.insertAt.before,n);n.insertBefore(t,i)}}function y(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=f.indexOf(e);t>=0&&f.splice(t,1)}function v(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=function(){0;return n.nc}();r&&(e.attrs.nonce=r)}return m(t,e.attrs),p(e,t),t}function m(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function b(e,t){var n,r,i,o;if(t.transform&&e.css){if(!(o="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=o}if(t.singleton){var a=c++;n=u||(u=v(t)),r=w.bind(null,n,a,!1),i=w.bind(null,n,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",m(t,e.attrs),p(e,t),t}(t),r=function(e,t,n){var r=n.css,i=n.sourceMap,o=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||o)&&(r=l(r));i&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var a=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}.bind(null,n,t),i=function(){y(n),n.href&&URL.revokeObjectURL(n.href)}):(n=v(t),r=function(e,t){var n=t.css,r=t.media;r&&e.setAttribute("media",r);if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}.bind(null,n),i=function(){y(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=a()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=d(e,t);return h(n,t),function(e){for(var r=[],i=0;i<n.length;i++){var a=n[i];(s=o[a.id]).refs--,r.push(s)}e&&h(d(e,t),t);for(i=0;i<r.length;i++){var s;if(0===(s=r[i]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete o[s.id]}}}};var g,_=(g=[],function(e,t){return g[e]=t,g.filter(Boolean).join("\n")});function w(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=_(t,i);else{var o=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var i,o=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?e:(i=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:r+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")})}},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t);var o=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.islive=t,this.danmuMap=[],this.renderMap=new Map,this.danmuSet=new Set,this.IGNORE_SEEK_SECONDS=2,this.lastTime=-1,this._locked=!1,this._blockedConfig={top:!1,bottom:!1,move:!1}}var t,n,o;return t=e,(n=[{key:"updateTime",value:function(e){var t=this;if(this.islive)return this.danmuMap.forEach(function(e){t.renderFilter(e)}),void(this.danmuMap.length=0);var n=e-this.lastTime;this.lastTime=e,n<=0||n>this.IGNORE_SEEK_SECONDS||this.danmuMap.forEach(function(r){var i=e-r.time;t.renderFilter(r,function(){return i>=0&&i<=n&&!r.blocked})})}},{key:"add",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._locked&&this.islive||(Array.isArray(e)?e:[e]).forEach(function(e){t.danmuSet.has(e.id)||(t.danmuSet.add(e.id),t.danmuMap.push(e),n&&t.renderFilter(e))})}},{key:"removeFromRendered",value:function(e){var t=this;e.forEach(function(e){t.renderMap.has(e.id)&&t.renderMap.delete(e.id)})}},{key:"removeAllRendered",value:function(){this.renderMap.clear(),this.islive&&(this.danmuMap.length=0)}},{key:"clear",value:function(){this.danmuMap.length=0,this.renderMap.clear()}},{key:"renderFilter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};this.renderVaild(e)&&t()&&(e.renderInit=Date.now(),this.renderMap.set(e.id,e))}},{key:"renderVaild",value:function(e){return!e.blocked&&!this._blockedConfig[e.mode]&&!this.renderMap.has(e.id)}},{key:"blockedType",set:function(e){var t=this;this._blockedConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){r(e,t,n[t])})}return e}({},this._blockedConfig,"boolean"==typeof e?{top:e,move:e,bottom:e}:e),this.danmuMap.map(function(e){return e.blocked=t._blockedConfig[e.mode],e})}},{key:"locked",set:function(e){this._locked=e}},{key:"current",get:function(){return this.renderMap}}])&&i(t.prototype,n),o&&i(t,o),e}(),a=n(0),s=n.n(a);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h="timeUpdate",d=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=c(this,f(t).apply(this,arguments)))._playing=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,s.a),t}();function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=v(this,m(t).apply(this,arguments))).destroy=function(){e.detach()},e.pause=function(){e._playing=!1},e.resume=function(){e._playing=!0},e.timeupdate=function(){e._playing&&e.emit(h,e._media.currentTime)},e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,d),n=t,(r=[{key:"attach",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._media=e,this.addMediaListeners(),this._playing=t}},{key:"detach",value:function(){this.removeMediaListeners(),this._media=null}},{key:"addMediaListeners",value:function(){this._media.addEventListener("timeupdate",this.timeupdate)}},{key:"removeMediaListeners",value:function(){this._media.removeEventListener("timeupdate",this.timeupdate)}}])&&y(n.prototype,r),i&&y(n,i),t}();function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var x,T=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=E(this,k(t).apply(this,arguments))).INTERVAL=300,e._attachTime=0,e.destroy=function(){e.detach()},e.pause=function(){e._playing=!1},e.resume=function(){e._playing=!0},e.timeupdate=function(){e._playing&&e.emit(h,(Date.now()-e._attachTime)/1e3)},e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(t,d),n=t,(r=[{key:"attach",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._playing=t,this._attachTime=Date.now(),this._timerTask=setInterval(this.timeupdate,this.INTERVAL)}},{key:"detach",value:function(){clearInterval(this._timerTask),this._timerTask=null}}])&&w(n.prototype,r),i&&w(n,i),t}();function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.ATTACH="attach",e.DETACH="detach",e.PAUSE="pause",e.RESUME="resume",e.DESTROY="destroy",e.TIME_UPDATE="timeUpdate"}(x||(x={}));var j=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"live";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this._playing=!1,this._destroyed=!1,this.createTypedRunner(),this.fire=this._runner.emit.bind(this),this.on=this._runner.on.bind(this),this.once=this._runner.once.bind(this),this.off=this._runner.off.bind(this)}var t,n,r;return t=e,(n=[{key:"attach",value:function(e){this._runner.attach(e),this._playing=!0,this.fire(x.ATTACH)}},{key:"detach",value:function(){this._runner.detach(),this.fire(x.DETACH)}},{key:"pause",value:function(){!this._destroyed&&this._playing&&(this._runner.pause(),this._playing=!1,this.fire(x.PAUSE,this._playing))}},{key:"resume",value:function(){this._destroyed||this._playing||(this._runner.resume(),this._playing=!0,this.fire(x.RESUME,this._playing))}},{key:"toggle",value:function(){this._destroyed||(this._playing?(this._runner.pause(),this.fire(x.PAUSE,!1)):(this._runner.resume(),this.fire(x.RESUME,!0)),this._playing=!this._playing)}},{key:"destroy",value:function(){this._runner.removeAllListeners(),this._runner.destroy(),this._playing=!1,this._destroyed=!0,this.fire(x.DESTROY)}},{key:"createTypedRunner",value:function(){var e=this;"vod"===this.type?this._runner=new g:this._runner=new T,this._runner.on(h,function(t){e.fire(x.TIME_UPDATE,t)})}}])&&S(t.prototype,n),r&&S(t,r),e}();function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"destroy",value:function(){this._container.innerHTML=""}}])&&P(t.prototype,n),r&&P(t,r),e}(),M={random:function(){return Number(crypto.getRandomValues(new Uint8Array(1)))/254},randomInt:function(e){return this.floor(this.random()*e)},ceil:function(e){return Math.ceil(e)},floor:function(e){return Math.floor(e)}},R=(n(1),"-apple-system, Microsoft Yahei, SimHei, Helvetica Neue, Helvetica, Arial, \nHiragino Sans GB, Heiti SC, WenQuanYi Micro Hei,sans-serif");function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t){return!t||"object"!==I(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function H(e){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n(4);var N=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),C(this,H(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,L),n=t,(r=[{key:"attach",value:function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._container=e,e.classList.remove("f12t5uoo"),this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.classList.add("a1482y8w"),this._ctx=this._canvas.getContext("2d")),this._container.append(this._canvas),this.alignCanvas()}},{key:"drawDanmus",value:function(e){var t=this;e.forEach(function(e,n){t.renderAt(n,e)})}},{key:"reset",value:function(){!this.alignCanvas()&&this._ctx&&(/Firefox/gi.test(navigator.userAgent)?this._canvas.width=this._canvas.width:this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height))}},{key:"clearRendered",value:function(){this._ctx&&this._canvas&&this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)}},{key:"renderAt",value:function(e,t){this._ctx&&e.render&&this._ctx.drawImage(e.render,t.point.x,t.point.y)}},{key:"alignCanvas",value:function(){if(this._container){var e=M.floor(this._container.clientWidth),t=M.floor(this._container.clientHeight);if(this._canvas.width!==e||this._canvas.height!==t)return this._canvas.width=e,this._canvas.height=t,!0}return!1}}])&&A(n.prototype,r),i&&A(n,i),t}();function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function D(e){return[14,20,26].reduce(function(t,n){var r=e-n;return r>0&&r<t.distance?{distance:Math.abs(n-e),size:n}:t},{distance:Number.MAX_VALUE,size:e}).size}var F=function(e){return e.toString(16).padStart(6,"000000")},G=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._canvasPool=[]}var t,n,r;return t=e,(n=[{key:"create",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._htmlLine||this.createMeasureSpan();var r=(t=this._canvasPool.length>0?this._canvasPool.shift():document.createElement("canvas")).getContext("2d");if(r){var i=e.message.length>35?e.message.substr(0,35)+"...":e.message,o=this.calc(i,{ctx:r,fontSize:"".concat(D(e.size),"px"),textBaseline:"middle",textAlign:"start",border:n});t.width=o.width,t.height=o.height,r.clearRect(0,0,t.width,t.height),r.font="".concat(D(e.size),"px ").concat(R),r.fillStyle="#".concat(F(e.color)),/Safari/gi.test(navigator.userAgent)?(r.shadowColor="#000",r.shadowBlur=0,r.shadowOffsetX=r.shadowOffsetY=1):r.filter="drop-shadow(1px 1px #000)",r.textBaseline="middle",r.textAlign="start";r.fillText(i,n?1:0,M.floor(.5*o.height)+(n?1:0)),n&&(r.strokeStyle="white",r.lineWidth=2,r.strokeRect(1,1,o.width-2,o.height-2)),e.render=t}}},{key:"recyle",value:function(e){e.render&&(this._canvasPool.push(e.render),delete e.render)}},{key:"calc",value:function(e,t){var n=t.ctx,r=t.fontSize,i=t.textBaseline,o=t.textAlign,a=t.border,s=void 0!==a&&a;this._htmlLine.innerText=e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),this._htmlLine.style.fontSize=r,s?this._htmlLine.classList.add("ddz9rme"):this._htmlLine.classList.remove("ddz9rme"),document.body.appendChild(this._htmlLine);var u=this._htmlLine.getBoundingClientRect(),c=u.width,f=u.height;this._htmlLine.remove(),n.font="".concat(r," ").concat(R),n.textBaseline=i,n.textAlign=o;var l=n.measureText(e);return{width:Math.max(l.width,c),height:Math.min(40,f)}}},{key:"createMeasureSpan",value:function(){this._htmlLine=document.createElement("span"),this._htmlLine.classList.add("d1hkwb6p","f12t5uoo")}}])&&U(t.prototype,n),r&&U(t,r),e}());function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Y(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var K=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Y(this,q(t).apply(this,arguments))).itemsPool=[],e.itemsRender=new Map,e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(t,L),n=t,(r=[{key:"attach",value:function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._container=e,e.classList.add("f12t5uoo")}},{key:"drawDanmus",value:function(e){var t=this,n=document.createDocumentFragment();e.forEach(function(e,r){var i;t.itemsRender.has(e)?i=t.itemsRender.get(e):((i=t.getElement()).classList.add("wvyzygh"),i.style.color="#".concat(F(r.color)),i.style.fontSize="".concat(D(r.size),"px"),i.innerText=r.message,n.appendChild(i),t.itemsRender.set(e,i)),i.style.transform="translate(".concat(Math.round(e.point.x),"px, ").concat(Math.round(e.point.y),"px)")}),this._container.appendChild(n)}},{key:"clearRendered",value:function(){this._container.innerHTML=""}},{key:"reset",value:function(){var e=this;this.itemsRender.forEach(function(t,n){n.needRemove&&(e.itemsPool.push(t),e.itemsRender.delete(n),t.remove(),t.removeAttribute("style"),t.classList.remove("wvyzygh"))})}},{key:"getElement",value:function(){var e;return 0===this.itemsPool.length?(e=document.createElement("span")).classList.add("d1hkwb6p"):e=this.itemsPool.shift(),e}}])&&V(n.prototype,r),i&&V(n,i),t}();function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var J=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"canvas";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.createTypedRender()}var t,n,r;return t=e,(n=[{key:"drawDanmus",value:function(e){this._render.drawDanmus(e)}},{key:"reset",value:function(){this._render.reset()}},{key:"attach",value:function(e){this._render.attach(e),e.classList.add("c13la550")}},{key:"destroy",value:function(){this._render.destroy()}},{key:"clearRendered",value:function(){this._render.clearRendered()}},{key:"createTypedRender",value:function(){"css"===this.type?this._render=new K:this._render=new N}}])&&$(t.prototype,n),r&&$(t,r),e}();function Q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function X(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Z=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._size={width:0,height:0},this.lineMap=new Map,this._maxLineInViewPort=0,this.LINE_HEIGHT=40,this.rendered=new Map,this.prepareInit()}var t,n,r;return t=e,(n=[{key:"findNodeUnderPoint",value:function(e){var t=this.getIndexByYpos(e.y),n=!0,r=!1,i=void 0;try{for(var o,a=Array.from(this.rendered).reverse()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=Q(o.value,2),u=s[0],c=s[1];if(c.lineIndex===t){var f=e.x-c.point.x;if(f>0&&f<c.size.width)return u}}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return null}},{key:"getNode",value:function(e){return this.rendered.get(e)}},{key:"measure",value:function(e){return e.render?{width:e.render.width,height:e.render.height}:{width:0,height:0}}},{key:"remove",value:function(e){if(!this.rendered.has(e))return!1;this.rendered.delete(e);var t=!0,n=!1,r=void 0;try{for(var i,o=this.lineMap[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=Q(i.value,2),s=a[0],u=a[1];if("EMPTY"!==u&&u.danmuVo===e)return this.lineMap.set(s,"EMPTY"),!0}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return!1}},{key:"clear",value:function(){var e=this;this.rendered.clear(),this.lineMap.forEach(function(t,n){return e.lineMap.set(n,"EMPTY")})}},{key:"prepareInit",value:function(){for(var e=0;e<80;++e)this.lineMap.set(e,"EMPTY")}},{key:"getIndexByYpos",value:function(e){return M.floor(e/this.LINE_HEIGHT)}},{key:"size",set:function(e){var t=e.height,n=e.width;this._size.width=n,this._size.height=t,this._maxLineInViewPort=M.floor(t/this.LINE_HEIGHT)}},{key:"width",get:function(){return this._size.width}},{key:"height",get:function(){return this._size.height}}])&&X(t.prototype,n),r&&X(t,r),e}();function ee(e){return(ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function re(e,t){return!t||"object"!==ee(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ie(e,t,n){return(ie="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=oe(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function oe(e){return(oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var se=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=re(this,oe(t).apply(this,arguments))).duration=4e3,e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}(t,Z),n=t,(r=[{key:"update",value:function(e){for(var t=this.rendered.values();;){var n=t.next(),r=n.done,i=n.value;if(r)break;i.established+=e;var o=this.measure(i.danmuVo);i.point.x=M.floor((this.width-o.width)/2),i.point.y=M.floor(this.height-(i.lineIndex+1)*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-o.height)),i.needRemove=i.established>=this.duration}}},{key:"flush",value:function(){this.update(0)}},{key:"add",value:function(e){if(this.rendered.has(e))return!1;var t=this.getFreeline(),n=this.measure(e),r=Date.now()-(e.renderInit||Date.now()),i={point:{x:M.floor((this.width-n.width)/2),y:M.floor(this.height-(t+1)*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-n.height))},size:n,established:r,speed:6,danmuVo:e,lineIndex:t,needRemove:r>=this.duration};return!i.needRemove&&(this.rendered.set(e,i),this.lineMap.set(t,i),!0)}},{key:"getFreeline",value:function(){for(var e=this.lineMap.entries();;){var t=e.next(),n=t.done,r=te(t.value,2),i=r[0],o=r[1];if(n||i>=this._maxLineInViewPort)break;if("EMPTY"===o)return i}return M.randomInt(this._maxLineInViewPort)}},{key:"getIndexByYpos",value:function(e){return ie(oe(t.prototype),"getIndexByYpos",this).call(this,this.height-e)}}])&&ne(n.prototype,r),i&&ne(n,i),t}();function ue(e){return(ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function le(e,t){return!t||"object"!==ue(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function de(e,t){return(de=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pe=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=le(this,he(t).apply(this,arguments))).SPEED=100,e.STEP=10,e.GAP=30,e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&de(e,t)}(t,Z),n=t,(r=[{key:"getFreeline",value:function(e){for(var t=this.lineMap.entries();;){var n=t.next(),r=n.done,i=n.value;if(r)break;var o=ce(i,2),a=o[0],s=o[1];if(a>=this._maxLineInViewPort)break;if("EMPTY"===s)return a;if(M.floor(this.width-e*(this.SPEED+this.STEP*a)/1e3)-(s.point.x+s.size.width)>this.GAP)return a}return M.randomInt(this._maxLineInViewPort)}},{key:"update",value:function(e){for(var t=this.rendered.values();;){var n=t.next(),r=n.done,i=n.value;if(r)break;i.established+=e,i.point.x=M.floor(this.width-i.established*i.speed/1e3),i.needRemove=i.point.x<-i.size.width}}},{key:"flush",value:function(){this.update(0)}},{key:"add",value:function(e){if(this.rendered.has(e))return!1;var t=Date.now()-(e.renderInit||Date.now()),n=this.getFreeline(t),r=this.SPEED+this.STEP*(n%3),i={x:M.floor(this.width-t*r/1e3),y:n*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-e.size)},o={width:e.render?e.render.width:0,height:e.size},a={point:i,size:o,established:t,speed:r,danmuVo:e,lineIndex:n,needRemove:i.x<-o.width};return!a.needRemove&&(this.rendered.set(e,a),this.lineMap.set(n,a),!0)}}])&&fe(n.prototype,r),i&&fe(n,i),t}();function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ve(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function be(e,t){return!t||"object"!==ye(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _e(e,t){return(_e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var we,Ee=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=be(this,ge(t).apply(this,arguments))).duration=4e3,e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_e(e,t)}(t,Z),n=t,(r=[{key:"update",value:function(e){for(var t=this.rendered.values();;){var n=t.next(),r=n.done,i=n.value;if(r)break;i.established+=e;var o=this.measure(i.danmuVo);i.point.x=M.floor((this.width-o.width)/2),i.point.y=M.floor(i.lineIndex*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-o.height)),i.needRemove=i.established>=this.duration}}},{key:"flush",value:function(){this.update(0)}},{key:"add",value:function(e){if(this.rendered.has(e))return!1;var t=this.getFreeline(),n=this.measure(e),r=Date.now()-(e.renderInit||Date.now()),i={point:{x:M.floor((this.width-n.width)/2),y:M.floor(t*this.LINE_HEIGHT+M.floor(this.LINE_HEIGHT-n.height))},size:n,established:r,speed:6,danmuVo:e,lineIndex:t,needRemove:r>=this.duration};return!i.needRemove&&(this.rendered.set(e,i),this.lineMap.set(t,i),!0)}},{key:"getFreeline",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var e=this.lineMap.entries();;){var t=e.next(),n=t.done,r=ve(t.value,2),i=r[0],o=r[1];if(n||i>=this._maxLineInViewPort)break;if("EMPTY"===o)return i}return M.randomInt(this._maxLineInViewPort)}}])&&me(n.prototype,r),i&&me(n,i),t}(),ke=requestAnimationFrame||webkitRequestAnimationFrame||mozRequestAnimationFrame||oRequestAnimationFrame||msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)},Oe=cancelAnimationFrame||webkitCancelAnimationFrame||mozCancelAnimationFrame||msCancelAnimationFrame||oCancelAnimationFrame||function(e){clearTimeout(e)},xe={raf:ke.bind(window),caf:Oe.bind(window)};function Te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.BOTTOM="bottom",e.TOP="top",e.MOVE="move"}(we||(we={}));var je=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.controlers=new Map,this.preTime=-1,this._pausedGap=0,this._paused=!1,this._size={width:0,height:0},this.update=function(){if(!t._paused){var e=Date.now();t.controlers.forEach(function(n){n.update(e-t.preTime-t._pausedGap)}),t._pausedGap=0,t.preTime=e,t.rafid=xe.raf(t.update)}},this.createControler()}var t,n,r;return t=e,(n=[{key:"addToControler",value:function(e){this.controlers.has(e.mode)&&this.controlers.get(e.mode).add(e)}},{key:"getNode",value:function(e){if(this.controlers.has(e.mode))return this.controlers.get(e.mode).getNode(e)}},{key:"remvoeFromControler",value:function(e){this.controlers.has(e.mode)&&this.controlers.get(e.mode).remove(e)}},{key:"findNodeUnderPoint",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this.controlers[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=Te(i.value,2)[1].findNodeUnderPoint(e);if(a)return a}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"clear",value:function(){this.controlers.forEach(function(e){e.clear()})}},{key:"size",value:function(e,t){return(e!==this._size.width||t!==this._size.height)&&(this.controlers.forEach(function(n){return n.size={width:e,height:t}}),this._size.width=e,this._size.height=t,this.flush(),!0)}},{key:"pause",value:function(){this._paused||(this._pausedGap=Date.now(),this._paused=!0),xe.caf(this.rafid)}},{key:"resume",value:function(){this._paused&&(this._pausedGap=Date.now()-this._pausedGap,this._paused=!1),xe.caf(this.rafid),this.update()}},{key:"toggle",value:function(){this._paused?this.resume():this.pause()}},{key:"createControler",value:function(){this.controlers.set(we.BOTTOM,new se),this.controlers.set(we.MOVE,new pe),this.controlers.set(we.TOP,new Ee),this.update()}},{key:"flush",value:function(){this.controlers.forEach(function(e){e.flush()})}}])&&Se(t.prototype,n),r&&Se(t,r),e}();function Pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"default",function(){return Ae});var Me=function(){return"hidden"in document?"hidden":(["webkit","moz","ms","o"].some(function(t){return"".concat(t,"Hidden")in document&&(e="".concat(t,"Hidden"),!0)}),e);var e},Re=function(){var e=Me();return!!e&&document[e]},Ie=5e3,Ae=function(){function e(t){var n=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._destroyed=!1,this._actived=!0,this.timeupdate=function(e){n._actived&&n._mode.updateTime(e)},this.activeHandler=function(){Re()?n._clearTask=setTimeout(function(){n.pause(),n._space.clear(),n._mode.removeAllRendered(),n._mode.locked=!0,n._render.clearRendered(),n._actived=!1},Ie):(clearTimeout(n._clearTask),n._actived||(n.resume(),n._mode.locked=!1,n._actived=!0))},this.update=function(){n.drawToCanvas(),n._rafid=xe.raf(n.update)},this.config=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Pe(e,t,n[t])})}return e}({},{islive:!0,renderType:"canvas"},t),!(this.config.container&&this.config.container instanceof HTMLDivElement))throw new Error("\u9700\u8981\u6307\u5b9acontainer\u6e32\u67d3\u5bb9\u5668");if(!(this.config.islive||this.config.video&&this.config.video instanceof HTMLVideoElement))throw new Error("\u70b9\u64ad\u6a21\u5f0f\u9700\u8981\u6307\u5b9avideo\u53c2\u6570\uff0c\u7528\u4e8e\u9a71\u52a8\u5f39\u5e55\u6570\u636e");this._mode=new o(this.config.islive),this._space=new je,this.createRunner(this.config.islive?"live":"vod",this.config.video),this.createRender(this.config.renderType,this.config.container),this.start()}var t,n,r;return t=e,(n=[{key:"add",value:function(e){this._mode.add(e)}},{key:"pause",value:function(){this._destroyed||(this._runner.pause(),this._space.pause())}},{key:"resume",value:function(){this._destroyed||(this._runner.resume(),this._space.resume())}},{key:"toggle",value:function(){this._destroyed||(this._runner.toggle(),this._space.toggle())}},{key:"destroy",value:function(){this._runner.destroy(),this._render.destroy(),this._mode.clear(),this._destroyed=!0,this.stop()}},{key:"createRunner",value:function(e,t){this._runner=new j(e),this._runner.attach(t),this._runner.on(x.TIME_UPDATE,this.timeupdate)}},{key:"createRender",value:function(e,t){this._render=new J(e),this._render.attach(t)}},{key:"start",value:function(){xe.caf(this._rafid),this.addActiveHandler(),this.update()}},{key:"stop",value:function(){xe.caf(this._rafid),this.addActiveHandler(!0)}},{key:"addActiveHandler",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Me();if(t){var n=t.replace(/[H|h]idden/,"")+"visibilitychange";e?document.removeEventListener(n,this.activeHandler):document.addEventListener(n,this.activeHandler)}}},{key:"drawToCanvas",value:function(){var e=this,t=new Map,n=[];this._render.reset(),this.alignSpace(),this._mode.current.forEach(function(r){r.render||G.create(r),e._space.addToControler(r);var i=e._space.getNode(r);i?i.needRemove?(e._space.remvoeFromControler(r),G.recyle(r),n.push(r)):t.set(r,i):n.push(r)}),this._render.drawDanmus(t),n.length>0&&this._mode.removeFromRendered(n)}},{key:"alignSpace",value:function(){var e=M.floor(this.config.container.clientWidth),t=M.floor(this.config.container.clientHeight);this._space.size(e,t)}},{key:"density",get:function(){return this._mode.current.size}},{key:"blockedType",set:function(e){this._mode.blockedType=e}}])&&Le(t.prototype,n),r&&Le(t,r),e}();Ae.version="1.0.0"}]).default;