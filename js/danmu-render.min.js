window.DanmuRender=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=6)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={random:function(){return Number(crypto.getRandomValues(new Uint8Array(1)))/254},randomInt:function(t){return this.floor(this.random()*t)},ceil:function(t){return Math.ceil(t)},floor:function(t){return Math.floor(t)}}},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=o(n(9));e.TIME_UPTATE="timeUpdate";var a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._playing=!1,e}return i(e,t),e}(s.default);e.default=a},function(t,e,n){"use strict";var r=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}},i=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=o(n(0)),a=function(){function t(){this._size={width:0,height:0},this.lineMap=new Map,this._maxLineInViewPort=0,this.LINE_HEIGHT=40,this.rendered=new Map,this.prepareInit()}return t.prototype.findNodeUnderPoint=function(t){var e,n,o=this.getIndexByYpos(t.y);try{for(var s=r(Array.from(this.rendered).reverse()),a=s.next();!a.done;a=s.next()){var u=i(a.value,2),h=u[0],f=u[1];if(f.lineIndex===o){var c=t.x-f.point.x;if(c>0&&c<f.size.width)return h}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return null},t.prototype.getNode=function(t){return this.rendered.get(t)},t.prototype.measure=function(t){return t.render?{width:t.render.width,height:t.render.height}:{width:0,height:0}},t.prototype.remove=function(t){var e,n;if(!this.rendered.has(t))return!1;this.rendered.delete(t);try{for(var o=r(this.lineMap),s=o.next();!s.done;s=o.next()){var a=i(s.value,2),u=a[0],h=a[1];if("EMPTY"!==h&&h.danmuVo===t)return this.lineMap.set(u,"EMPTY"),!0}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return!1},t.prototype.clear=function(){var t=this;this.rendered.clear(),this.lineMap.forEach(function(e,n){return t.lineMap.set(n,"EMPTY")})},Object.defineProperty(t.prototype,"size",{set:function(t){var e=t.height,n=t.width;this._size.width=n,this._size.height=e,this._maxLineInViewPort=s.default.floor(e/this.LINE_HEIGHT)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._size.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._size.height},enumerable:!0,configurable:!0}),t.prototype.prepareInit=function(){for(var t=0;t<80;++t)this.lineMap.set(t,"EMPTY")},t.prototype.getIndexByYpos=function(t){return s.default.floor(t/this.LINE_HEIGHT)},t}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.prototype.destroy=function(){this._container.innerHTML=""},t}();e.default=r},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0));function o(t){return[14,20,26].reduce(function(e,n){var r=t-n;return r>0&&r<e.distance?{distance:Math.abs(n-t),size:n}:e},{distance:Number.MAX_VALUE,size:t}).size}function s(t){var e=t.toString(16);return("000000".substring(0,"000000".length-e.length)+e).toLocaleUpperCase()}e.xssEncode=function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},e.correct=o,e.toHex=s;var a=function(){function t(){this._canvasPool=[]}return t.prototype.create=function(t,e){var n;void 0===e&&(e=!1),this._htmlLine||this.createMeasureSpan();var r=(n=this._canvasPool.length>0?this._canvasPool.shift():document.createElement("canvas")).getContext("2d");if(r){var a=t.message.length>35?t.message.substr(0,35)+"...":t.message,u=this.calc(a,{ctx:r,font:o(t.size)+"px Microsoft Yahei, Helvetica Neue, Helvetica, Arial, Hiragino Sans GB, Heiti SC, WenQuanYi Micro Hei, sans-serif",textBaseline:"middle",textAlign:"start",border:e});n.width=u.width,n.height=u.height,r.clearRect(0,0,n.width,n.height),r.font=o(t.size)+"px Microsoft Yahei, Helvetica Neue, Helvetica, Arial, Hiragino Sans GB, Heiti SC, WenQuanYi Micro Hei, sans-serif",r.fillStyle="#"+s(t.color),r.filter="drop-shadow(1px 1px #000)",r.textBaseline="middle",r.textAlign="start";r.fillText(a,e?1:0,i.default.floor(.5*u.height)+(e?1:0)),e&&(r.strokeStyle="white",r.lineWidth=2,r.strokeRect(1,1,u.width-2,u.height-2)),t.render=n}},t.prototype.recyle=function(t){t.render&&(this._canvasPool.push(t.render),delete t.render)},t.prototype.calc=function(t,n){var r=n.ctx,i=n.font,o=n.textBaseline,s=n.textAlign,a=n.border,u=void 0!==a&&a;this._htmlLine.innerText=e.xssEncode(t),this._htmlLine.style.font=i,u&&(this._htmlLine.style.border="2px solid white"),document.body.appendChild(this._htmlLine);var h=this._htmlLine.getBoundingClientRect(),f=h.width,c=h.height;this._htmlLine.remove(),r.font=i,r.textBaseline=o,r.textAlign=s;var l=r.measureText(t);return{width:Math.max(l.width,f),height:Math.min(40,c)}},t.prototype.createMeasureSpan=function(){this._htmlLine=document.createElement("span"),this._htmlLine.style.boxSizing="border-box",this._htmlLine.style.textAlign="start",this._htmlLine.style.whiteSpace="nowrap",this._htmlLine.style.font="Microsoft Yahei, Helvetica Neue, Helvetica, Arial, Hiragino Sans GB, Heiti SC, WenQuanYi Micro Hei, sans-serif"},t}();e.default=new a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=requestAnimationFrame||webkitRequestAnimationFrame||mozRequestAnimationFrame||oRequestAnimationFrame||msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},i=cancelAnimationFrame||webkitCancelAnimationFrame||mozCancelAnimationFrame||msCancelAnimationFrame||oCancelAnimationFrame||function(t){clearTimeout(t)};e.default={raf:r.bind(window),caf:i.bind(window)}},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var o=r(n(7)),s=i(n(8)),a=r(n(12)),u=r(n(15)),h=r(n(5)),f=r(n(4)),c=r(n(0)),l=function(){function t(t){var e=this;this.config=t,this._destroyed=!1,this.update=function(){e.drawToCanvas(),e._rafid=h.default.raf(e.update)},this._mode=new o.default(t.islive),this._space=new u.default,this.createRunner(t.islive?"live":"vod",t.video),this.createRender(t.renderType,t.container),this.start()}return t.prototype.add=function(t){this._mode.add(t)},t.prototype.pause=function(){this._destroyed||(this._runner.pause(),this._space.pause())},t.prototype.resume=function(){this._destroyed||(this._runner.resume(),this._space.resume())},t.prototype.toggle=function(){this._destroyed||(this._runner.toggle(),this._space.toggle())},t.prototype.destroy=function(){this._runner.destroy(),this._render.destroy(),this._mode.clear(),this._destroyed=!0,this.stop()},t.prototype.createRunner=function(t,e){var n=this;this._runner=new s.default(t),this._runner.attach(e),this._runner.on(s.RunnerEvent.TIME_UPDATE,function(t){n._mode.updateTime(t),n._mode.renderWaitings()})},t.prototype.createRender=function(t,e){this._render=new a.default(t),this._render.attach(e)},t.prototype.start=function(){h.default.caf(this._rafid),this.update()},t.prototype.stop=function(){h.default.caf(this._rafid)},t.prototype.drawToCanvas=function(){var t=this,e=new Map,n=[];this._render.reset(),this.alignSpace(),this._mode.current.forEach(function(r){r.render||f.default.create(r),t._space.addToControler(r);var i=t._space.getNode(r);i?i.needRemove?(t._space.remvoeFromControler(r),f.default.recyle(r),n.push(r)):e.set(r,i):n.push(r)}),this._render.drawDanmus(e),n.length>0&&this._mode.removeFromRendered(n)},t.prototype.alignSpace=function(){var t=c.default.floor(this.config.container.clientWidth),e=c.default.floor(this.config.container.clientHeight);this._space.size(t,e)},t}();e.default=l},function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},o=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t};Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t){void 0===t&&(t=!0),this.islive=t,this.danmuMap=[],this.waitingMap=[],this.renderMap=new Map,this.danmuSet=new Set,this.IGNORE_SEEK_SECOND=2,this.lastTime=-1,this._blockedConfig={top:!1,bottom:!1,move:!1}}return t.prototype.updateTime=function(t){var e,n;if(this.islive)return(e=this.waitingMap).push.apply(e,o(this.danmuMap.filter(function(t){return!t.blocked}))),void(this.danmuMap.length=0);var r=t-this.lastTime;if(this.lastTime=t,!(r<=0||r>this.IGNORE_SEEK_SECOND)){var i=this.danmuMap.filter(function(e){var n=t-e.time;return n>=0&&n<=r&&!e.blocked});(n=this.waitingMap).push.apply(n,o(i))}},t.prototype.renderWaitings=function(){var t=this,e=[];return this.waitingMap.forEach(function(n){n.blocked||(n.renderInit=Date.now(),t.renderMap.set(n.id,n),e.push(n))}),this.clearWaiting(),o(new Set(e))},t.prototype.clearWaiting=function(){this.waitingMap.length=0},Object.defineProperty(t.prototype,"blockedType",{set:function(t){var e=this;this._blockedConfig=r({},this._blockedConfig,t),this.danmuMap.map(function(t){return t.blocked=e._blockedConfig[t.mode],t})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.renderMap},enumerable:!0,configurable:!0}),t.prototype.add=function(t,e){var n=this;void 0===e&&(e=!1),(Array.isArray(t)?t:[t]).forEach(function(t){n.danmuSet.has(t.id)||(n.danmuSet.add(t.id),n.danmuMap.push(t),e&&n.waitingMap.push(t))})},t.prototype.removeFromRendered=function(t){var e=this;t.forEach(function(t){e.renderMap.has(t.id)&&e.renderMap.delete(t.id)})},t.prototype.clear=function(){this.danmuMap.length=0,this.waitingMap.length=0,this.renderMap.clear()},t}();e.default=s},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i,o=n(1),s=r(n(10)),a=r(n(11));!function(t){t.ATTACH="attach",t.DETACH="detach",t.PAUSE="pause",t.RESUME="resume",t.DESTROY="destroy",t.TIME_UPDATE="timeUpdate"}(i=e.RunnerEvent||(e.RunnerEvent={}));var u=function(){function t(t){void 0===t&&(t="live"),this.type=t,this._playing=!1,this._destroyed=!1,this.createTypedRunner(),this.fire=this._runner.emit.bind(this),this.on=this._runner.on.bind(this),this.once=this._runner.once.bind(this),this.off=this._runner.off.bind(this)}return t.prototype.attach=function(t){this._runner.attach(t),this._playing=!0,this.fire(i.ATTACH)},t.prototype.detach=function(){this._runner.detach(),this.fire(i.DETACH)},t.prototype.pause=function(){this._destroyed||(this._runner.pause(),this._playing=!1,this.fire(i.PAUSE,this._playing))},t.prototype.resume=function(){this._destroyed||(this._runner.resume(),this._playing=!0,this.fire(i.RESUME,this._playing))},t.prototype.toggle=function(){this._destroyed||(this._playing?(this._runner.pause(),this.fire(i.PAUSE,!1)):(this._runner.resume(),this.fire(i.PAUSE,!0)),this._playing=!this._playing)},t.prototype.destroy=function(){this._runner.removeAllListeners(),this._runner.destroy(),this._playing=!1,this._destroyed=!0,this.fire(i.DESTROY)},t.prototype.createTypedRunner=function(){var t=this;"vod"===this.type?this._runner=new s.default:this._runner=new a.default,this._runner.on(o.TIME_UPTATE,function(e){t.fire(i.TIME_UPDATE,e)})},t}();e.default=u},function(t,e,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var s=Number.isNaN||function(t){return t!=t};function a(){a.init.call(this)}t.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var u=10;function h(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function f(t,e,n,r){var i,o,s,a;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]),void 0===s)s=o[e]=n,++t._eventsCount;else if("function"==typeof s?s=o[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=h(t))>0&&s.length>i&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=e,u.count=s.length,a=u,console&&console.warn&&console.warn(a)}return t}function c(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=function(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,t))}.bind(r);return i.listener=n,r.wrapFn=i,i}function l(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):p(i,i.length)}function d(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");u=t}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return h(this)},a.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=i[t];if(void 0===u)return!1;if("function"==typeof u)o(u,this,e);else{var h=u.length,f=p(u,h);for(n=0;n<h;++n)o(f[n],this,e)}return!0},a.prototype.addListener=function(t,e){return f(this,t,e,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(t,e){return f(this,t,e,!0)},a.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,c(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,c(this,t,e)),this},a.prototype.removeListener=function(t,e){var n,r,i,o,s;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,s||e)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},a.prototype.listeners=function(t){return l(this,t,!0)},a.prototype.rawListeners=function(t){return l(this,t,!1)},a.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):d.call(t,e)},a.prototype.listenerCount=d,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var s=o(n(1)),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroy=function(){e.detach()},e.pause=function(){e._playing=!1},e.resume=function(){e._playing=!0},e.timeupdate=function(){e._playing&&e.emit(s.TIME_UPTATE,e._media.currentTime)},e}return i(e,t),e.prototype.attach=function(t,e){void 0===e&&(e=!0),this._media=t,this.addMediaListeners(),this._playing=e},e.prototype.detach=function(){this.removeMediaListeners(),this._media=null},e.prototype.addMediaListeners=function(){this._media.addEventListener("timeupdate",this.timeupdate)},e.prototype.removeMediaListeners=function(){this._media.removeEventListener("timeupdate",this.timeupdate)},e}(s.default);e.default=a},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var s=o(n(1)),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.INTERVAL=300,e._attachTime=0,e.destroy=function(){e.detach()},e.pause=function(){e._playing=!1},e.resume=function(){e._playing=!0},e.timeupdate=function(){e._playing&&e.emit(s.TIME_UPTATE,(Date.now()-e._attachTime)/1e3)},e}return i(e,t),e.prototype.attach=function(t,e){void 0===e&&(e=!0),this._playing=e,this._attachTime=Date.now(),this._timerTask=setInterval(this.timeupdate,this.INTERVAL)},e.prototype.detach=function(){clearInterval(this._timerTask),this._timerTask=null},e}(s.default);e.default=a},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(13)),o=r(n(14)),s=function(){function t(t){void 0===t&&(t="canvas"),this.type=t,this.createTypedRender()}return t.prototype.drawDanmus=function(t){this._render.drawDanmus(t)},t.prototype.reset=function(){this._render.reset()},t.prototype.attach=function(t){this._render.attach(t),t.style.setProperty("position","relative","important")},t.prototype.destroy=function(){this._render.destroy()},t.prototype.createTypedRender=function(){"css"===this.type?this._render=new o.default:this._render=new i.default},t}();e.default=s},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=o(n(3)),a=o(n(0)),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.attach=function(t,e){void 0===e&&(e=!0),this._container=t,this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._ctx=this._canvas.getContext("2d")),this._container.append(this._canvas),this.alignCanvas()},e.prototype.drawDanmus=function(t){var e=this;t.forEach(function(t,n){e.renderAt(n,t)})},e.prototype.reset=function(){this.alignCanvas()||this._ctx&&this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)},e.prototype.renderAt=function(t,e){this._ctx&&t.render&&this._ctx.drawImage(t.render,e.point.x,e.point.y)},e.prototype.alignCanvas=function(){if(this._container){var t=a.default.floor(this._container.clientWidth),e=a.default.floor(this._container.clientHeight);if(this._canvas.width!==t||this._canvas.height!==e)return this._canvas.width=t,this._canvas.height=e,!0}return!1},e}(s.default);e.default=u},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=o(n(3)),a=n(4),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemsPool=[],e.itemsRender=new Map,e}return i(e,t),e.prototype.attach=function(t,e){void 0===e&&(e=!0),this._container=t},e.prototype.drawDanmus=function(t){var e=this,n=document.createDocumentFragment();t.forEach(function(t,r){var i;e.itemsRender.has(t)?i=e.itemsRender.get(t):((i=e.getElement()).style.willChange="transform",i.style.padding="1px 0",i.style.color="#"+a.toHex(r.color),i.style.fontSize=a.correct(r.size)+"px",i.setAttribute("danmu-id",r.id),i.innerText=r.message,n.appendChild(i),e.itemsRender.set(t,i)),i.style.transform="translate("+t.point.x+"px, "+t.point.y+"px)"}),this._container.appendChild(n)},e.prototype.reset=function(){var t=this;this.itemsRender.forEach(function(e,n){n.needRemove&&(t.itemsPool.push(e),t.itemsRender.delete(n),e.style.willChange="none",e.remove())})},e.prototype.getElement=function(){var t;return 0===this.itemsPool.length?(t=document.createElement("span")).classList.add("danmu-item"):t=this.itemsPool.shift(),t},e}(s.default);e.default=u},function(t,e,n){"use strict";var r=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}},i=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s,a=o(n(16)),u=o(n(17)),h=o(n(18)),f=o(n(5));!function(t){t.BOTTOM="bottom",t.TOP="top",t.MOVE="move"}(s||(s={}));var c=function(){function t(){var t=this;this.controlers=new Map,this.preTime=-1,this._pausedGap=0,this._paused=!1,this._size={width:0,height:0},this.update=function(){if(!t._paused){var e=Date.now();t.controlers.forEach(function(n){n.update(e-t.preTime-t._pausedGap)}),t._pausedGap=0,t.preTime=e,t.rafid=f.default.raf(t.update)}},this.createControler()}return t.prototype.addToControler=function(t){this.controlers.has(t.mode)&&this.controlers.get(t.mode).add(t)},t.prototype.getNode=function(t){if(this.controlers.has(t.mode))return this.controlers.get(t.mode).getNode(t)},t.prototype.remvoeFromControler=function(t){this.controlers.has(t.mode)&&this.controlers.get(t.mode).remove(t)},t.prototype.findNodeUnderPoint=function(t){var e,n;try{for(var o=r(this.controlers),s=o.next();!s.done;s=o.next()){var a=i(s.value,2)[1].findNodeUnderPoint(t);if(a)return a}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}},t.prototype.clear=function(){this.controlers.forEach(function(t){t.clear()})},t.prototype.size=function(t,e){return(t!==this._size.width||e!==this._size.height)&&(this.controlers.forEach(function(n){return n.size={width:t,height:e}}),this._size.width=t,this._size.height=e,this.flush(),!0)},t.prototype.pause=function(){this._paused||(this._pausedGap=Date.now(),this._paused=!0),f.default.caf(this.rafid)},t.prototype.resume=function(){this._paused&&(this._pausedGap=Date.now()-this._pausedGap,this._paused=!1),f.default.caf(this.rafid),this.update()},t.prototype.toggle=function(){this._paused?this.resume():this.pause()},t.prototype.createControler=function(){this.controlers.set(s.BOTTOM,new a.default),this.controlers.set(s.MOVE,new u.default),this.controlers.set(s.TOP,new h.default),this.update()},t.prototype.flush=function(){this.controlers.forEach(function(t){t.flush()})},t}();e.default=c},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=s(n(2)),u=s(n(0)),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.duration=4e3,e}return i(e,t),e.prototype.update=function(t){for(var e=this.rendered.values();;){var n=e.next(),r=n.done,i=n.value;if(r)break;i.established+=t;var o=this.measure(i.danmuVo);i.point.x=u.default.floor((this.width-o.width)/2),i.point.y=u.default.floor(this.height-(i.lineIndex+1)*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-o.height)),i.needRemove=i.established>=this.duration}},e.prototype.flush=function(){this.update(0)},e.prototype.add=function(t){if(this.rendered.has(t))return!1;var e=this.getFreeline(),n=this.measure(t),r=Date.now()-(t.renderInit||Date.now()),i={point:{x:u.default.floor((this.width-n.width)/2),y:u.default.floor(this.height-(e+1)*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-n.height))},size:n,established:r,speed:6,danmuVo:t,lineIndex:e,needRemove:r>=this.duration};return!i.needRemove&&(this.rendered.set(t,i),this.lineMap.set(e,i),!0)},e.prototype.getFreeline=function(){for(var t=this.lineMap.entries();;){var e=t.next(),n=e.done,r=o(e.value,2),i=r[0],s=r[1];if(n||i>=this._maxLineInViewPort)break;if("EMPTY"===s)return i}return u.default.randomInt(this._maxLineInViewPort)},e.prototype.getIndexByYpos=function(e){return t.prototype.getIndexByYpos.call(this,this.height-e)},e}(a.default);e.default=h},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=s(n(2)),u=s(n(0)),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.SPEED=100,e.STEP=10,e.GAP=30,e}return i(e,t),e.prototype.getFreeline=function(t){for(var e=this.lineMap.entries();;){var n=e.next(),r=n.done,i=n.value;if(r)break;var s=o(i,2),a=s[0],h=s[1];if(a>=this._maxLineInViewPort)break;if("EMPTY"===h)return a;if(u.default.floor(this.width-t*(this.SPEED+this.STEP*a)/1e3)-(h.point.x+h.size.width)>this.GAP)return a}return u.default.randomInt(this._maxLineInViewPort)},e.prototype.update=function(t){for(var e=this.rendered.values();;){var n=e.next(),r=n.done,i=n.value;if(r)break;i.established+=t,i.point.x=u.default.floor(this.width-i.established*i.speed/1e3),i.needRemove=i.point.x<-i.size.width}},e.prototype.flush=function(){this.update(0)},e.prototype.add=function(t){if(this.rendered.has(t))return!1;var e=Date.now()-(t.renderInit||Date.now()),n=this.getFreeline(e),r=this.SPEED+this.STEP*(n%3),i={x:u.default.floor(this.width-e*r/1e3),y:n*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-t.size)},o={width:t.render?t.render.width:0,height:t.size},s={point:i,size:o,established:e,speed:r,danmuVo:t,lineIndex:n,needRemove:i.x<-o.width};return!s.needRemove&&(this.rendered.set(t,s),this.lineMap.set(n,s),!0)},e}(a.default);e.default=h},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=s(n(2)),u=s(n(0)),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.duration=4e3,e}return i(e,t),e.prototype.update=function(t){for(var e=this.rendered.values();;){var n=e.next(),r=n.done,i=n.value;if(r)break;i.established+=t;var o=this.measure(i.danmuVo);i.point.x=u.default.floor((this.width-o.width)/2),i.point.y=u.default.floor(i.lineIndex*this.LINE_HEIGHT+.5*(this.LINE_HEIGHT-o.height)),i.needRemove=i.established>=this.duration}},e.prototype.flush=function(){this.update(0)},e.prototype.add=function(t){if(this.rendered.has(t))return!1;var e=this.getFreeline(),n=this.measure(t),r=Date.now()-(t.renderInit||Date.now()),i={point:{x:u.default.floor((this.width-n.width)/2),y:u.default.floor(e*this.LINE_HEIGHT+u.default.floor(this.LINE_HEIGHT-n.height))},size:n,established:r,speed:6,danmuVo:t,lineIndex:e,needRemove:r>=this.duration};return!i.needRemove&&(this.rendered.set(t,i),this.lineMap.set(e,i),!0)},e.prototype.getFreeline=function(t){void 0===t&&(t=0);for(var e=this.lineMap.entries();;){var n=e.next(),r=n.done,i=o(n.value,2),s=i[0],a=i[1];if(r||s>=this._maxLineInViewPort)break;if("EMPTY"===a)return s}return u.default.randomInt(this._maxLineInViewPort)},e}(a.default);e.default=h}]).default;