<html>
    <head>
        <title>弹幕DEMO测试</title>
        <meta charset="utf-8">
        <script type="text/javascript" src="./js/flv.min.js"></script>
        <script type="text/javascript" src="./js/danmu-render.min.js"></script>
        <style>
            * {
                padding: 0;
                margin: 0;
                box-sizing:border-box;
            }
            .root {
                position: relative;
                width: 900px;
                height: 600px;
                margin: 20px auto;
                background-color: #000;
            }

            .root video {
                width: 100%;
                height: 100%;
            }

            .root .danmu-container {
                width: 100%;
                height: 100%;
                transform: translateY(-100%);
                overflow: hidden !important;
            }

            .danmu-item {
                position: absolute;
                display: block;
                white-space: nowrap;
                user-select: none;
                -moz-user-select: none;
                perspective: 500px;
            }

            .root ul {
                list-style: none;
                position: absolute;
                top: 0;
            }
        </style>
    </head>
    <body>
        <div class='root'>
            <video muted autoplay loop preload="metadata"></video>
            <div class="danmu-container" onclick="toggle()" ></div>
            <ul>
                <li>
                    <button onclick="createCore('css')">css渲染</button>
                </li>
                <li>
                    <button onclick="createCore('canvas')">canvas渲染</button>
                </li>
            </ul>
        </div>
        <script>
            var render, id = 0, task;

            function createCore(type) {
                if(render) {
                    render.destroy();
                    clearInterval(task);
                }
                render = new DanmuRender({
                    islive: true,
                    renderType: type,
                    video: document.querySelector('video'),
                    container: document.querySelector('.danmu-container'),
                    autoStart: true
                });
                start();
            }

            function start() {
                return task = setInterval(function addDanmu() {
                    render.add({
                        id: id++,
                        color: Math.random() * 0xffffff |0,
                        size: ((Math.random() * 20)|0) + 14,
                        mode: ['move', 'top', 'bottom'][Math.random() * 3 | 0],
                        time: 0,
                        message: '测试弹幕'+((Math.random()*100000000)|0)
                    })
                }, 100);
            }

            function toggle() {
                var video = document.querySelector('video');
                if(video.paused) {
                    video.play();
                    render.toggle();
                    start();
                } else {
                    video.pause();
                    render.toggle();
                    clearInterval(task);
                }
            }

            createCore('canvas');

            //播放视频
            if (flvjs.isSupported()) {
                var videoElement = document.querySelector('video');
                var flvPlayer = flvjs.createPlayer({
                    islive: true,
                    type: 'flv',
                    url: './streams/live.flv'
                });
                flvPlayer.attachMediaElement(videoElement);
                flvPlayer.load();
                flvPlayer.play();
            }
        </script>
    </body>
</html>