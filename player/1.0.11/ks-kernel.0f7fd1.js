(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[10],{217:function(e,t,r){window,e.exports=function(e){var t={};function r(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(i,a,function(t){return e[t]}.bind(null,a));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=23)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a="kwai-k",n=!0;function s(e,t){return t&&0!==t.length||(t=[e],e=""),e=n?a+(e?"::"+e:""):e||a,t.unshift("["+e+"] > "),t}var o={LEVEL_ERROR:"e",LEVEL_WARN:"w",LEVEL_INFO:"i",LEVEL_DEBUG:"d",LEVEL_VERBOSE:"v"},u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,null,[{key:"level",value:function(t){switch(e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!1,t){case o.LEVEL_ERROR:e.ENABLE_ERROR=!0;break;case o.LEVEL_WARN:e.ENABLE_ERROR=e.ENABLE_WARN=!0;break;case o.LEVEL_INFO:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=!0;break;case o.LEVEL_DEBUG:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=!0;break;case o.LEVEL_VERBOSE:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!0}}},{key:"e",value:function(t){if(e.ENABLE_ERROR){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];(console.error||console.warn||console.log).apply(console,s(t,i))}}},{key:"w",value:function(t){if(e.ENABLE_WARN){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];(console.warn||console.log).apply(console,s(t,i))}}},{key:"i",value:function(t){if(e.ENABLE_INFO){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];(console.info||console.log).apply(console,s(t,i))}}},{key:"d",value:function(t){if(e.ENABLE_DEBUG){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];(console.debug||console.log).apply(console,s(t,i))}}},{key:"v",value:function(t){if(e.ENABLE_VERBOSE){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];console.log.apply(console,s(t,i))}}}]),e}();u.ENABLE_ERROR=!0,u.ENABLE_WARN=!1,u.ENABLE_INFO=!1,u.ENABLE_DEBUG=!1,u.ENABLE_VERBOSE=!1,t.Log=u,t.LOG_LEVEL=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={METADATA:"metadata",MEDIA_INFO:"mediaInfo",PARSING_INIT_SEGMENT:"parsingInitSegment",PARSING_DATA:"parsingData",SCRIPT_PARSED:"scriptParsed",LOST_FRAMES:"lostFrames",REPORT:"report",END:"end",DISCONTINUITY:"discontinuity",ERROR:"kernelError",LEVEL_SWITCHED:"levelSwitched",LEVEL_LOADED:"levelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",IDR:"idr",HLS_MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"manifestParsed",HLS_LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",HLS_INIT_PTS_FOUND:"hlsInitPtsFound",HLS_FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",HLS_FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",HLS_FRAG_LOADED:"hlsFragLoaded",HLS_FRAG_DECRYPTED:"hlsFragDecrypted",HLS_FRAG_PARSED:"hlsFragParsed",HLS_KEY_LOADED:"hlsKeyLoaded"}},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function a(e){return"object"==typeof e&&null!==e}function n(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,s,o,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var f=new Error('Uncaught, unspecified "error" event. ('+t+")");throw f.context=t,f}if(n(r=this._events[e]))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(a(r))for(o=Array.prototype.slice.call(arguments,1),s=(l=r.slice()).length,u=0;u<s;u++)l[u].apply(this,o);return!0},r.prototype.addListener=function(e,t){var s;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(s=n(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var r=!1;function a(){this.removeListener(e,a),r||(r=!0,t.apply(this,arguments))}return a.listener=t,this.on(e,a),this},r.prototype.removeListener=function(e,t){var r,n,s,o;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(r=this._events[e]).length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(r)){for(o=s;o-- >0;)if(r[o]===t||r[o].listener&&r[o].listener===t){n=o;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError",MSE_ERROR:"mseError"},t.ErrorDetails={LOAD_ERROR:"loadError",LOAD_TIMEOUT:"loadTimeOut",ADDSOURCEBUFFER_ERROR:"addSourceBufferError",SOURCEBUFFER_ERROR:"sourceBufferError",ENDOFSTREAM_ERROR:"endOfStreamError",APPENDBUFFER_ERROR:"appendBufferError",CANNOT_SEEK:"canNotSeek",MEDIASOURCE_ERROR:"mediaSourceError",VIDEO_ERROR:"videoError",HLS_MANIFEST_LOAD_ERROR:"hlsManifestLoadError",HLS_MANIFEST_LOAD_TIMEOUT:"hlsManifestLoadTimeOut",HLS_MANIFEST_PARSING_ERROR:"hlsManifestParsingError",HLS_MANIFEST_INCOMPATIBLE_CODECS_ERROR:"hlsManifestIncompatibleCodecsError",HLS_LEVEL_LOAD_ERROR:"hlsLevelLoadError",HLS_LEVEL_LOAD_TIMEOUT:"hlsLevelLoadTimeOut",HLS_LEVEL_SWITCH_ERROR:"hlsLevelSwitchError",PARSING_ERROR:"parsingError",REMUX_ALLOC_ERROR:"remuxAllocError",REMUX_ERROR:"remuxError",HLS_KEY_LOAD_ERROR:"keyLoadError",HLS_KEY_LOAD_TIMEOUT:"keyLoadTimeOut"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REPORT_TYPES={LOADER_OPEN:"loader-open",LOADER_CHUNK_ARRIVAL:"loader-chunk-arrival",MEDIA_DEMUX_FLV:"media-demux-flv",MEDIA_SEGMENT_INIT:"media-segment-init",MEDIA_INFO:"media-info",MEDIA_SEGMENT:"media-segment",PLAYING:"playing",CANPLAY:"canplay",NEW_SOURCE:"newSource",TIMEUPDATE:"timeupdate",LIVE_ADAPTIVE_QOS_STAT:"liveAdaptiveQosStat",MP_SLICE_LOAD_STAT:"mpSliceLoadStat"}},function(e,t,r){!function(t){var r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,i=/^([^\/;?#]*)(.*)$/,a=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,s={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");return a.path=s.normalizePath(a.path),s.buildURLFromParts(a)}var n=s.parseURL(t);if(!n)throw new Error("Error trying to parse relative URL.");if(n.scheme)return r.alwaysNormalize?(n.path=s.normalizePath(n.path),s.buildURLFromParts(n)):t;var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var u=i.exec(o.path);o.netLoc=u[1],o.path=u[2]}o.netLoc&&!o.path&&(o.path="/");var l={scheme:o.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};if(!n.netLoc&&(l.netLoc=o.netLoc,"/"!==n.path[0]))if(n.path){var f=o.path,d=f.substring(0,f.lastIndexOf("/")+1)+n.path;l.path=s.normalizePath(d)}else l.path=o.path,n.params||(l.params=o.params,n.query||(l.query=o.query));return null===l.path&&(l.path=r.alwaysNormalize?s.normalizePath(n.path):n.path),s.buildURLFromParts(l)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(n,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=s}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._cacheSize=10485760,this._readOffset=0,this._writeOffset=0,this._cacheBuffer=new ArrayBuffer(this._cacheSize),this._cache=new Uint8Array(this._cacheBuffer)}return i(e,[{key:"pushData",value:function(e){if(this._writeOffset+e.byteLength>this._cacheSize){var t=this._writeOffset+e.byteLength-this._readOffset;t>this._cacheSize?(this._collateCache(),this._expandCache(t)):this._collateCache()}this._cache.set(new Uint8Array(e),this._writeOffset),this._writeOffset+=e.byteLength}},{key:"getData",value:function(e){if(e+this._readOffset>this._writeOffset)return null;var t=this._cache.slice(this._readOffset,this._readOffset+e);return this._readOffset+=e,t}},{key:"readData",value:function(e){return e+this._readOffset>this._writeOffset?null:new Uint8Array(this._cacheBuffer,this._readOffset,e)}},{key:"skip",value:function(e){e+this._readOffset>this._writeOffset||(this._readOffset+=e)}},{key:"flush",value:function(){this._readOffset=this._writeOffset=0}},{key:"_collateCache",value:function(){var e=new Uint8Array(this._cacheBuffer,this._readOffset,this._writeOffset-this._readOffset);this._cache.set(e),this._writeOffset-=this._readOffset,this._readOffset=0}},{key:"_expandCache",value:function(e){this._cacheSize=Math.max(2*this._cacheSize,e),this._cacheBuffer=ArrayBuffer.transfer(this._cacheBuffer,this._cacheSize),this._cache=new Uint8Array(this._cacheBuffer)}},{key:"unreadLen",get:function(){return this._writeOffset-this._readOffset}}]),e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(r(8)),n=r(0),s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tag="fetch",this._requestAbort=!1,this._config={timeout:0,maxRetry:0,retryDelay:0,maxRetryDelay:0}}return i(e,null,[{key:"isSupport",value:function(){return!(!self.fetch||!self.ReadableStream)}}]),i(e,[{key:"open",value:function(e,t,r){this._context=e,this._config=r||this._config,this._callbacks=t,this._stats={trequest:performance.now(),retry:0,loaded:0},this._retryDelay=this._config.retryDelay,this._requestAbort=!1;var i=new Headers,n=e.range||{from:0,to:-1};if(-1!==n.to){var s=(0,a.default)(n);for(var o in s)i.append(o,s[o])}this._params={method:"GET",headers:i,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"},r.credentials&&(this._params.credentials="include"),this._loadInternal()}},{key:"pause",value:function(){this._requestAbort=!0}},{key:"destroy",value:function(){this._callbacks=null,this._requestAbort=!0,clearTimeout(this._requestTimeout),this._requestTimeout=null,clearTimeout(this._retryTimeout),this._retryTimeout=null,this._stats.aborted=!0,this._stats.code=null,this.pause()}},{key:"_loadInternal",value:function(){var e=this,t=this._context,r=this._params,i=this._config,a=this._stats;a.tfirst=0,a.loaded=0,clearTimeout(this._retryTimeout),i.timeout&&(this._requestTimeout=setTimeout(this._onTimeout.bind(this),i.timeout)),fetch(t.src,r).then(function(r){if(clearTimeout(e._requestTimeout),e._stats.code=r.status,r.ok)return a.tfirst=Math.max(a.trequest,performance.now()),t.responseUrl=r.responseUrl,"arraybuffer"===t.responseType?t.progress?e._pump(r.body.getReader()):(r.arrayBuffer().then(function(r){a.loaded=a.total=r.byteLength,a.tload=Math.max(a.tfirst,performance.now()),e._callbacks&&e._callbacks.onEnd(t,r,a)}),null):(r.text().then(function(r){a.loaded=a.total=r.length,a.tload=Math.max(a.tfirst,performance.now()),e._callbacks&&e._callbacks.onEnd(t,r,a)}),null);var i=new Error(r.status+" "+r.statusText);return e._onError(i),null}).catch(function(t){n.Log.e(e.tag,t),e._onError(t)})}},{key:"_onError",value:function(e){var t=this._stats,r=this._config;clearTimeout(this._requestTimeout),t.retry>=r.maxRetry||!r.maxRetry?this._callbacks&&this._callbacks.onError(this._context,{code:t.code,text:e.message}):(this.destroy(),t.retry++,this._retryDelay?(this._retryTimeout=setTimeout(this._loadInternal.bind(this),this._retryDelay),this._retryDelay=Math.min(2*this._retryDelay,r.maxRetryDelay)):this._loadInternal())}},{key:"_onTimeout",value:function(){var e=new Error("timeout");this._onError(e)}},{key:"_pump",value:function(e){var t=this,r=this._stats;return e.read().then(function(i){if(i.done)r.tload=Math.max(r.tfirst,performance.now()),r.total=r.loaded,t._callbacks&&t._callbacks.onEnd(t._context,null,r),n.Log.v(t.tag,"load end");else{if(!0===t._requestAbort)return t._requestAbort=!1,e.cancel();var a=i.value.buffer;t._callbacks&&(r.loaded+=a.byteLength,t._callbacks.onProgress(t._context,a,r)),t._pump(e)}return null}).catch(function(e){n.Log.e(t.tag,e),t._onError(e)})}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,r={};return t=-1!==e.to?"bytes="+e.from.toString()+"-"+e.to.toString():"bytes="+e.from.toString()+"-",r.Range=t,r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(r(8)),n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tag="RangeLoader",this._xhr=null,this._chunkSizeKB=524288,this._range={},this._bytesStart=0,this._contentRangeRegExp=new RegExp("content-range: bytes [0-9]+-[0-9]+/([0-9]+)"),this._config={timeout:0,maxRetry:0,retryDelay:0,maxRetryDelay:0}}return i(e,null,[{key:"isSupport",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(e){return!1}}}]),i(e,[{key:"open",value:function(e,t,r){this._context=e,this._callbacks=t,this._config=r||this._config,this._stats={trequest:performance.now(),retry:0,loaded:0},this._retryDelay=this._config.retryDelay,this._loadInternal()}},{key:"pause",value:function(){this.abort()}},{key:"abort",value:function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null),clearTimeout(this._requestTimeout),this._requestTimeout=null,clearTimeout(this._retryTimeout),this._retryTimeout=null,this._stats.aborted=!0}},{key:"destroy",value:function(){this._xhr&&this.abort(),this._bytesStart=null,this._range={}}},{key:"_loadInternal",value:function(){var e=this._context,t=this._stats,r=this._config;t.tfirst=0,t.loaded=0,t.aborted=!1,clearTimeout(this._retryTimeout);var i=this._xhr=new XMLHttpRequest;if(i.open("GET",this._context.src,!0),i.withCredentials=!!r.credentials,i.responseType=e.responseType||"arraybuffer",i.onreadystatechange=this._onReadyStateChange.bind(this),i.onprogress=this._onProgress.bind(this),i.onload=this._onLoad.bind(this),i.onerror=this._onError.bind(this),"arraybuffer"===i.responseType&&e.progress){var n=e.range||{from:0,to:-1};this._range.from=n.from,-1===n.to&&(t.total?n.to=Math.min(t.total-1,n.from+this._chunkSizeKB):n.to=n.from+this._chunkSizeKB),this._bytesStart=n.from,this._range.to=n.to;var s=(0,a.default)(n);for(var o in s)i.setRequestHeader(o,s[o])}r.timeout&&(this._requestTimeout=setTimeout(this._onTimeout.bind(this),r.timeout)),i.send()}},{key:"_onReadyStateChange",value:function(){var e=this._xhr,t=this._stats;t.aborted||e.readyState>=2&&(0===t.tfirst&&(t.tfirst=Math.max(performance.now(),t.trequest)),4===e.readyState&&(clearTimeout(this._requestTimeout),t.tload=Math.max(t.tfirst,performance.now()),(e.status<200||e.status>299)&&this._onError(new Error("xhr error"))))}},{key:"_onTimeout",value:function(){this._onError(new Error("timeout"))}},{key:"_onError",value:function(e){var t=this._stats,r=this._config,i=this._xhr;clearTimeout(this._requestTimeout),t.retry>=r.maxRetry||!r.maxRetry?this._callbacks.onError(this._context,{code:i.status,text:e.message||"xhr error"}):(this.destroy(),t.retry++,this._retryDelay?(this._retryTimeout=setTimeout(this._loadInternal.bind(this),this._retryDelay),this._retryDelay=Math.min(2*this._retryDelay,r.maxRetryDelay)):this._loadInternal())}},{key:"_onProgress",value:function(){}},{key:"_onLoad",value:function(e){var t=e.target.response;this._context.responseUrl=e.target.responseURL;var r=this._stats;if(!r.aborted)if(206===this._xhr.status){this._callbacks&&(r.loaded+=t.byteLength,this._callbacks.onProgress(this._context,t,r));var i=this._xhr.getAllResponseHeaders().match(this._contentRangeRegExp);if(!i||2!==i.length)return void this._onError(new Error("need response content-range"));r.total=parseInt(i[1],10);var a=this._range.from+t.byteLength;r.total&&r.total<=a+1?this._callbacks&&this._callbacks.onEnd(this._context,null,r):(this._context.range.from=a,this._context.range.to=-1,this._loadInternal())}else 200===this._xhr.status&&(r.loaded=r.total=t.byteLength||t.length,this._callbacks&&this._callbacks.onEnd(this._context,t,r))}}]),e}();t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=s(r(8)),n=s(r(2));function s(e){return e&&e.__esModule?e:{default:e}}var o=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.tag="mozChunkLoader",e._xhr=null,e._totalLength=null,e._chunkSizeKB=393216,e._range={},e._bytesStart=0,e._config={timeout:0,maxRetry:0,retryDelay:0,maxRetryDelay:0},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.default),i(t,null,[{key:"isSupport",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(e){return!1}}}]),i(t,[{key:"open",value:function(e,t,r){this.src=e.src,this._callbacks=t,this._context=e,this._config=r||this._config,this._stats={trequest:performance.now(),retry:0,loaded:0},this._retryDelay=this._config.retryDelay,this._loadInternal()}},{key:"pause",value:function(){this.abort()}},{key:"abort",value:function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null),clearTimeout(this._requestTimeout),this._requestTimeout=null,clearTimeout(this._retryTimeout),this._retryTimeout=null}},{key:"destroy",value:function(){this._xhr&&this.abort(),this._totalLength=null,this._bytesStart=null,this._range={}}},{key:"_loadInternal",value:function(){var e=this._context,t=this._stats,r=this._config;t.tfirst=0,t.loaded=0,t.aborted=!1,clearTimeout(this._retryTimeout);var i=this._xhr=new XMLHttpRequest;if(i.open("GET",this.src,!0),i.responseType="moz-chunked-arraybuffer",i.onreadystatechange=this._onReadyStateChange.bind(this),i.onprogress=this._onProgress.bind(this),i.onload=this._onLoadEnd.bind(this),i.onerror=this._onError.bind(this),"moz-chunked-arraybuffer"===i.responseType&&e.progress){var n=e.range||{from:0,to:-1};this._range.from=n.from,this._range.to=n.to;var s=(0,a.default)(n).headers;for(var o in s)i.setRequestHeader(o,s[o])}r.timeout&&(this._requestTimeout=setTimeout(this._onTimeout.bind(this),r.timeout)),i.send()}},{key:"_onReadyStateChange",value:function(){var e=this._xhr,t=this._stats;t.aborted||e.readyState>=2&&(0===t.tfirst&&(t.tfirst=Math.max(performance.now(),t.trequest)),4===e.readyState&&(clearTimeout(this._requestTimeout),t.tload=Math.max(t.tfirst,performance.now()),(e.status<200||e.status>299)&&this._onError(new Error("xhr error"))))}},{key:"_onProgress",value:function(e){var t=this._stats;null!==e.total&&0!==e.total&&(t.total=e.total);var r=e.target.response;this._callbacks&&this._callbacks.onProgress(this._context,r,t),this._bytesStart+=r.byteLength}},{key:"_onLoadEnd",value:function(e){this._context.responseUrl=e.target.responseURL;var t=this._stats;200===this._xhr.status&&this._callbacks&&this._callbacks.onEnd(this._context,null,t)}},{key:"_onError",value:function(e){var t=this._stats,r=this._config,i=this._xhr;clearTimeout(this._requestTimeout),t.retry>=r.maxRetry||!r.maxRetry?this._callbacks&&this._callbacks.onError(this._context,{code:i.status,text:e.message||"xhr error"}):(this.destroy(),t.retry++,this._retryDelay?(this._retryTimeout=setTimeout(this._loadInternal.bind(this),this._retryDelay),this._retryDelay=Math.min(2*this._retryDelay,r.maxRetryDelay)):this._loadInternal())}}]),t}();t.default=o},function(e,t,r){"use strict";(function(t){var i=r(41),a=r(42),n=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,s=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,o=[["#","hash"],["?","query"],function(e){return e.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],u={hash:1,query:1};function l(e){var r,i=t&&t.location||{},a={},n=typeof(e=e||i);if("blob:"===e.protocol)a=new d(unescape(e.pathname),{});else if("string"===n)for(r in a=new d(e,{}),u)delete a[r];else if("object"===n){for(r in e)r in u||(a[r]=e[r]);void 0===a.slashes&&(a.slashes=s.test(e.href))}return a}function f(e){var t=n.exec(e);return{protocol:t[1]?t[1].toLowerCase():"",slashes:!!t[2],rest:t[3]}}function d(e,t,r){if(!(this instanceof d))return new d(e,t,r);var n,s,u,c,h,_,p=o.slice(),v=typeof t,m=this,y=0;for("object"!==v&&"string"!==v&&(r=t,t=null),r&&"function"!=typeof r&&(r=a.parse),t=l(t),n=!(s=f(e||"")).protocol&&!s.slashes,m.slashes=s.slashes||n&&t.slashes,m.protocol=s.protocol||t.protocol||"",e=s.rest,s.slashes||(p[3]=[/(.*)/,"pathname"]);y<p.length;y++)"function"!=typeof(c=p[y])?(u=c[0],_=c[1],u!=u?m[_]=e:"string"==typeof u?~(h=e.indexOf(u))&&("number"==typeof c[2]?(m[_]=e.slice(0,h),e=e.slice(h+c[2])):(m[_]=e.slice(h),e=e.slice(0,h))):(h=u.exec(e))&&(m[_]=h[1],e=e.slice(0,h.index)),m[_]=m[_]||n&&c[3]&&t[_]||"",c[4]&&(m[_]=m[_].toLowerCase())):e=c(e);r&&(m.query=r(m.query)),n&&t.slashes&&"/"!==m.pathname.charAt(0)&&(""!==m.pathname||""!==t.pathname)&&(m.pathname=function(e,t){for(var r=(t||"/").split("/").slice(0,-1).concat(e.split("/")),i=r.length,a=r[i-1],n=!1,s=0;i--;)"."===r[i]?r.splice(i,1):".."===r[i]?(r.splice(i,1),s++):s&&(0===i&&(n=!0),r.splice(i,1),s--);return n&&r.unshift(""),"."!==a&&".."!==a||r.push(""),r.join("/")}(m.pathname,t.pathname)),i(m.port,m.protocol)||(m.host=m.hostname,m.port=""),m.username=m.password="",m.auth&&(c=m.auth.split(":"),m.username=c[0]||"",m.password=c[1]||""),m.origin=m.protocol&&m.host&&"file:"!==m.protocol?m.protocol+"//"+m.host:"null",m.href=m.toString()}d.prototype={set:function(e,t,r){var n=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(r||a.parse)(t)),n[e]=t;break;case"port":n[e]=t,i(t,n.protocol)?t&&(n.host=n.hostname+":"+t):(n.host=n.hostname,n[e]="");break;case"hostname":n[e]=t,n.port&&(t+=":"+n.port),n.host=t;break;case"host":n[e]=t,/:\d+$/.test(t)?(t=t.split(":"),n.port=t.pop(),n.hostname=t.join(":")):(n.hostname=t,n.port="");break;case"protocol":n.protocol=t.toLowerCase(),n.slashes=!r;break;case"pathname":case"hash":if(t){var s="pathname"===e?"/":"#";n[e]=t.charAt(0)!==s?s+t:t}else n[e]=t;break;default:n[e]=t}for(var u=0;u<o.length;u++){var l=o[u];l[4]&&(n[l[1]]=n[l[1]].toLowerCase())}return n.origin=n.protocol&&n.host&&"file:"!==n.protocol?n.protocol+"//"+n.host:"null",n.href=n.toString(),n},toString:function(e){e&&"function"==typeof e||(e=a.stringify);var t,r=this,i=r.protocol;i&&":"!==i.charAt(i.length-1)&&(i+=":");var n=i+(r.slashes?"//":"");return r.username&&(n+=r.username,r.password&&(n+=":"+r.password),n+="@"),n+=r.host+r.pathname,(t="object"==typeof r.query?e(r.query):r.query)&&(n+="?"!==t.charAt(0)?"?"+t:t),r.hash&&(n+=r.hash),n}},d.extractProtocol=f,d.location=l,d.qs=a,e.exports=d}).call(this,r(40))},function(e,t,r){function i(e){var t={};function r(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var i=r(r.s=ENTRY_MODULE);return i.default||i}var a="[\\.|\\-|\\+|\\w|/|@]+",n="\\((/\\*.*?\\*/)?s?.*?("+a+").*?\\)";function s(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e){return!isNaN(1*e)}function u(e,t,i){var u={};u[i]=[];var l=t.toString(),f=l.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!f)return u;for(var d,c=f[1],h=new RegExp("(\\\\n|\\W)"+s(c)+n,"g");d=h.exec(l);)"dll-reference"!==d[3]&&u[i].push(d[3]);for(h=new RegExp("\\("+s(c)+'\\("(dll-reference\\s('+a+'))"\\)\\)'+n,"g");d=h.exec(l);)e[d[2]]||(u[i].push(d[1]),e[d[2]]=r(d[1]).m),u[d[2]]=u[d[2]]||[],u[d[2]].push(d[4]);for(var _=Object.keys(u),p=0;p<_.length;p++)for(var v=0;v<u[_[p]].length;v++)o(u[_[p]][v])&&(u[_[p]][v]=1*u[_[p]][v]);return u}function l(e){return Object.keys(e).reduce(function(t,r){return t||e[r].length>0},!1)}e.exports=function(e,t){t=t||{};var a={main:r.m},n=t.all?{main:Object.keys(a.main)}:function(e,t){for(var r={main:[t]},i={main:[]},a={main:{}};l(r);)for(var n=Object.keys(r),s=0;s<n.length;s++){var o=n[s],f=r[o].pop();if(a[o]=a[o]||{},!a[o][f]&&e[o][f]){a[o][f]=!0,i[o]=i[o]||[],i[o].push(f);for(var d=u(e,e[o][f],o),c=Object.keys(d),h=0;h<c.length;h++)r[c[h]]=r[c[h]]||[],r[c[h]]=r[c[h]].concat(d[c[h]])}}return i}(a,e),s="";Object.keys(n).filter(function(e){return"main"!==e}).forEach(function(e){for(var t=0;n[e][t];)t++;n[e].push(t),a[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+"var "+e+" = ("+i.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+n[e].map(function(t){return JSON.stringify(t)+": "+a[e][t].toString()}).join(",")+"});\n"}),s=s+"new (("+i.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n.main.map(function(e){return JSON.stringify(e)+": "+a.main[e].toString()}).join(",")+"}))(self);";var o=new window.Blob([s],{type:"text/javascript"});if(t.bare)return o;var f=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(o),d=new window.Worker(f);return d.objectURL=f,d}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=f(r(28)),n=f(r(18)),s=f(r(34)),o=f(r(1)),u=r(4),l=r(3);function f(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._observer=t,this._config=r,this._loaderCallbacks={onProgress:this._onProgress.bind(this),onError:this._onLoaderError.bind(this),onEnd:this._onLoaderEnd.bind(this),onInfo:this._onInfo.bind(this)},t.on(o.default.PARSING_DATA,function(){i._contiguous=!0,i._switchStream=!1,i._seek=!1}),this._baseTime=r.startFromKeyframePoint,this._contiguous=!1,this._discontinuity=!1}return i(e,[{key:"init",value:function(){var e=this._config,t=this._observer,r={skipLostFrame:e.skipLostFrame,alignBase:e.alignBase,stretchShortVideoTrack:!1,maxBufferHole:.5,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0},i=this._remuxer=new n.default(t,r,{mp4:!0},navigator.vendor);this._switchStream=!!e.alignBase,(this._demuxer=new a.default(t,i,r)).duration=e.duration||0}},{key:"loadSource",value:function(){this._loader||(this._loader=new s.default(this._config)),this._loader.open(this._loaderCallbacks)}},{key:"seek",value:function(e){this._seek=!0,this._contiguous=!1,this._loader.seek(e.keyframePoint,e.keyframetime),this._demuxer.flush(),this._remuxer.resetInitSegment(),this._remuxer.resetTimeStamp()}},{key:"pause",value:function(){this._loader.pause()}},{key:"resume",value:function(){this._loader.resume()}},{key:"destroy",value:function(){this._loader&&(this._loader.destroy(),this._loader=null),this._demuxer&&(this._demuxer=null),this._remuxer&&(this._remuxer=null)}},{key:"_discontinuityCallback",value:function(e){this._baseTime=e,this._discontinuity=!0,this._demuxer.flush(),this._remuxer.resetInitSegment(),this._remuxer.resetTimeStamp()}},{key:"_onProgress",value:function(e,t,r){var i=this._demuxer,a={type:u.REPORT_TYPES.LOADER_CHUNK_ARRIVAL,byteLength:t.byteLength,ts:e.ts};this._observer.trigger(o.default.REPORT,a),void 0!==r&&(this._baseTime=r,this._contiguous=!1,this._demuxer.flush());var n=!(this._switchStream||this._seek);i.setFlv(t,(this._baseTime||0)/1e3,this._contiguous,n)}},{key:"_onInfo",value:function(e){"loadInfo"===e.type?this._observer.trigger(o.default.REPORT,e.data):"discontinuity"===e.type&&this._discontinuityCallback(e.data)}},{key:"_onLoaderError",value:function(e,t){var r={type:l.ErrorTypes.NETWORK_ERROR,details:"timeout"===t.text?l.ErrorDetails.LOAD_TIMEOUT:l.ErrorDetails.LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code,url:e.src};self.postMessage({event:o.default.ERROR,data:r})}},{key:"_onLoaderEnd",value:function(){this._observer.trigger(o.default.END)}}]),e}();t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=Math.pow(2,32)-1,n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t=void 0;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:i};var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=n,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,u,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,a))}},{key:"box",value:function(e){for(var t=Array.prototype.slice.call(arguments,1),r=8,i=t.length,a=i,n=void 0;i--;)r+=t[i].byteLength;for((n=new Uint8Array(r))[0]=r>>24&255,n[1]=r>>16&255,n[2]=r>>8&255,n[3]=255&r,n.set(e,4),i=0,r=8;i<a;i++)n.set(t[i],r),r+=t[i].byteLength;return n}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,r){r*=t;var i=Math.floor(r/(a+1)),n=Math.floor(r%(a+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,r,i){return e.box(e.types.moof,e.mfhd(t),e.traf(i,r))}},{key:"moov",value:function(t){for(var r=t.length,i=[];r--;)i[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var r=t.length,i=[];r--;)i[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(i))}},{key:"mvhd",value:function(t,r){r*=t;var i=Math.floor(r/(a+1)),n=Math.floor(r%(a+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,s)}},{key:"sdtp",value:function(t){var r=t.samples||[],i=new Uint8Array(4+r.length),a=void 0,n=void 0;for(n=0;n<r.length;n++)a=r[n].flags,i[n+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy;return e.box(e.types.sdtp,i)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var r=[],i=[],a=void 0,n=void 0,s=void 0;for(a=0;a<t.sps.length;a++)s=(n=t.sps[a]).byteLength,r.push(s>>>8&255),r.push(255&s),r=r.concat(Array.prototype.slice.call(n));for(a=0;a<t.pps.length;a++)s=(n=t.pps[a]).byteLength,i.push(s>>>8&255),i.push(255&s),i=i.concat(Array.prototype.slice.call(n));var o=e.box(e.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|t.sps.length].concat(r).concat([t.pps.length]).concat(i))),u=t.width,l=t.height,f=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,255&f,d>>24,d>>16&255,d>>8&255,255&d])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var r=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"mp3",value:function(t){var r=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))}},{key:"stsd",value:function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var r=t.id,i=t.duration*t.timescale,n=t.width,s=t.height,o=Math.floor(i/(a+1)),u=Math.floor(i%(a+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,u>>24,u>>16&255,u>>8&255,255&u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,s>>8&255,255&s,0,0]))}},{key:"traf",value:function(t,r){var i=e.sdtp(t),n=t.id,s=Math.floor(r/(a+1)),o=Math.floor(r%(a+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o])),e.trun(t,i.length+16+20+8+16+8+8),i)}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,r){var i=t.samples||[],a=i.length,n=12+16*a,s=new Uint8Array(n),o=void 0,u=void 0,l=void 0,f=void 0,d=void 0,c=void 0;for(r+=8+n,s.set([0,0,15,1,a>>>24&255,a>>>16&255,a>>>8&255,255&a,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),o=0;o<a;o++)l=(u=i[o]).duration,f=u.size,d=u.flags,c=u.cts,s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,f>>>24&255,f>>>16&255,f>>>8&255,255&f,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,61440&d.degradPrio,15&d.degradPrio,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*o);return e.box(e.types.trun,s)}},{key:"initSegment",value:function(t){e.types||e.init();var r=e.moov(t),i=void 0;return(i=new Uint8Array(e.FTYP.byteLength+r.byteLength)).set(e.FTYP),i.set(r,e.FTYP.byteLength),i}}]),e}();t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(r(16)),n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,r=t.byteLength,i=new Uint8Array(r),a=0,n=0;n<r;n++)n>=2&&3===t[n]&&0===t[n-1]&&0===t[n-2]||(i[a]=t[n],a++);return new Uint8Array(i.buffer,0,a)}},{key:"parseSPS",value:function(t){var r=e._ebsp2rbsp(t),i=new a.default(r);i.readByte();var n=i.readByte();i.readByte();var s=i.readByte();i.readUEG();var o=e.getProfileString(n),u=e.getLevelString(s),l=1,f=420,d=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(l=i.readUEG())&&i.readBits(1),l<=3&&(f=[0,420,422,444][l]),d=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool()))for(var c=3!==l?8:12,h=0;h<c;h++)i.readBool()&&(h<6?e._skipScalingList(i,16):e._skipScalingList(i,64));i.readUEG();var _=i.readUEG();if(0===_)i.readUEG();else if(1===_){i.readBits(1),i.readSEG(),i.readSEG();for(var p=i.readUEG(),v=0;v<p;v++)i.readSEG()}i.readUEG(),i.readBits(1);var m=i.readUEG(),y=i.readUEG(),g=i.readBits(1);0===g&&i.readBits(1),i.readBits(1);var b=0,E=0,R=0,S=0;i.readBool()&&(b=i.readUEG(),E=i.readUEG(),R=i.readUEG(),S=i.readUEG());var k=1,T=1,L=0,w=!0,O=0,A=0;if(i.readBool()){if(i.readBool()){var D=i.readByte();D>0&&D<16?(k=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][D-1],T=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][D-1]):255===D&&(k=i.readByte()<<8|i.readByte(),T=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){var x=i.readBits(32),I=i.readBits(32);w=i.readBool(),L=(O=I)/(A=2*x)}}var P=1;1===k&&1===T||(P=k/T);var M=0,C=0;0===l?(M=1,C=2-g):(M=3===l?1:2,C=(1===l?2:1)*(2-g));var N=16*(m+1),B=16*(y+1)*(2-g);N-=(b+E)*M,B-=(R+S)*C;var F=Math.ceil(N*P);return i.destroy(),i=null,{profile_string:o,level_string:u,bit_depth:d,chroma_format:f,chroma_format_string:e.getChromaFormatString(f),frame_rate:{fixed:w,fps:L,fps_den:A,fps_num:O},sar_ratio:{width:k,height:T},codec_size:{width:N,height:B},present_size:{width:F,height:B}}}},{key:"_skipScalingList",value:function(e,t){for(var r=8,i=8,a=0;a<t;a++)0!==i&&(i=(r+e.readSEG()+256)%256),r=0===i?r:i}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]),e}();t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG=this.constructor.name,this._buffer=t,this._buffer_index=0,this._total_bytes=t.byteLength,this._total_bits=8*t.byteLength,this._current_word=0,this._current_word_bits_left=0}return i(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),r=new Uint8Array(4);r.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(r.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t}},{key:"readBits",value:function(e){if(e>32)throw new InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var r=this._current_word_bits_left?this._current_word:0;r>>>=32-this._current_word_bits_left;var i=e-this._current_word_bits_left;this._fillCurrentWord();var a=Math.min(i,this._current_word_bits_left),n=this._current_word>>>32-a;return this._current_word<<=a,this._current_word_bits_left-=a,r<<a|n}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAudioConfig=s,t.isHeaderPattern=o,t.getHeaderLength=u,t.getFullFrameLength=l,t.isHeader=function(e,t){return!!(t+1<e.length&&o(e,t))},t.probe=function(e,t){if(t+1<e.length&&o(e,t)){var r=u(e,t);t+5<e.length&&(r=l(e,t));var i=t+r;if(i===e.length||i+1<e.length&&o(e,i))return!0}return!1},t.initTrackConfig=function(e,t,r,i,n,o){if(!e.samplerate){var u=s(t,r,i,n,o);e.config=u.config,e.samplerate=u.samplerate,e.channelCount=u.channelCount,e.codec=u.codec,e.manifestCodec=u.manifestCodec,a.Log.v("parsed codec:"+e.codec+",rate:"+u.samplerate+",nb channel:"+u.channelCount)}},t.getFrameDuration=f,t.parseFrameHeader=d,t.appendFrame=function(e,t,r,i,a){var n=d(t,r,i,a,f(e.samplerate));if(n){var s=n.stamp,o=n.headerLength,u=n.frameLength,l={unit:t.subarray(r+o,r+o+u),pts:s,dts:s};return e.samples.push(l),e.len+=u,{sample:l,length:u+o}}};var i=function(e){return e&&e.__esModule?e:{default:e}}(r(1)),a=r(0),n=r(3);function s(e,t,r,s){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"hls",u=void 0,l=void 0,f=void 0,d=void 0,c=void 0,h=navigator.userAgent.toLowerCase(),_=s,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if("flv"===o){if(u=t[r+2]>>>3,(l=(7&t[r+2])<<1|t[r+3]>>>7)<0||l>=p.length)return void e.trigger(i.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+l});if((d=(120&t[r+3])>>>3)<0||d>=8)return void e.trigger(i.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+l})}else{if(u=1+((192&t[r+2])>>>6),(l=(60&t[r+2])>>>2)>p.length-1)return void e.trigger(i.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+l});d=(1&t[r+2])<<2,d|=(192&t[r+3])>>>6}return a.Log.v("manifest codec:"+s+",ADTS data:type:"+u+",sampleingIndex:"+l+"["+p[l]+"Hz],channelConfig:"+d),/firefox/i.test(h)?l>=6?(u=5,c=new Array(4),f=l-3):(u=2,c=new Array(2),f=l):-1!==h.indexOf("android")?(u=2,c=new Array(2),f=l):(u=5,c=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&l>=6?f=l-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(l>=6&&1===d||/vivaldi/i.test(h))||!s&&1===d)&&(u=2,c=new Array(2)),f=l)),c[0]=u<<3,c[0]|=(14&l)>>1,c[1]|=(1&l)<<7,c[1]|=d<<3,5===u&&(c[1]|=(14&f)>>1,c[2]=(1&f)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:p[l],channelCount:d,codec:"mp4a.40."+u,manifestCodec:_}}function o(e,t){return 255===e[t]&&240==(246&e[t+1])}function u(e,t){return 1&e[t+1]?7:9}function l(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function f(e){return 9216e4/e}function d(e,t,r,i,a){var n,s=void 0,o=e.length;if(n=u(e,t),s=l(e,t),(s-=n)>0&&t+n+s<=o)return{headerLength:n,frameLength:s,stamp:r+i*a}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=f(r(33)),n=f(r(14)),s=f(r(1)),o=r(3),u=r(0),l=f(r(19));function f(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=r,this.typeSupported=i;var n=navigator.userAgent;this.isSafari=a&&a.indexOf("Apple")>-1&&n&&!n.match("CriOS"),this.ISGenerated=!1,this._resetVideoTime(),this._forceFirstIDR=!(!l.default.chrome||!(l.default.version.major<50||50===l.default.version.major&&l.default.version.build<2661))}return i(e,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(e){this._initPTS=this._initDTS=e,this._resetVideoTime()}},{key:"resetInitSegment",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,r,i,a){if(this.ISGenerated||this.generateIS(e,t,r),this.ISGenerated){var n=e.samples.length,o=t.samples.length,l=0,f=0;if(n&&o){var d=(e.samples[0].dts-t.samples[0].dts)/t.inputTimeScale;l+=Math.max(0,d),f+=Math.max(0,-d)}if(n){e.timescale||(u.Log.w("regenerate InitSegment as audio detected"),this.generateIS(e,t,r));var c=this.remuxAudio(e,l,i,a);if(o){var h=void 0;c&&(h=c.endPTS-c.startPTS),t.timescale||(u.Log.w("regenerate InitSegment as video detected"),this.generateIS(e,t,r)),this.remuxVideo(t,f,i,h,a)}}else if(o){var _=this.remuxVideo(t,f,i,0,a);_&&e.codec&&this.remuxEmptyAudio(e,l,i,_)}}this.observer.trigger(s.default.HLS_FRAG_PARSED)}},{key:"generateIS",value:function(e,t,r){var i=this.observer,a=e.samples,l=t.samples,f=this.typeSupported,d="audio/mp4",c={},h={tracks:c},_=void 0===this._initPTS,p=void 0,v=void 0;if(_&&(p=v=1/0),e.config&&a.length&&(e.timescale=e.samplerate,u.Log.v("audio sampling rate : "+e.samplerate),e.isAAC||(f.mpeg?(d="audio/mpeg",e.codec=""):f.mp3&&(e.codec="mp3")),c.audio={container:d,codec:e.codec,initSegment:!e.isAAC&&f.mpeg?new Uint8Array:n.default.initSegment([e]),metadata:{channelCount:e.channelCount}},_&&(p=v=a[0].pts-e.inputTimeScale*r)),t.sps&&t.pps&&l.length){var m=t.inputTimeScale;t.timescale=m,c.video={container:"video/mp4",codec:t.codec,initSegment:n.default.initSegment([t]),metadata:{width:t.width,height:t.height,fps:t.fps}},_&&(p=Math.min(p,l[0].pts-m*r),v=Math.min(v,l[0].dts-m*r),this.observer.trigger(s.default.INIT_PTS_FOUND,{initPTS:p}))}Object.keys(c).length?(i.trigger(s.default.PARSING_INIT_SEGMENT,h),this.ISGenerated=!0,_&&(this._initPTS=p,this._initDTS=v)):i.trigger(s.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,r,i,a){var l,f,d,c=8,h=e.timescale,_=void 0,p=void 0,v=void 0,m=void 0,y=e.samples,g=[],b=y.length,E=this._PTSNormalize,R=this._initDTS,S=y[0].dts/h,k=y[0].key,T=this._videoTime,L=this.nextAvcDts,w=this.isSafari;if(0!==b){w&&(r|=y.length&&L&&(a&&Math.abs(t-L/h)<.1||Math.abs(y[0].pts-L-R)<h/5)),r||(L=t*h),y.forEach(function(e){e.pts=E(e.pts-R,L),e.dts=E(e.dts-R,L)}),y.sort(function(e,t){var r=e.dts-t.dts,i=e.pts-t.pts;return r||i||e.id-t.id});var O=y.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(O<0){u.Log.w("PTS < DTS detected in video samples, shifting DTS by "+Math.round(O/90)+" ms to overcome this issue");for(var A=0;A<y.length;A++)y[A].dts+=O}var D=y[0];m=Math.max(D.dts,0),v=Math.max(D.pts,0);var x=Math.round((m-L)/90);r&&x&&(x>1?u.Log.v("AVC:"+x+" ms hole between fragments detected,filling it"):x<-1&&u.Log.v("AVC:"+-x+" ms overlapping between fragments detected"),v=Math.max(v-(m-L),L),m=L,y[0].dts=m,y[0].pts=v,u.Log.v("Video/PTS/DTS adjusted: "+Math.round(v/90)+"/"+Math.round(m/90)+",delta:"+x+" ms")),D=y[y.length-1],d=Math.max(D.dts,0),f=Math.max(D.pts,0,d),w&&(_=Math.round((d-m)/(y.length-1)));for(var I=0,P=0,M=0;M<b;M++){for(var C=y[M],N=C.units,B=N.length,F=0,U=0;U<B;U++)F+=N[U].data.length;P+=F,I+=B,C.length=F,C.dts=w?m+M*_:Math.max(C.dts,m),C.pts=Math.max(C.pts,C.dts)}var j=P+4*I+8;try{p=new Uint8Array(j)}catch(e){return void this.observer.trigger(s.default.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:j,reason:"fail allocating video mdat "+j})}var V=new DataView(p.buffer);V.setUint32(0,j),p.set(n.default.types.mdat,4);for(var G=0;G<b;G++){for(var z=y[G],H=z.units,q=0,W=void 0,Y=0,X=H.length;Y<X;Y++){var K=H[Y],Q=K.data,J=K.data.byteLength;V.setUint32(c,J),c+=4,p.set(Q,c),c+=J,q+=4+J}if(w)W=Math.max(0,_*Math.round((z.pts-z.dts)/_));else{if(G<b-1)_=y[G+1].dts-z.dts;else{var $=this.config,Z=T.sampleDuration||z.dts-y[G>0?G-1:G].dts;if($.stretchShortVideoTrack){var ee=$.maxBufferHole,te=Math.floor(ee*h),re=(i?v+i*h:this.nextAudioPts)-z.pts;re>te?((_=re-Z)<0&&(_=Z),u.Log.v("It is approximately "+re/90+" ms to the next segment; using duration "+_/90+" ms for the last video frame.")):_=Z}else _=Z}W=Math.round(z.pts-z.dts)}if(!_&&y.length<2){var ie=0;r&&(ie=90*x),_=Math.max((T.sampleDuration||e.refSampleDuration)-ie,90)}g.push({size:q,duration:_,cts:W,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:z.key?2:1,isNonSync:z.key?0:1}})}this.nextAvcDts=d+_;var ae=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,g.length&&this._forceFirstIDR){var ne=g[0].flags;ne.dependsOn=2,ne.isNonSync=0}e.samples=g,l=n.default.moof(e.sequenceNumber++,m,e),e.samples=[];var se={data1:l,data2:p,startPTS:v/h,endPTS:(f+_)/h,startDTS:m/h,endDTS:this.nextAvcDts/h,type:"video",hasAudio:!1,hasVideo:!0,nb:g.length,dropped:ae,streamDTS:S,key:k};return se.endStreamDts=se.endDTS-se.startDTS+se.streamDTS,this.observer.trigger(s.default.PARSING_DATA,se),0===T.nbSamples&&(T.firstDTS=m),T.nbSamples+=b,T.sampleDuration=(this.nextAvcDts-T.firstDTS)/T.nbSamples,T.endDts=this.nextAvcDts,se}}},{key:"remuxAudio",value:function(e,t,r,i){if(e.samples.length){var l=e.inputTimeScale,f=e.timescale,d=l/f,c=e.isAAC?1024:1152,h=c*d,_=this._PTSNormalize,p=this._initDTS,v=!e.isAAC&&this.typeSupported.mpeg,m=void 0,y=void 0,g=void 0,b=void 0,E=void 0,R=void 0,S=void 0,k=e.samples,T=[],L=this.nextAudioPts,w=k[0].dts/l;if(r|=k.length&&L&&(i&&Math.abs(t-L/l)<.1||Math.abs(k[0].pts-L-p)<20*h),k.forEach(function(e){e.pts=e.dts=_(e.pts-p,t*l)}),0!==(k=k.filter(function(e){return e.pts>=0})).length){if(r||(L=i?t*l:k[0].pts),e.isAAC)for(var O=this.config.maxAudioFramesDrift,A=0,D=L;A<k.length;){var x,I=k[A];x=I.pts-D;var P=Math.abs(1e3*x/l);if(x<=-O*h)u.Log.w("Dropping 1 audio frame @ "+(D/l).toFixed(3)+"s due to "+Math.round(P)+" ms overlap."),k.splice(A,1),e.len-=I.unit.length;else if(x>=O*h&&P<1e4&&D){var M=Math.round(x/h);u.Log.w("Injecting "+M+" audio frame @ "+(D/l).toFixed(3)+"s due to "+Math.round(1e3*x/l)+" ms gap.");for(var C=0;C<M;C++){var N=Math.max(D,0);(g=a.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(u.Log.v("Unable to get silent frame for given audio codec; duplicating last frame instead."),g=I.unit.subarray()),k.splice(A,0,{unit:g,pts:N,dts:N}),e.len+=g.length,D+=h,A++}I.pts=I.dts=D,D+=h,A++}else Math.abs(x),I.pts=I.dts=D,D+=h,A++}for(var B=0,F=k.length;B<F;B++){var U=k[B],j=U.unit,V=U.pts;if(void 0!==S)y.duration=Math.round((V-S)/d);else{var G=Math.round(1e3*(V-L)/l),z=0;if(r&&e.isAAC&&G){if(G>0&&G<1e4)z=Math.round((V-L)/h),u.Log.v(G+" ms hole between AAC samples detected,filling it"),z>0&&((g=a.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(g=j.subarray()),e.len+=z*g.length);else if(G<-12){u.Log.v("drop overlapping AAC sample, expected/parsed/delta:"+(L/l).toFixed(3)+"s/"+(V/l).toFixed(3)+"s/"+-G+"ms"),e.len-=j.byteLength;continue}V=L}if(R=V,!(e.len>0))return;var H=v?e.len:e.len+8;m=v?0:8;try{b=new Uint8Array(H)}catch(e){return void this.observer.trigger(s.default.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:H,reason:"fail allocating audio mdat "+H})}v||(new DataView(b.buffer).setUint32(0,H),b.set(n.default.types.mdat,4));for(var q=0;q<z;q++)(g=a.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(u.Log.v("Unable to get silent frame for given audio codec; duplicating this frame instead."),g=j.subarray()),b.set(g,m),m+=g.byteLength,y={size:g.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(y)}b.set(j,m);var W=j.byteLength;m+=W,y={size:W,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(y),S=V}var Y=0,X=T.length;if(X>=2&&(Y=T[X-2].duration,y.duration=Y),X){this.nextAudioPts=L=S+d*(Y||c),e.len=0,e.samples=T,E=v?new Uint8Array:n.default.moof(e.sequenceNumber++,R/d,e),e.samples=[];var K=R/l,Q=L/l,J={data1:E,data2:b,startPTS:K,endPTS:Q,startDTS:K,endDTS:Q,type:"audio",hasAudio:!0,hasVideo:!1,nb:X,streamDTS:w,endStreamDts:Q-K+w};return this.observer.trigger(s.default.PARSING_DATA,J),J}return null}}}},{key:"remuxEmptyAudio",value:function(e,t,r,i){var n=e.inputTimeScale,s=n/(e.samplerate?e.samplerate:n),o=this.nextAudioPts,l=(void 0!==o?o:i.startDTS*n)+this._initDTS,f=i.endDTS*n+this._initDTS,d=1024*s,c=Math.ceil((f-l)/d),h=a.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(u.Log.w("remux empty Audio"),h){for(var _=[],p=0;p<c;p++){var v=l+p*d;_.push({unit:h,pts:v,dts:v}),e.len+=h.length}e.samples=_,this.remuxAudio(e,t,r)}else u.Log.d("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")}},{key:"_PTSNormalize",value:function(e,t){var r;if(void 0===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}},{key:"_resetVideoTime",value:function(){this._videoTime={nbSamples:0,firstDTS:0,sampleDuration:3e3}}}]),e}();t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],r=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],a={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:r[0]||""},n={};if(a.browser){n[a.browser]=!0;var s=a.majorVersion.split(".");n.version={major:parseInt(a.majorVersion,10),string:a.version},s.length>1&&(n.version.minor=parseInt(s[1],10)),s.length>2&&(n.version.build=parseInt(s[2],10))}for(var o in a.platform&&(n[a.platform]=!0),(n.chrome||n.opr||n.safari)&&(n.webkit=!0),(n.rv||n.iemobile)&&(n.rv&&delete n.rv,a.browser="msie",n.msie=!0),n.edge&&(delete n.edge,a.browser="msedge",n.msedge=!0),n.opr&&(a.browser="opera",n.opera=!0),n.safari&&n.android&&(a.browser="android",n.android=!0),n.name=a.browser,n.platform=a.platform,i)i.hasOwnProperty(o)&&delete i[o];i=n}(),t.default=i},function(e,t,r){(function(e){var i,a,n,s,o,u,l,f,d,c,h,_,p,v,m,y,g,b,E,R,S,k,T,L,w,O,A,D,x,I,P,M,C,N,B,F,U,j,V,G,z,H,q,W,Y,X,K,Q,J,$,Z,ee,te,re,ie,ae,ne,se,oe,ue,le,fe,de,ce,he,_e,pe,ve,me,ye,ge,be,Ee,Re,Se,ke,Te,Le,we,Oe,Ae,De,xe,Ie,Pe,Me,Ce,Ne,Be,Fe,Ue,je,Ve,Ge,ze,He,qe,We,Ye,Xe;u="object",l="exports",f="function",d="default",c=1,h="call",_="l",p=0,v="d",m="defineProperty",y="undefined",g="__esModule",b=null,E=2,R="prototype",S="",k="length",T="enumerable",L="configurable",w="value",O="writable",A="key",D="map",x="stringify",I="unshift",P="[",M="::",C="] > ",N="w",B="Cannot call a class as a function",F="ENABLE_ERROR",U="ENABLE_WARN",j="ENABLE_INFO",V="ENABLE_DEBUG",G="ENABLE_VERBOSE",z="apply",H="Log",q="validRepresentation",W="validConfig",Y="validNumber",X="min",K="REASONABLE_VALUE",Q="invalid number:",J="max",$="number",Z="unexpected number value or type:",ee="adaptationSet",te="representation",re="this hasn't been initialised - super() hasn't been called",ie="__proto__",ae="getPrototypeOf",ne="version:",se="1.2.6",oe="_config",ue="_bitrateCalculator",le="_bufferPredictor",fe="_speedPredictor",de="index",ce="buffer",he="setLastIndex",_e="setLastBuffer",pe="_seconds",ve="_time",me="now",ye="adaptiveAlgorithm",ge="getSpeedUpperLimitAndUpdate",be="bitrate",Ee="_events",Re="_maxListeners",Se="listener must be a function",ke="removeListener",Te="removeAllListeners",Le="_lastBuffer",we="_availableBitrates",Oe="sort",Ae="filter",De="available bitrates:",xe="_storage",Ie="read",Pe="_lastRequestedIndex",Me="_highestIndexBelowThan",Ce="_consistentCount",Ne="_sortedIndex2Rate",Be="_sortedIndex2Representation",Fe="write",Ue="_downloads",je="downloads",Ve="_speed",Ge="speed",ze="_speedUpperLimit",He="speedUpperLimit",qe="_names",We="alg",Ye="_isLocalStorageAvailable",Xe="isLocalStorageAvailable",s=window,o=function(){return function(e){var t={};function r(i){if(t[i])return t[i][l];var a=t[i]={i:i,l:!c,exports:{}};return e[i][h](a[l],a,a[l],r),a[_]=!p,a[l]}return r.m=e,r.c=t,r[v]=function(e,t,i){r.o(e,t)||Object[m](e,t,{enumerable:!p,get:i})},r.r=function(e){y!=typeof Symbol&&Symbol.toStringTag&&Object[m](e,Symbol.toStringTag,{value:"Module"}),Object[m](e,g,{value:!p})},r.t=function(e,t){if(c&t&&(e=r(e)),8&t)return e;if(4&t&&u==typeof e&&e&&e[g])return e;var i=Object.create(b);if(r.r(i),Object[m](i,d,{enumerable:!p,value:e}),E&t&&"string"!=typeof e)for(var a in e)r[v](i,a,function(t){return e[t]}.bind(b,a));return i},r.n=function(e){var t=e&&e[g]?function(){return e[d]}:function(){return e};return r[v](t,"a",t),t},r.o=function(e,t){return Object[R].hasOwnProperty[h](e,t)},r.p=S,r(r.s=E)}([function(e,t,r){"use strict";Object[m](t,g,{value:!p});var i=function(){function e(e,t){for(var r=p;r<t[k];r++){var i=t[r];i[T]=i[T]||!c,i[L]=!p,w in i&&(i[O]=!p),Object[m](e,i[A],i)}}return function(t,r,i){return r&&e(t[R],r),i&&e(t,i),t}}(),a=f==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&f==typeof Symbol&&e.constructor===Symbol&&e!==Symbol[R]?"symbol":typeof e},n="kwai-a",s=[];function o(e,t){t&&p!==t[k]||(t=[e],e=S);var r=t[D](function(e){return u===(void 0===e?y:a(e))?JSON[x](e):e});return r[I](P+n+(e?M+e:S)+C),r}var l={LEVEL_ERROR:"e",LEVEL_WARN:N,LEVEL_INFO:"i",LEVEL_DEBUG:v,LEVEL_VERBOSE:"v"},d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError(B)}(this,e)}return i(e,b,[{key:"level",value:function(t){switch(e[F]=e[U]=e[j]=e[V]=e[G]=!c,t){case l.LEVEL_ERROR:e[F]=!p;break;case l.LEVEL_WARN:e[F]=e[U]=!p;break;case l.LEVEL_INFO:e[F]=e[U]=e[j]=!p;break;case l.LEVEL_DEBUG:e[F]=e[U]=e[j]=e[V]=!p;break;case l.LEVEL_VERBOSE:e[F]=e[U]=e[j]=e[V]=e[G]=!p}}},{key:"e",value:function(t){if(e[F]){for(var r=arguments[k],i=Array(r>c?r-c:p),a=c;a<r;a++)i[a-c]=arguments[a];(console.error||console.warn||console.log)[z](console,o(t,i))}}},{key:N,value:function(t){for(var r=arguments[k],i=Array(r>c?r-c:p),a=c;a<r;a++)i[a-c]=arguments[a];var n=o(t,i),u=(new Date).toLocaleTimeString("CN",{hour12:!c});s.push(u+" "+n.join(" ")),e[U]&&(console.warn||console.log)[z](console,n)}},{key:"i",value:function(t){if(e[j]){for(var r=arguments[k],i=Array(r>c?r-c:p),a=c;a<r;a++)i[a-c]=arguments[a];(console.info||console.log)[z](console,o(t,i))}}},{key:v,value:function(t){if(e[V]){for(var r=arguments[k],i=Array(r>c?r-c:p),a=c;a<r;a++)i[a-c]=arguments[a];(console.debug||console.log)[z](console,o(t,i))}}},{key:"v",value:function(t){if(e[G]){for(var r=arguments[k],i=Array(r>c?r-c:p),a=c;a<r;a++)i[a-c]=arguments[a];console.log[z](console,o(t,i))}}},{key:"qos",value:function(){if(p===s[k])return{};var e=s.join(";    ");return s=[],{warning:e}}}]),e}();d[F]=!p,d[U]=!c,d[j]=!c,d[V]=!c,d[G]=!c,t[H]=d,t.LOG_LEVEL=l},function(e,t,r){"use strict";Object[m](t,g,{value:!p}),t.validInfo=t[q]=t[W]=t[Y]=void 0;var i=r(5),a=r(p),n="check";function s(e,t){var r=arguments[k]>E&&void 0!==arguments[E]?arguments[E]:i[K][e][X],s=i[K][e];return isNaN(t)||b===t?(a[H][N](n,Q,e,t,d,r),r):((t<s[X]||t>s[J]||$!=typeof t)&&a[H][N](n,Z,e,t,X,s[X],J,s[J]),Number(t))}t[Y]=s,t[W]=function(e){if(!e)return a[H][N](n,"invalid config:",e),i.CONFIG;var t=Object.assign[z](Object,[{}].concat(function(e){if(Array.isArray(e)){for(var t=p,r=Array(e[k]);t<e[k];t++)r[t]=e[t];return r}return Array.from(e)}(Object.entries(i.CONFIG)[D](function(t){var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],i=!p,a=!c,n=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s[w]),!t||r[k]!==t);i=!p);}catch(e){a=!p,n=e}finally{try{!i&&o.return&&o.return()}finally{if(a)throw n}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(t,E),i=r[p],a=r[c];return function(e,t,r){return t in e?Object[m](e,t,{value:r,enumerable:!p,configurable:!p,writable:!p}):e[t]=r,e}({},i,s(i,e[i],a))}))));return a[H][v](n,"config:",t),t},t[q]=function(e){return!e||!e[ee]||!e[ee][te]||e[ee][te][k]<c?(a[H][N](n,"invalid representation:",e),i.MANIFEST[ee][te]):e[ee][te]},t.validInfo=function(e){if(!e)return a[H][N](n,"invalid info:",e),i.INFO;var t={buffered:s("buffered",e.buffered),download:function(e){return e?{size:s("downloadSize",e.size),duration:s("downloadDuration",e.duration)}:(a[H][N](n,"invalid download:",e),i.INFO.download)}(e.download)};return a[H][v](n,"info:",t),t}},function(e,t,r){"use strict";Object[m](t,g,{value:!p});var i=Object.assign||function(e){for(var t=c;t<arguments[k];t++){var r=arguments[t];for(var i in r)Object[R].hasOwnProperty[h](r,i)&&(e[i]=r[i])}return e},a=function(){function e(e,t){for(var r=p;r<t[k];r++){var i=t[r];i[T]=i[T]||!c,i[L]=!p,w in i&&(i[O]=!p),Object[m](e,i[A],i)}}return function(t,r,i){return r&&e(t[R],r),i&&e(t,i),t}}(),n=S(r(3)),s=S(r(4)),o=S(r(6)),l=S(r(7)),_=r(p),y=r(c),E=S(r(8));function S(e){return e&&e[g]?e:{default:e}}var D="main",I=function(e){function t(e,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError(B)}(this,t);var a=function(e,t){if(!e)throw new ReferenceError(re);return!t||u!=typeof t&&f!=typeof t?e:t}(this,(t[ie]||Object[ae](t))[h](this));_[H][v](D,ne,se),a[oe]=(0,y[W])(r);var n=(0,y[q])(e),c=new E[d](a[oe]);if(a[ue]=new o[d](n,a[oe],c),a[le]=new s[d](a[oe]),a[fe]=new l[d](a[oe],c),i){var m=i[de],g=i[ce];a[ue][he](m),a[le][_e](g),a[fe][_e](g)}return a[pe]=p,a[ve]=Date[me](),a}return function(e,t){if(f!=typeof t&&b!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e[R]=Object.create(t&&t[R],{constructor:{value:e,enumerable:!c,writable:!p,configurable:!p}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e[ie]=t)}(t,n[d]),a(t,[{key:"heartbeatReport",value:function(e){if(this.heartbeatReport.valid){this[pe]+=c;var t=(0,y.validInfo)(e),r=t.buffered,i=t.download;this[le].recordBuffer(r);var a=this[fe].recordDownload(i);this.emit(ye,{type:"heartbeat",data:{time:Date[me](),speed:a,buffered:r}})}else this.heartbeatReport.valid=!p}},{key:"nextBitrateIndex",value:function(e){var t=(0,y.validInfo)(e),r=t.buffered,i=t.download,a=this[fe].recordDownload(i),n=this[ue].getLastBitrate(),s=Date[me]()-this[ve];this[ve]=Date[me]();var o=this[fe][ge](r,n,s),u=this[pe]<=this[oe].start_up_duration;_[H][v](D,"isStarting:",u);var l=u?this._startUpIndex():this._nextIndex(r,o),f=l[de],d=l[be],c=Date[me]();return this.emit(ye,{type:"heartbeat",data:{time:c,speed:a,buffered:r}}),this.emit(ye,{type:be,data:{time:c,bitrate:d,speedUpperLimit:o}}),f}},{key:"_startUpIndex",value:function(){return this[ue].nextStartUp()}},{key:"_nextIndex",value:function(e,t){var r=this[ue].availableBitrates(),i=this[le].predictBuffers(t,r);return this[ue].nextIndexAndBitrate(i)}},{key:"getQos",value:function(){return{speed:this[fe].getSpeed(),extra:JSON[x](i({},_[H].qos(),this[ue].getQos(),this[le].getQos(),this[fe].getQos()))}}}],[{key:"setLogLevel",value:function(e){_[H].level(e)}}]),t}();t[d]=I},function(e,t){function r(){this[Ee]=this[Ee]||{},this[Re]=this[Re]||void 0}function i(e){return f==typeof e}function a(e){return u==typeof e&&b!==e}function n(e){return void 0===e}e[l]=r,r.EventEmitter=r,r[R][Ee]=void 0,r[R][Re]=void 0,r.defaultMaxListeners=10,r[R].setMaxListeners=function(e){if(!function(e){return $==typeof e}(e)||e<p||isNaN(e))throw TypeError("n must be a positive number");return this[Re]=e,this},r[R].emit=function(e){var t,r,s,o,u,l;if(this[Ee]||(this[Ee]={}),"error"===e&&(!this[Ee].error||a(this[Ee].error)&&!this[Ee].error[k])){if((t=arguments[c])instanceof Error)throw t;var f=new Error('Uncaught, unspecified "error" event. ('+t+")");throw f.context=t,f}if(n(r=this[Ee][e]))return!c;if(i(r))switch(arguments[k]){case c:r[h](this);break;case E:r[h](this,arguments[c]);break;case 3:r[h](this,arguments[c],arguments[E]);break;default:o=Array[R].slice[h](arguments,c),r[z](this,o)}else if(a(r))for(o=Array[R].slice[h](arguments,c),s=(l=r.slice())[k],u=p;u<s;u++)l[u][z](this,o);return!p},r[R].addListener=function(e,t){var s;if(!i(t))throw TypeError(Se);return this[Ee]||(this[Ee]={}),this[Ee].newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this[Ee][e]?a(this[Ee][e])?this[Ee][e].push(t):this[Ee][e]=[this[Ee][e],t]:this[Ee][e]=t,a(this[Ee][e])&&!this[Ee][e].warned&&(s=n(this[Re])?r.defaultMaxListeners:this[Re])&&s>p&&this[Ee][e][k]>s&&(this[Ee][e].warned=!p,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this[Ee][e][k]),f==typeof console.trace&&console.trace()),this},r[R].on=r[R].addListener,r[R].once=function(e,t){if(!i(t))throw TypeError(Se);var r=!c;function a(){this[ke](e,a),r||(r=!p,t[z](this,arguments))}return a.listener=t,this.on(e,a),this},r[R][ke]=function(e,t){var r,n,s,o;if(!i(t))throw TypeError(Se);if(!this[Ee]||!this[Ee][e])return this;if(s=(r=this[Ee][e])[k],n=-c,r===t||i(r.listener)&&r.listener===t)delete this[Ee][e],this[Ee][ke]&&this.emit(ke,e,t);else if(a(r)){for(o=s;o-- >p;)if(r[o]===t||r[o].listener&&r[o].listener===t){n=o;break}if(n<p)return this;c===r[k]?(r[k]=p,delete this[Ee][e]):r.splice(n,c),this[Ee][ke]&&this.emit(ke,e,t)}return this},r[R][Te]=function(e){var t,r;if(!this[Ee])return this;if(!this[Ee][ke])return p===arguments[k]?this[Ee]={}:this[Ee][e]&&delete this[Ee][e],this;if(p===arguments[k]){for(t in this[Ee])ke!==t&&this[Te](t);return this[Te](ke),this[Ee]={},this}if(i(r=this[Ee][e]))this[ke](e,r);else if(r)for(;r[k];)this[ke](e,r[r[k]-c]);return delete this[Ee][e],this},r[R].listeners=function(e){return this[Ee]&&this[Ee][e]?i(this[Ee][e])?[this[Ee][e]]:this[Ee][e].slice():[]},r[R].listenerCount=function(e){if(this[Ee]){var t=this[Ee][e];if(i(t))return c;if(t)return t[k]}return p},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,r){"use strict";Object[m](t,g,{value:!p});var i=function(){function e(e,t){for(var r=p;r<t[k];r++){var i=t[r];i[T]=i[T]||!c,i[L]=!p,w in i&&(i[O]=!p),Object[m](e,i[A],i)}}return function(t,r,i){return r&&e(t[R],r),i&&e(t,i),t}}(),a=r(p),n=r(c),s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError(B)}(this,e),this[oe]=t,this[Le]=p}return i(e,[{key:"recordBuffer",value:function(e){(0,n[Y])("bufferDiff",e-this[Le]),this[Le]=e}},{key:"predictBuffers",value:function(e,t){var r=this,i=t[D](function(t){return r.predictBuffer(e,t)});return a[H][v](ce,"predicted buffer:",i),i}},{key:"predictBuffer",value:function(e,t){var r=e/t*1e3-1e3,i=r>p?this[oe].buffer_up_ahead:this[oe].buffer_down_ahead;return this[Le]+i*r}},{key:"getQos",value:function(){return{}}},{key:_e,value:function(e){return this[Le]=(0,n[Y])("buffered",e,this[Le]),this}}]),e}();t[d]=s},function(e,t,r){"use strict";Object[m](t,g,{value:!p});var i={consistent_bitrate_threshold:{min:p,max:10},lower_buffered_time:{min:p,max:1e5},upper_buffered_time:{min:p,max:1e5},timeout_minutes:{min:p,max:Number.MAX_SAFE_INTEGER},buffer_up_ahead:{min:p,max:100},buffer_down_ahead:{min:p,max:100},start_up_duration:{min:p,max:100},speed_heartbeat_limit:{min:p,max:100},buffered:{min:p,max:3e5},bufferDiff:{min:-1300,max:3e5},downloadSize:{min:p,max:1e9},downloadDuration:{min:p,max:1100},bitrate:{min:100,max:1e5}};t.MANIFEST={adaptationSet:{representation:[{bitrate:900},{bitrate:1e3},{bitrate:1500}]}},t.CONFIG={consistent_bitrate_threshold:3,lower_buffered_time:3e3,upper_buffered_time:6e3,timeout_minutes:.1,buffer_up_ahead:3,buffer_down_ahead:5,start_up_duration:3,speed_heartbeat_limit:9},t[K]=i,t.INFO={buffered:p,download:{size:p,duration:p}}},function(e,t,r){"use strict";Object[m](t,g,{value:!p});var i=function(){function e(e,t){for(var r=p;r<t[k];r++){var i=t[r];i[T]=i[T]||!c,i[L]=!p,w in i&&(i[O]=!p),Object[m](e,i[A],i)}}return function(t,r,i){return r&&e(t[R],r),i&&e(t,i),t}}(),a=r(p),n=r(c),s=be,o=function(){function e(t,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError(B)}(this,e),this[we]=t[D](function(e,t){return{bitrate:e[be],index:t}})[Ae](function(e){var t=e[be];return t===(0,n[Y])(be,t)})[Oe](function(e,t){return e[be]-t[be]}),a[H][v](s,De,this[we][D](function(e){return e[be]})),this[xe]=i,this[oe]=r;var o=this[xe][Ie](be,p);this[Pe]=this[Me](o),this[Ce]=p}return i(e,[{key:Me,value:function(e){return Math[J](p,this[we][Ae](function(t){return t[be]<=e})[k]-c)}},{key:"nextIndexAndBitrate",value:function(e){var t=this,r=this[Pe];return this._needToDecrease(e[r])?(r=Math[J](p,e[Ae](function(e){return!t._needToDecrease(e)})[k]-c),a[H][v](s,"index:",r)):this._needToIncrease(e[r])&&(r=Math[X](this[we][k]-c,r+c)),this._generateResult(r)}},{key:"availableBitrates",value:function(){return this[we][D](function(e){return e[be]})}},{key:"nextStartUp",value:function(){return this._generateResult(this[Pe])}},{key:"_generateResult",value:function(e){this._recordIndex(e);var t=this[Ne](e);this._recordBitrate(t);var r=this[Be](e);return a[H][v](s,"next index:",r,"bitrate:",t),{index:r,bitrate:t}}},{key:"_needToDecrease",value:function(e){return e<this[oe].lower_buffered_time}},{key:"_needToIncrease",value:function(e){return e>=this[oe].upper_buffered_time&&this[Ce]>=this[oe].consistent_bitrate_threshold}},{key:"_recordIndex",value:function(e){e!==this[Pe]?(this[Pe]=e,this[Ce]=c):this[Ce]+=c}},{key:Ne,value:function(e){return this[we][e][be]}},{key:"_recordBitrate",value:function(e){this[xe][Fe](be,e)}},{key:Be,value:function(e){return this[we][e][de]}},{key:"getQos",value:function(){return{}}},{key:he,value:function(e){var t=this[we].findIndex(function(t){return t[de]===e});return-c===t?a[H][N](s,"fail to find index:",e):this[Pe]=t,this}},{key:"getLastBitrate",value:function(){return this[Ne](this[Pe])}}]),e}();t[d]=o},function(e,t,r){"use strict";Object[m](t,g,{value:!p});var i=function(){function e(e,t){for(var r=p;r<t[k];r++){var i=t[r];i[T]=i[T]||!c,i[L]=!p,w in i&&(i[O]=!p),Object[m](e,i[A],i)}}return function(t,r,i){return r&&e(t[R],r),i&&e(t,i),t}}(),a=r(p),n=r(c),s=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError(B)}(this,e),this[xe]=r,this[oe]=t,this[Ue]=this[xe][Ie](je,[]),this[Ve]=this[xe][Ie](Ge,p),this[ze]=this[xe][Ie](He,p),this[Le]=p}return i(e,[{key:_e,value:function(e){return this[Le]=(0,n[Y])("buffered",e,this[Le]),this}},{key:"recordDownload",value:function(e){return this[Ue][I](e),this[Ve]=this._calculateSpeed(),a[H][v](Ge,"predictedSpeed:",this[Ve]),this[xe][Fe](Ge,this[Ve]),this[xe][Fe](je,this[Ue]),this[Ve]}},{key:"_calculateSpeed",value:function(){var e=this,t=p,r=p;return this[Ue].forEach(function(i,a){var n=i.size,s=i.duration,o=1e3*e[oe].speed_heartbeat_limit-r;s>o&&(n=n*o/s,s=o,e[Ue][a]={size:n,duration:s},e[Ue].splice(a+c)),r+=s,t+=n}),t/r*8||p}},{key:"getSpeed",value:function(){return Math.round(this[Ve])}},{key:"getQos",value:function(){return{speedUpperLimit:Math.round(this[ze])}}},{key:ge,value:function(e,t,r){if(e>=this[Le])this[ze]=t;else{var i=e+r-this[Le];a[H][v](Ge,"duration",r,"downloadBuffer",i),this[ze]=i*t/Math[J](r,c)}return this[Le]=e,a[H][v](Ge,"speedUpperLimit:",this[ze]),this[xe][Fe](He,this[ze]),this[ze]}}]),e}();t[d]=s},function(e,t,r){"use strict";Object[m](t,g,{value:!p});var i=function(){function e(e,t){for(var r=p;r<t[k];r++){var i=t[r];i[T]=i[T]||!c,i[L]=!p,w in i&&(i[O]=!p),Object[m](e,i[A],i)}}return function(t,r,i){return r&&e(t[R],r),i&&e(t,i),t}}(),a=r(p),n="storage",s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError(B)}(this,e),this[oe]=t,this[qe]=new Set;try{this[Fe](We,!p),this[Ye]=!p}catch(e){this[Ye]=!c}a[H][v](n,Xe,this[Ye])}return i(e,[{key:Fe,value:function(e,t){if(this[Ye]){this[qe].add(e);var r=(new Date).toLocaleString();localStorage.setItem(e,JSON[x]({value:t,time:r}))}}},{key:Ie,value:function(t,r){var i=arguments[k]>E&&void 0!==arguments[E]?arguments[E]:this[oe].timeout_minutes;if(this[Ye]){this[qe].add(t);var s=localStorage.getItem(t);if(s){var o=JSON.parse(s),u=o[w],l=o.time,f=void 0===l?p:l;if(!e.timeOut(new Date(f),i))return u;a[H][v](n,"read timeout")}}return r}}],[{key:"timeOut",value:function(e,t){return(Date[me]()-e)/6e4>t}}]),e}();t[d]=s}])[d]},u==typeof t&&u==typeof e?e[l]=o():"function"==f&&r(39).amd?(a=[],void 0===(n="function"==typeof(i=o)?i.apply(t,a):i)||(e.exports=n)):u==typeof t?t.adaptiveMultiRate=o():s.adaptiveMultiRate=o()}).call(this,r(38)(e))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=_(r(44)),n=_(r(1)),s=_(r(50)),o=_(r(18)),u=r(4),l=r(3),f=_(r(6)),d=_(r(7)),c=_(r(9)),h=_(r(10));function _(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tag="TransmuxerHls",this._observer=t,this._config=r,this._selectLoader(),this._typeSupported=i,this._demuxConfig={maxBufferHole:.5,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!1},this.vendor=navigator.vendor,this._frag=null,this._totalduration=0,this._cache=new f.default,this._progressCount=0,this.MUX_MIN_LEN=96256}return i(e,[{key:"init",value:function(){var e=this;this._m3u8=new a.default(this._config),this._m3u8.on(n.default.MANIFEST_PARSED,this._onManifest.bind(this)),this._m3u8.on(n.default.HLS_FRAG_LOAD_PROGRESS,this._onFragProgress.bind(this)),this._m3u8.on(n.default.HLS_FRAG_LOADED,this._onFragLoaded.bind(this)),this._m3u8.on(n.default.LEVEL_SWITCHED,this._onLevelSwitched.bind(this)),this._m3u8.on(n.default.LEVEL_UPDATED,this._onLevelUpdated.bind(this)),this._m3u8.on(n.default.LEVEL_LOADED,this._onLevelLoaded.bind(this)),this._m3u8.on(n.default.ERROR,function(t){e._observer.trigger(n.default.ERROR,t)}),this._m3u8.on(n.default.END,function(){e._observer.trigger(n.default.END)}),this._m3u8.init()}},{key:"destroy",value:function(){var e=this._m3u8;e&&(e.removeAllListeners(),e.destroy(),this._m3u8=null);var t=this._demuxer;t&&(t.destroy(),this._demuxer=null)}},{key:"loadSource",value:function(){this._m3u8.loadSource()}},{key:"pause",value:function(){this._paused=!0,this._m3u8.pause()}},{key:"resume",value:function(){this._paused=!1,this._m3u8.resume()}},{key:"seek",value:function(e){this._m3u8&&this._m3u8.seek(e),this._seek=!0,this._reset()}},{key:"getStreamTime",value:function(){}},{key:"getBitrates",value:function(){return this._m3u8?this._m3u8.getBitrates():[]}},{key:"selectBitrate",value:function(e,t){this._m3u8&&this._m3u8.selectBitrate(e,t),this._frag=null,this._seek=!0,this._reset()}},{key:"_reset",value:function(){this._cache.flush(),this._progressCount=0,this._paused=!1,this._demuxer.reset(),this._remuxer.resetInitSegment(),this._remuxer.resetTimeStamp()}},{key:"_getFragsInfo",value:function(){if(this._m3u8&&this._m3u8.currentLevel&&this._m3u8.currentLevel.details){var e=[],t=!0,r=!1,i=void 0;try{for(var a,n=this._m3u8.currentLevel.details.fragments[Symbol.iterator]();!(t=(a=n.next()).done);t=!0){var s=a.value;e.push({start:s.start,url:s.url})}}catch(e){r=!0,i=e}finally{try{!t&&n.return&&n.return()}finally{if(r)throw i}}return e}return null}},{key:"_onManifest",value:function(e){this._observer.trigger(n.default.MANIFEST_PARSED,e)}},{key:"_onFragProgress",value:function(e){if(this._config.hlsStreamingMux){var t={type:u.REPORT_TYPES.LOADER_CHUNK_ARRIVAL,byteLength:e.data.byteLength,ts:Date.now()};this._observer.trigger("report",t);var r=this._cache;r.pushData(e.data);var i=188*Math.floor(r.unreadLen/188)-this.MUX_MIN_LEN,a=e.context.frag,n=this._frag,s=!(n&&a.level===n.level);this._timeOffset=isNaN(a.startDTS)?a.start:a.startDTS,this._discontinuity=(!(n&&a.cc===n.cc)||s)&&0===this._progressCount;var o=n&&a.sn===n.sn+1;if(this._contiguous=!s&&o||this._progressCount>0,i<this.MUX_MIN_LEN||this._paused)return;var l=r.getData(i);this._push(l,this._timeOffset,this._contiguous,this._discontinuity,!this._seek),this._progressCount++}}},{key:"_onFragLoaded",value:function(e){if(this._config.hlsStreamingMux){this._progressCount>0&&(this._discontinuity=!1,this._contiguous=!0),this._progressCount=0;var t=this._cache,r=188*Math.floor(t.unreadLen/188);if(!this._paused){if(r){var i=t.getData(r);this._push(i,this._timeOffset,this._contiguous,this._discontinuity,!this._seek)}t.flush(),this._demuxer.flush()}this._frag=e.context.frag}else{var a={type:u.REPORT_TYPES.LOADER_CHUNK_ARRIVAL,byteLength:e.data.byteLength,ts:Date.now()};this._observer.trigger("report",a);var n=e.context.frag,s=isNaN(n.startDTS)?n.start:n.startDTS,o=this._frag,l=!(o&&n.level===o.level),f=!(o&&n.cc===o.cc)||l,d=o&&n.sn===o.sn+1,c=!l&&d;this._push(new Uint8Array(e.data),s,c,f,!this._seek),this._frag=n}}},{key:"_onLevelSwitched",value:function(){this._observer.trigger(n.default.LEVEL_SWITCHED,{bitrate:this._m3u8.currentLevel.bitrate,smooth:!1,level:this._m3u8.currentLevel})}},{key:"_onLevelUpdated",value:function(e){this._totalduration=e.details.totalduration,this._observer.trigger(n.default.LEVEL_UPDATED,this._getFragsInfo())}},{key:"_onLevelLoaded",value:function(e){this._observer.trigger(n.default.LEVEL_LOADED,e)}},{key:"_push",value:function(e,t,r,i,a){this._seek=!1;var u=this._demuxer;if(!u||i&&!this.probe(e)){for(var f=this._observer,d=this._typeSupported,c=this._demuxConfig,h=[{Demux:s.default,Remux:o.default}],_=0,p=h.length;_<p;_++){var v=h[_],m=v.Demux.probe;if(m(e)){var y=this._remuxer=new v.Remux(f,c,d,this.vendor);u=new v.Demux(f,y,c,d),this.probe=m;break}}if(!u)return void this._observer.trigger(n.default.ERROR,{type:l.ErrorTypes.MUX_ERROR,details:l.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this._demuxer=u}var g=this._remuxer;i&&(u.resetInitSegment(null,null,null,this._totalduration),u.resetTimeStamp(),g.resetInitSegment(),g.resetTimeStamp()),u.append(e,t,r,a)}},{key:"_selectLoader",value:function(){var e=this._config;this._config.hlsStreamingMux?d.default.isSupport()?e.fragLoader=d.default:h.default.isSupport()?e.fragLoader=h.default:(e.fragLoader=c.default,this._config.hlsStreamingMux=!1):e.fragLoader=c.default,e.pLoader=c.default}}]),e}();t.default=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(r(5)),n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return i(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=a.default.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}();t.default=n},function(e,t,r){e.exports=r(24)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=b(r(25)),n=b(r(26)),s=b(r(43)),o=r(52),u=b(r(20)),l=b(r(2)),f=r(0),d=b(r(53)),c=r(4),h=b(r(54)),_=r(55),p=b(r(56)),v=b(r(57)),m=b(r(1)),y=r(3),g=b(r(19));function b(e){return e&&e.__esModule?e:{default:e}}function E(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var R=30,S=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=E(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.tag="flv-player",i.video=e,i.off||(i.off=i.removeListener),i.config=o.ConfigHelper.processConfig(r),i.config?(i.config.startFrom>0&&(i.video.currentTime=i.config.startFrom/1e3),i.box="flv",i.lazyloadPaused=!1,i.seekTimer=null,i._mainTimer=null,i.realtimeBeaconTimer=null,i.requestSetTime=!1,i._parseUrlConfig(),i.bindEvents(),i.attachMedia(),i.initLogger(),i._initFps(),i._startMainTimer(),i._bufferStrategyTime=i.config.bufferStrategyFirst,i._isSafari=navigator.userAgent.toLowerCase().indexOf("safari"),i._checkPlaybackRateCountdown=R,i._playbackRateManager=new h.default,i._heartbeatCountdown=0,i._heartbeatEnable=!1,i._seek=i._seek.bind(i),i._seekWithLoad=i._seekWithLoad.bind(i),i._seekBlockCountdown=0,f.Log.i("kernel",t.version),f.Log.i(i.tag,"isLive",i.config.isLive),i):(setTimeout(function(){i.emit("error",{errno:_.ERRORNO.CONFIG_DATA_ERROR,errmsg:"config data error"})},0),E(i))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.default),i(t,null,[{key:"isSupport",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=window.MediaSource||window.WebKitMediaSource,r=window.SourceBuffer||window.WebKitSourceBuffer,i=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),a=!r||r.prototype&&"function"==typeof r.prototype.appendBuffer&&"function"==typeof r.prototype.remove,n=!e||fetch||navigator.userAgent.toLowerCase().indexOf("firefox")>-1;return!!i&&!!a&&n}},{key:"version",get:function(){return"1.0.12"}}]),i(t,[{key:"_initFps",value:function(){this._fps=new v.default,this._fps.attachMedia(this.video)}},{key:"initLogger",value:function(){var e=this;this.logger=new d.default(t.version,this.video,this.config),this.logger.on("report",function(t){e.emit("report",t)})}},{key:"bindEvents",value:function(){this.video&&(this._onVideoCanplay=this._onVideoCanplay.bind(this),this._onVideoWaiting=this._onVideoWaiting.bind(this),this._onVideoPlaying=this._onVideoPlaying.bind(this),this._onVideoError=this._onVideoError.bind(this),this._onVideoPlay=this._onVideoPlay.bind(this),this._onVideoEnded=this._onVideoEnded.bind(this),this.video.addEventListener("canplay",this._onVideoCanplay),this.video.addEventListener("waiting",this._onVideoWaiting),this.video.addEventListener("playing",this._onVideoPlaying),this.video.addEventListener("play",this._onVideoPlay),this.video.addEventListener("error",this._onVideoError),this.video.addEventListener("ended",this._onVideoEnded))}},{key:"unbindMediaSourceEvent",value:function(e){e.removeAllListeners()}},{key:"_onVideoPlay",value:function(){this.transmuxer||this.load(),this._startBeacon()}},{key:"_onVideoEnded",value:function(){this._stopBeacon()}},{key:"attachMedia",value:function(){var e=this;this.mediaSource=new a.default(this.video,this.config),this.mediaSource.on(m.default.ERROR,function(t){e._onError(t),e.transmuxer&&e.transmuxer.pause()}),this.mediaSource.on("bufferFull",function(){e.pauseTransmuxer()}),this.mediaSource.on("updateend",function(){e.onmseUpdateEnd()})}},{key:"load",value:function(e){e&&o.ConfigHelper.setSrc(this.config,e),this._heartbeatEnable=!0,"hls"===this.config.box?this.transmuxer=new s.default(this.config):this.transmuxer=new n.default(this.config),this.realtimeBeaconBuilder=new p.default(this.config.multipart?this.config.src.segments[0].url:this.transmuxer.getCurrentUrl(0)),this._startBeacon(),this.transmuxer.bufferedLengthFun=this._getBufferedLength.bind(this),this.transmuxer.currentTimeFun=this._getCurrentTime.bind(this),this.transmuxerEvent(this.transmuxer),this.transmuxer.init(),this.transmuxer.loadSource()}},{key:"getStat",value:function(){return this.logger?{videodatarate:this.logger.data.videodatarate,audiodatarate:this.logger.data.audiodatarate,url:this.transmuxer.getCurrentUrl(1e3*this.video.currentTime),fps:this.logger.playingInfo.mediaInfo.fps}:null}},{key:"selectBitrate",value:function(e){var t=this;if(e!==this.getCurrentBitrate()){var r="flv"===this.config.box;this.transmuxer&&this.transmuxer.pause(),setTimeout(function(){t.mediaSource&&!r&&t.mediaSource.flush(),t.transmuxer&&t.transmuxer.selectBitrate(e),t._selectBitrate=!0,t._bitrateTimer||r||!g.default.chrome||(t._bitrateTimer=setInterval(function(){t._selectBitrate?t.isTimeinBuffered(t.video.currentTime)&&(t.video.currentTime=t.video.currentTime,t._selectBitrate=!1,clearInterval(t._bitrateTimer),t._bitrateTimer=null):(clearInterval(t._bitrateTimer),t._bitrateTimer=null)},100))},100)}}},{key:"getBitrates",value:function(){return this.transmuxer?this.transmuxer.getBitrates():[]}},{key:"transmuxerEvent",value:function(e){var t=this,r=this.mediaSource;e.on(m.default.PARSING_DATA,function(e){r.emit(m.default.PARSING_DATA,e)}),e.on(m.default.PARSING_INIT_SEGMENT,function(e){t.logger.record({type:c.REPORT_TYPES.MEDIA_SEGMENT_INIT,ts:Date.now()}),r.emit(m.default.PARSING_INIT_SEGMENT,e)}),e.on(m.default.ERROR,function(i){t._onError(i),e.pause(),r.pause()}),e.on(m.default.END,function(){r.endOfData()}),e.on(m.default.MEDIA_INFO,function(e){t.logger.record({type:c.REPORT_TYPES.MEDIA_INFO,data:e}),t.emit(m.default.REPORT,{type:"mediaInfo",value:e}),t.mediaInfo||t.video.addEventListener("seeking",t._seek),t.mediaInfo=e,r.init(e)}),e.on(m.default.REPORT,function(e){t.logger.record(e)}),e.on(m.default.LOST_FRAMES,function(e){t.realtimeBeaconBuilder.lostFrame(e.drop)}),e.on("adaptiveAlgorithm",function(e){return t.emit("adaptiveAlgorithm",e)}),e.on(m.default.LEVEL_SWITCHED,function(e){e.smooth||t.mediaSource.flush(),t.emit("levelSwitched",e.bitrate)}),e.on(m.default.SCRIPT_PARSED,function(e){e.hasOwnProperty("onMetaData")&&t.emit("report",{type:"metadata",value:e.onMetaData})}),e.on(m.default.MANIFEST_PARSED,function(e){t.emit("manifestParsed",e)})}},{key:"isTimeinBuffered",value:function(e){for(var t=this.video.buffered,r=0;r<t.length;r++){var i=t.start(r),a=t.end(r);if(e>=i&&e<a)return!0}return!1}},{key:"_getBufferEnd",value:function(e,t){for(var r=0;r<e.length;r++){var i=e.start(r),a=e.end(r);if(i<=t&&t<a)return a}return null}},{key:"getCurrentBufferEnd",value:function(){return this._getBufferEnd(this.video.buffered,this.video.currentTime)}},{key:"_getCurrentTime",value:function(){return this.video?1e3*this.video.currentTime:0}},{key:"_seek",value:function(){var e=this.video.currentTime;return this.isTimeinBuffered(e)||this.requestSetTime?this.requestSetTime=!1:0===e&&this.video.buffered.start(0)<1?this.video.currentTime=this.video.buffered.start(0):this._seekDelay(),e}},{key:"_seekDelay",value:function(){this._clearSeekDelay(),this._seekDelayId=setTimeout(this._seekWithLoad.bind(this),200)}},{key:"_clearSeekDelay",value:function(){this._seekDelayId&&(clearTimeout(this._seekDelayId),this._seekDelayId=0)}},{key:"_seekWithLoad",value:function(){var e=this;if(!this.config.isLive&&this.transmuxer){var t=this.video.currentTime;this.transmuxer.pause();var r=this.transmuxer.getNearestKeyframe(Math.floor(1e3*t));r&&(t=r.keyframetime/1e3),this.seekTimer=setTimeout(function(){e.mediaSource.flush(t),e.transmuxer.seek(r)},100),this.config.alwaysSeekKeyframe&&(this.video.currentTime=t,this.requestSetTime=!0),this.lazyloadPaused=!1}}},{key:"onmseUpdateEnd",value:function(){this.mediaSource.sourceBuffer.video&&this.realtimeBeaconBuilder.videoBufferedUpdated(this.mediaSource.sourceBuffer.video.buffered),this.config.isLive||this.getCurrentBufferEnd()>=this.video.currentTime+this.config.lazyLoadMaxDuration&&!this.lazyloadPaused&&(f.Log.v(this.tag,"Maximum buffering duration exceeded, suspend transmuxing task"),this.pauseTransmuxer())}},{key:"_mainLoop",value:function(){var e=this.video;this._heartbeatEnable&&(this._heartbeatCountdown<=0&&(this._heartbeatCountdown=5,this._heartbeat()),this._heartbeatCountdown--);var t=this.getCurrentBufferEnd();if(this.config.isLive){if(this.config&&this.config.adaptiveMultiRate&&!this.video.paused)if(this._checkPlaybackRateCountdown)this._checkPlaybackRateCountdown--;else{var r=t-this.video.currentTime;this._changePlaybackRate(this._playbackRateManager.nextPlayBackRate(r,this.video.playbackRate)),this._checkPlaybackRateCountdown=3}this.mediaSource&&this.mediaSource.doUpdate()}if(null===t){var i=this.video.buffered,a=i.length;a>0&&i.start(a-1)>e.currentTime+.001&&i.length>1&&this.isTimeinBuffered(e.currentTime+1)&&(this.video.currentTime=i.start(a-1)+1),0===this.video.currentTime&&a>0&&i.start(a-1)>=.1&&this.isTimeinBuffered(e.currentTime+.3)&&(this.video.currentTime=i.start(a-1)+.3)}this.video.seeking&&this.isTimeinBuffered(this.video.currentTime+.01)&&(1===this._seekBlockCountdown?(this.video.currentTime+=.01,this._seekBlockCountdown++):this._seekBlockCountdown>4?(this.video.currentTime=this.video.buffered.start(0),this._seekBlockCountdown=0):this._seekBlockCountdown++)}},{key:"_changePlaybackRate",value:function(e){this.video.playbackRate!==e&&(f.Log.v("Change playback rate from "+this.video.playbackRate+" to "+e),this.video.playbackRate=e,this.realtimeBeaconBuilder.playbackSpeedChanged(e))}},{key:"_sendRealtimeBeacon",value:function(){if(this.transmuxer)try{this.realtimeBeaconBuilder.setPlayUrl("flv"===this.config.box?this.transmuxer.getCurrentUrl(1e3*this.video.currentTime):this.config.src)}catch(e){f.Log.v(this.tag,"transmuxer url empty")}try{if(this.mediaSource.sourceBuffer.audio){var e=this._getBufferEnd(this.mediaSource.sourceBuffer.audio.buffered,this.video.currentTime);this.realtimeBeaconBuilder.setAudioBufferedSec(e-this.video.currentTime)}if(this.mediaSource.sourceBuffer.video){var t=this._getBufferEnd(this.mediaSource.sourceBuffer.video.buffered,this.video.currentTime);this.realtimeBeaconBuilder.setVideoBufferedSec(t-this.video.currentTime)}}catch(e){}var r=this.realtimeBeaconBuilder.buildAndStartNewInterval();f.Log.v(this.tag,"realtimeBeacon"),this.emit("report",{type:"realtimeBeacon",value:r})}},{key:"_onVideoCanplay",value:function(){this._checkAutoplay(),this.logger.record({type:c.REPORT_TYPES.CANPLAY,ts:Date.now()})}},{key:"_checkAutoplay",value:function(){this.video&&this.video.autoplay&&!this._autoplayChecked&&(this._callVideoplay(),this._autoplayChecked=!0)}},{key:"_onVideoWaiting",value:function(){if(this.video&&!this.video.seeking){this.transmuxer.waitingBuffered(this._bufferStrategyTime),this._increaseBufferTime();var e=this._getBufferedLength();f.Log.i(this.tag,"waiting currentTime:",this.video.currentTime,"bufferedLength:",e),this.realtimeBeaconBuilder.bufferingStarted(e)}}},{key:"_increaseBufferTime",value:function(){this._bufferStrategyTime=this._bufferStrategyTime||this.config.bufferStrategyFirst,this._bufferStrategyTime>=0&&this._bufferStrategyTime<1e3?this._bufferStrategyTime+=this.config.bufferStrategyIncrementStep:this._bufferStrategyTime>=1e3&&this._bufferStrategyTime<2e3?this._bufferStrategyTime+=.8*this.config.bufferStrategyIncrementStep:this._bufferStrategyTime>=2e3&&this._bufferStrategyTime<3e3?this._bufferStrategyTime+=.6*this.config.bufferStrategyIncrementStep:this._bufferStrategyTime>=3e3&&this._bufferStrategyTime<4e3?this._bufferStrategyTime+=.4*this.config.bufferStrategyIncrementStep:this._bufferStrategyTime>=4e3&&this._bufferStrategyTime<5e3&&(this._bufferStrategyTime+=.2*this.config.bufferStrategyIncrementStep),this._bufferStrategyTime=Math.min(this._bufferStrategyTime,this.config.bufferStrategyLimit)}},{key:"_onVideoPlaying",value:function(){f.Log.i(this.tag,"playing");var e=this._getBufferedLength();this.logger.record({type:c.REPORT_TYPES.PLAYING,buffered:e,ts:Date.now()}),this.realtimeBeaconBuilder.bufferingEnded()}},{key:"_onVideoError",value:function(e){f.Log.e(this.tag,"video error",e.target.error),this._onError({type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.VIDEO_ERROR,fatal:!0,reason:e.target.error})}},{key:"_callVideoplay",value:function(){var e=this,t=this.video.play();return void 0!==t&&t.then(function(){}).catch(function(t){f.Log.e(e.tag,"can not autoplay!",t),e.emit("error",{errno:_.ERRORNO.VIDEO_ELEMENT_PLAY_ERROR,errmsg:t.message})}),t}},{key:"pauseTransmuxer",value:function(){this.transmuxer.pause(),this.mediaSource.pause(),this.lazyloadPaused=!0}},{key:"resume",value:function(){f.Log.i(this.tag,"call resume"),this._seek(0)}},{key:"destroy",value:function(){window.clearInterval(this.seekTimer),this._stopMainTimer(),this._stopBeacon(),this.video.removeEventListener("canplay",this._onVideoCanplay),this.video.removeEventListener("seeking",this._seek),this.video.removeEventListener("waiting",this._onVideoWaiting),this.video.removeEventListener("playing",this._onVideoPlaying),this.video.removeEventListener("play",this._onVideoPlay),this.video.removeEventListener("ended",this._onVideoEnded),this.video.removeEventListener("error",this._onVideoError),this.video&&(URL.revokeObjectURL(this.video.src),this.video.src="",this.video.removeAttribute("src"),this.transmuxer&&(this.transmuxer.bufferedLengthFun=null,this.transmuxer.currentTimeFun=null,this.transmuxer.removeAllListeners(),this.transmuxer.pause(),this.transmuxer.destroy(),this.transmuxer=null),this.mediaSource&&(this.unbindMediaSourceEvent(this.mediaSource),this.mediaSource.destroy(),this.mediaSource=null)),this.logger&&(this.logger.removeAllListeners(),this.logger=null),this.lazyloadPaused=!1,clearInterval(this._bitrateTimer),this._bitrateTimer=null}},{key:"seek",value:function(e){f.Log.i(this.tag,"call kernel seek"),this.config.isLive||(this.video.currentTime=e)}},{key:"play",value:function(){return f.Log.i(this.tag,"call kernel play"),this._callVideoplay()}},{key:"pause",value:function(){return f.Log.i(this.tag,"call kernel pause"),this.video.pause()}},{key:"refresh",value:function(){f.Log.i(this.tag,"call kernel refresh"),this.transmuxer&&this.mediaSource?this._seek(0):f.Log.v(this.tag,"transmuxer & mediaSource not ready")}},{key:"stopLoad",value:function(){f.Log.i(this.tag,"call kernel stopLoad"),this.transmuxer&&this.transmuxer.pause(),this._stopBeacon()}},{key:"getStreamTime",value:function(e){return e=parseInt(e,10),this.transmuxer?this.transmuxer.getStreamTime(e):NaN}},{key:"_getBufferedLength",value:function(){return this.video&&this.video.buffered.length>0?1e3*(this.video.buffered.end(this.video.buffered.length-1)-this.video.currentTime):0}},{key:"testNextResolution",value:function(e){this.transmuxer.testNextResolution(e)}},{key:"getCurrentBitrate",value:function(){return this.transmuxer.getCurrentBitrate()}},{key:"_parseUrlConfig",value:function(){var e=location.href.match(/kwaiKernelLog=([a-z]{1})/)?location.href.match(/kwaiKernelLog=([a-z]{1})/)[1]:f.LOG_LEVEL.LEVEL_ERROR;this.config.kwaiKernelLog=e,f.Log.level(e),u.default.setLogLevel(e)}},{key:"_heartbeat",value:function(){var e={totalReceive:this.logger.data.totalLoaded,speed:this.logger.getLoadSpeed(),videoDataRate:this.logger.data.videoDataRate,audioDataRate:this.logger.data.audioDataRate,decodedFPS:this.logger.data.decodedFPS,droppedFPS:this.logger.data.droppedFPS,decodedFrames:this.logger.data.decodedFrames,droppedFrames:this.logger.data.droppedFrames};if(this._fps&&(this.logger.setFPS(this._fps.checkFPSInterval()),this.logger.refresh()),this.transmuxer&&this.transmuxer.heartbeat(),this.emit("report",{type:"heartbeat",value:e}),this.realtimeBeaconBuilder.updateDownloadedBytes(e.totalReceive),this.lazyloadPaused&&!this.video.seeking){var t=this.getCurrentBufferEnd(),r=this.video.currentTime;t-r<this.config.lazyLoadRecoverDuration&&(this.lazyloadPaused=!1,f.Log.v(this.tag,"Continue loading from paused position",t,r),this.transmuxer.resume(),this.mediaSource.resume())}}},{key:"_onError",value:function(e){e.fatal&&this.stopLoad();var t={errno:_.ERRORNO.UNKNOW,errmsg:e.reason||"unknow"};switch(e.type){case y.ErrorTypes.NETWORK_ERROR:t.errno=_.ERRORNO.NET_ERROR,t.statusCode=e.statusCode,t.url=e.url;break;case y.ErrorTypes.MSE_ERROR:switch(e.details){case y.ErrorDetails.APPENDBUFFER_ERROR:t.errno=_.ERRORNO.APPENDBUFFER_ERROR;break;case y.ErrorDetails.ENDOFSTREAM_ERROR:t.errno=_.ERRORNO.ENDOFSTREAM_ERROR;break;case y.ErrorDetails.MEDIASOURCE_ERROR:t.errno=_.ERRORNO.MEDIASOURCE_ERROR;break;default:t.errno=_.ERRORNO.SOURCEBUFFER_ERROR}break;case y.ErrorTypes.MEDIA_ERROR:t.errno=_.ERRORNO.FORMAT_ERROR,e.details===y.ErrorDetails.CANNOT_SEEK&&(t.errno=_.ERRORNO.CANNOT_SEEK);break;case y.ErrorTypes.MUX_ERROR:case y.ErrorTypes.OTHER_ERROR:t.errno=_.ERRORNO.FORMAT_ERROR}this.emit("error",t)}},{key:"_startBeacon",value:function(){null===this.realtimeBeaconTimer&&(this.realtimeBeaconTimer=setInterval(this._sendRealtimeBeacon.bind(this),1e4)),this._heartbeatEnable=!0}},{key:"_stopBeacon",value:function(){this.realtimeBeaconTimer&&(window.clearInterval(this.realtimeBeaconTimer),this._sendRealtimeBeacon(),this.realtimeBeaconTimer=null),this._heartbeatEnable=!1,this._heartbeatCountdown=5}},{key:"_startMainTimer",value:function(){null===this._mainTimer&&(this._mainTimer=setInterval(this._mainLoop.bind(this),200))}},{key:"_stopMainTimer",value:function(){this._mainTimer&&(window.clearInterval(this._mainTimer),this._mainTimer=null)}},{key:"monitorDataJson",get:function(){return this.logger.dataJson}},{key:"monitorData",get:function(){return this.logger.data}}]),t}();t.default=S},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=u(r(2)),n=r(0),s=u(r(1)),o=r(3);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(i.video=e,i.config=r,i.tag="mse-controller",i.e={onSourceOpen:i.onSourceOpen.bind(i),onSourceEnded:i.onSourceEnded.bind(i),onSourceClose:i.onSourceClose.bind(i),onSourceBufferError:i.onSourceBufferError.bind(i),onSourceBufferUpdateEnd:i.onSourceBufferUpdateEnd.bind(i)},i.hasVideo=!1,i.hasAudio=!1,i.removeRangesList={video:[],audio:[]},i.removeBucketing=!1,i.timer={video:null,audio:null},i.queue={video:[],audio:[]},i.sourceBuffer={video:null,audio:null},i.mimeCodec={video:null,audio:null},i.sourceBufferEvent(),i.complete=!1,MediaSource){var a=i.mediaSource=new MediaSource;i.video.src=URL.createObjectURL(a),a.addEventListener("sourceopen",i.e.onSourceOpen),a.addEventListener("sourceended",i.e.onSourceEnded),a.addEventListener("sourceclose",i.e.onSourceClose)}else i.emit(s.default.ERROR,{type:o.ErrorTypes.MSE_ERROR,details:o.ErrorDetails.MEDIASOURCE_ERROR,fatal:!0,reason:"MediaSource is not support"});return i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"init",value:function(e){e.hasAudio&&e.audioCodec&&(this.mimeCodec.audio='audio/mp4; codecs="'+e.audioCodec+'"',this.hasAudio=!0),e.hasVideo&&e.videoCodec&&(this.mimeCodec.video='video/mp4; codecs="'+e.videoCodec+'"',this.hasVideo=!0),this.mediaSource&&"open"===this.mediaSource.readyState&&(this.hasAudio&&this.addSourceBuffer("audio"),this.hasVideo&&this.addSourceBuffer("video"))}},{key:"onSourceOpen",value:function(){n.Log.i(this.tag,"MediaSource onSourceOpen"),this.mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this.hasAudio&&this.addSourceBuffer("audio"),this.hasVideo&&this.addSourceBuffer("video"),this.hasQueueList()&&this.doUpdate(),this.emit("source_open")}},{key:"addSourceBuffer",value:function(e){if(!this.sourceBuffer[e]){try{this.sourceBuffer[e]=this.mediaSource.addSourceBuffer(this.mimeCodec[e])}catch(e){return n.Log.e(this.tag,e),void this.emit(s.default.ERROR,{type:o.ErrorTypes.MSE_ERROR,details:o.ErrorDetails.ADDSOURCEBUFFER_ERROR,fatal:!0,reason:e.message})}var t=this.sourceBuffer[e];t.addEventListener("error",this.e.onSourceBufferError),t.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}}},{key:"hasRemoveList",value:function(){return this.removeRangesList.video.length||this.removeRangesList.audio.length}},{key:"hasQueueList",value:function(){return this.queue.video.length||this.queue.audio.length}},{key:"doUpdate",value:function(){if(this._needFlush())this.cleanRangesList();else{for(var e in this.queue)if(this.queue[e].length>0&&this.sourceBuffer[e]&&!this.sourceBuffer[e].updating&&!this.appendBufferError){var t=this.queue[e].shift();this.appendBuffer(t,e)}this._waitingEnd&&this.endOfStream()}}},{key:"sourceBufferEvent",value:function(){var e=this;this._segLen=0,this.on(s.default.PARSING_DATA,function(t){var r=t.type;e.queue[r].push(t.data),e._segLen+=t.data.byteLength,e.sourceBuffer[r]&&e.doUpdate()}),this.on(s.default.PARSING_INIT_SEGMENT,function(t){var r=t.type;n.Log.v(e.tag,"PARSING_INIT_SEGMENT",r),e.queue[r].push(t.data)})}},{key:"needCleanupSourceBuffer",value:function(e){var t=this.video.currentTime;if(this.sourceBuffer[e]&&!this.video.seeking){var r=this.sourceBuffer[e].buffered;if(r.length>=1&&t-r.start(0)>=this.config.autoCleanupMaxBackwardDuration)return!0}return!1}},{key:"doCleanupSourceBuffer",value:function(e){var t=this.video.currentTime-this.config.autoCleanupMinBackwardDuration,r=this.sourceBuffer[e];if(r&&!this.video.seeking){for(var i=0;i<r.buffered.length;i++){var a=r.buffered.start(i),n=r.buffered.end(i);if(!(t>a))break;t<n&&(n=Math.floor(t)),this.removeRangesList[e].push({start:a,end:n})}r.updating||this.cleanRangesList(e)}}},{key:"cleanRangesList",value:function(e){if(!this.sourceBuffer[e]||this.sourceBuffer[e].updating)return!1;for(var t=this.sourceBuffer[e];this.removeRangesList[e].length&&!t.updating;){var r=this.removeRangesList[e].shift();r.end<=r.start&&(r.start=r.end-1),t.remove(r.start,r.end)}return!0}},{key:"appendBuffer",value:function(e,t){if(this.sourceBuffer[t])try{this.sourceBuffer[t].appendBuffer(e.buffer)}catch(e){n.Log.w(this.tag,e.code,e),22!==e.code?(this.appendError?this.appendError++:this.appendError=1,this.appendError>this.config.appendErrorMaxRetry&&(this.appendBufferError=!0,this.emit(s.default.ERROR,{type:o.ErrorTypes.MSE_ERROR,details:o.ErrorDetails.APPENDBUFFER_ERROR,fatal:!0,reason:e.message}))):(this.queue[t].unshift(),this.emit("bufferFull"))}}},{key:"onSourceEnded",value:function(){n.Log.i(this.tag,"MediaSource onSourceEnded")}},{key:"onSourceClose",value:function(){n.Log.i(this.tag,"MediaSource onSourceClose"),this.mediaSource&&null!==this.e&&(this.mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this.mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this.mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))}},{key:"onSourceBufferUpdateEnd",value:function(){if(this.sourceBuffer){for(var e in this.sourceBuffer)this.sourceBuffer[e]&&!this.sourceBuffer[e].updating&&this.needCleanupSourceBuffer(e)&&this.doCleanupSourceBuffer(e);if(this._needFlush())this._doFlush();else if(this.hasQueueList())this.doUpdate();else if(this.complete){var t=0;for(var r in this.sourceBuffer){var i=this.sourceBuffer[r];i&&i.updating&&t++}t||this.endOfStream()}this.emit("updateend")}}},{key:"onSourceBufferError",value:function(e){n.Log.e(this.tag,"SourceBuffer Error: "+e),this.emit(s.default.ERROR,{type:o.ErrorTypes.MSE_ERROR,details:o.ErrorDetails.SOURCEBUFFER_ERROR,fatal:!0,reason:e.message})}},{key:"flush",value:function(){for(var e in this._waitingEnd=!1,this.sourceBuffer){var t=this.sourceBuffer[e];if(t){this.queue[e]=[];for(var r=0;r<t.buffered.length;r++){var i=t.buffered.start(r),a=t.buffered.end(r);this.removeRangesList[e].push({start:i,end:a})}}}this._needFlush()&&this._doFlush()}},{key:"resume",value:function(){this.doUpdate()}},{key:"pause",value:function(){}},{key:"endOfData",value:function(){this.hasQueueList()?this._waitingEnd=!0:this.endOfStream()}},{key:"endOfStream",value:function(){if(this.mediaSource){var e=this.mediaSource;this.complete=!0;var t=this.sourceBuffer;if(t.video&&t.video.updating||t.audio&&t.audio.updating)return;if("open"===e.readyState)try{e.endOfStream(),this.complete=!1}catch(e){n.Log.e(this.tag,e),this.emit(s.default.ERROR,{type:o.ErrorTypes.MSE_ERROR,details:o.ErrorDetails.ENDOFSTREAM_ERROR,fatal:!0,reason:e.message})}}}},{key:"destroy",value:function(){if(this.mediaSource){var e=this.mediaSource;if(this.complete=!1,this.endOfStream(),this.sourceBuffer&&"closed"!==e.readyState)for(var t in this.sourceBuffer)this.sourceBuffer[t].removeEventListener("error",this.e.onSourceBufferError),this.sourceBuffer[t].removeEventListener("updateend",this.e.onSourceBufferUpdateEnd),e.removeSourceBuffer(this.sourceBuffer[t]);e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this.mediaSource=null}this.removeAllListeners(),this.queue=null,this.sourceBuffer=null,this.mimeCodec=null}},{key:"_needFlush",value:function(){var e=this.removeRangesList;for(var t in e)if(e[t].length>0)return!0;return!1}},{key:"_doFlush",value:function(){var e=this.removeRangesList;for(var t in e)this.sourceBuffer[t]?this.cleanRangesList(t):e[t]=[]}}]),t}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=c(r(27)),s=c(r(20)),o=c(r(2)),u=r(4),l=r(0),f=c(r(11)),d=c(r(1));function c(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.tag="transmuxerProxy",r._config={},Object.assign(r._config,e),r._representationIndex=0,r._segmentCache=null,r.MAX_CACHE_LEN=300,r._qosStatInterval=2,r._qosStatIntervalCount=0,r._currentGopDuration=0,r._downloadSize=0,r._downloadStartTime=Date.now(),r._referenceTime={dtsA:0,dtsAStream:0,dtsV:0,refA:0,refV:0,refTime:0,requestStartTime:0},r._bitrates=[],r._keyCount=0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),a(t,[{key:"init",value:function(){this._initMultiRate(),this._currentTransmuxer=new n.default(this._config),this._transmuxerEvent(this._currentTransmuxer),this._config.multipart||(this._currentUrl=this._config.src)}},{key:"loadSource",value:function(){this.emit(d.default.REPORT,{type:u.REPORT_TYPES.NEW_SOURCE,index:this._representationIndex,sync:this._referenceTime.refTime||0,url:this._config.url}),this._currentTransmuxer.loadSource()}},{key:"testNextResolution",value:function(e){var t=(this._representationIndex+e+this._manifest.adaptationSet.representation.length)%this._manifest.adaptationSet.representation.length;this._changeResolution(t)}},{key:"_getBufferedLength",value:function(){if(this._bufferedLength){var e=0;return this._segmentCache&&(e=this._segmentCache.endDts-this._segmentCache.dts),this._bufferedLength()+e}return NaN}},{key:"_flushSegmentCache",value:function(){if(this._segmentCache){var e=!0,t=!1,r=void 0;try{for(var i,a=this._segmentCache.cache[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var n=i.value;this.emit(d.default.PARSING_DATA,n)}}catch(e){t=!0,r=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw r}}this._segmentCache=null}}},{key:"_changeResolution",value:function(e){var t={};if(this._flushSegmentCache(),this._manifest&&this._manifest.adaptationSet.representation.length>e&&e!==this._representationIndex){var r=this._referenceTime;this._representationIndex=e,this._keyCount=0,Object.assign(t,this._config),t.src=this._manifest.adaptationSet.representation[e].url,this._currentTransmuxer.destroy(),this._unbindTransmuxerEvent(this._currentTransmuxer),t.src=this._handleRequestUrl(t.src,r.requestStartTime),this._currentUrl=t.src,r.refTime=Math.min(r.refA,r.refV),t.alignBase=r.refTime||0,this._currentTransmuxer=new n.default(t),this._transmuxerEvent(this._currentTransmuxer),this._currentTransmuxer.loadSource(),this._adaptiveQosStat.playStartTime=Date.now(),l.Log.v("changeResolution",r.refTime),this.emit(d.default.REPORT,{type:u.REPORT_TYPES.NEW_SOURCE,index:e,sync:r.refTime||0,url:this._config.url}),this.emit(d.default.LEVEL_SWITCHED,{bitrate:this._manifest.adaptationSet.representation[e].bitrate,smooth:!0})}}},{key:"pause",value:function(){this._currentTransmuxer.pause()}},{key:"resume",value:function(){this._currentTransmuxer.resume()}},{key:"seek",value:function(e){this._currentTransmuxer.seek(e)}},{key:"isSeekable",value:function(){return this._currentTransmuxer.isSeekable()}},{key:"getNearestKeyframe",value:function(e){return this._currentTransmuxer.getNearestKeyframe(e)}},{key:"destroy",value:function(){this._unbindTransmuxerEvent(this._currentTransmuxer),this._currentTransmuxer.destroy(),this._currentTransmuxer=null,this._destroyAdaptiveMultiRate(),this.segmentCache=null}},{key:"waitingBuffered",value:function(e){this._segmentCache={cache:[],dts:0,endDts:0,needBufferLen:e}}},{key:"getStreamTime",value:function(e){var t=this._referenceTime;return t?e-t.dtsA+t.dtsAStream:NaN}},{key:"getCurrentUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._config.multipart){var t=0;for(t=0;t<this._config.src.segments.length&&!(this._config.src.segments[t].time>e);t++);return this._config.src.segments[Math.max(0,t-1)].url}return this._currentUrl}},{key:"heartbeat",value:function(){if(this._multiRateAdaption){var e=this._getBufferedInfo();this._multiRateAdaption.heartbeatReport(e),this._qosStatIntervalCount%this._qosStatInterval==0&&this._sendAdaptiveQosStat(),this._qosStatIntervalCount=(this._qosStatIntervalCount+1)%this._qosStatInterval}}},{key:"getCurrentBitrate",value:function(){return this._bitrates.length?this._bitrates[this._representationIndex]:null}},{key:"getBitrates",value:function(){return this._bitrates}},{key:"selectBitrate",value:function(e){if(e<=0)this._createAdaptiveMultiRate();else if(this._bitrates.length){this._destroyAdaptiveMultiRate();for(var t=this._bitrates.length-1;t>=0;t--)if(this._bitrates[t]<=e)return void this._changeResolution(t)}}},{key:"_transmuxerEvent",value:function(e){var t=this;e.on(d.default.PARSING_DATA,function(e){e.data=new Uint8Array(e.data),t.emit(d.default.REPORT,{type:u.REPORT_TYPES.MEDIA_SEGMENT,byteLength:e.data.byteLength,ts:Date.now(),segmentType:e.type,pts:e.info.startPts,keyFrame:!!e.info.key}),"audio"===e.type?(t._referenceTime.dtsA=e.info.endDts,t._referenceTime.dtsAStream=e.info.streamDts):"video"===e.type&&(t._referenceTime.dtsV=e.info.endDts),t._segmentCache&&(t._segmentCache.dts=t._segmentCache.dts||e.info.startDts,t._segmentCache.endDts=e.info.endDts,t._segmentCache.endDts-t._segmentCache.dts<t._segmentCache.needBufferLen&&t._segmentCache.cache.length<t.MAX_CACHE_LEN?t._segmentCache.cache.push({type:e.type,data:e.data}):(t._segmentCache.cache.push({type:e.type,data:e.data}),l.Log.i(t.tag,"segment buffered",t._segmentCache.needBufferLen),t._flushSegmentCache())),t.emit(d.default.PARSING_DATA,{type:e.type,data:e.data})}),e.on(d.default.PARSING_INIT_SEGMENT,function(e){t.emit(d.default.PARSING_INIT_SEGMENT,e)}),e.on(d.default.ERROR,function(e){t.emit(d.default.ERROR,e)}),e.on(d.default.END,function(e){t.emit(d.default.END,e)}),e.on(d.default.MEDIA_INFO,function(e){t.emit(d.default.MEDIA_INFO,e)}),e.on(d.default.REPORT,function(e){e.type===u.REPORT_TYPES.LOADER_CHUNK_ARRIVAL&&(t._downloadSize+=e.byteLength),t.emit(d.default.REPORT,e)}),e.on(d.default.SCRIPT_PARSED,this._processScriptData.bind(this)),e.on(d.default.LOST_FRAMES,function(e){t.emit(d.default.LOST_FRAMES,e)}),e.on(d.default.IDR,function(){t._keyCount++;var e=t._referenceTime;if(e.refA=e.dtsA,e.refV=e.dtsV,e.requestStartTime=e.dtsAStream,t._multiRateAdaption&&t._keyCount>1){var r=t._getBufferedInfo(),i=t._multiRateAdaption.nextBitrateIndex(r);i!==t._representationIndex&&t._changeResolution(i)}})}},{key:"_processScriptData",value:function(e){e.hasOwnProperty("onMetadata")&&this.emit(d.default.SCRIPT_PARSED,e)}},{key:"_unbindTransmuxerEvent",value:function(e){e.removeAllListeners()}},{key:"_handleRequestUrl",value:function(e,t){var r=new f.default(e,!0);return r.query.ks_start_time=t,r.toString()}},{key:"_createAdaptiveMultiRate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._adaptiveMultiRate&&!this._multiRateAdaption&&(this._multiRateAdaption=new s.default(this._manifest,this._config.liveAdaptiveConfig,t?null:{index:this._representationIndex,buffer:this._getBufferedLength()||0}),this._multiRateAdaption.on("adaptiveAlgorithm",function(t){return e.emit("adaptiveAlgorithm",t)}))}},{key:"_destroyAdaptiveMultiRate",value:function(){this._multiRateAdaption&&(this._multiRateAdaption.removeAllListeners(),this._multiRateAdaption=null)}},{key:"_initMultiRate",value:function(){if(this._manifest=this._config.manifest,this._adaptiveMultiRate=this._config.adaptiveMultiRate,this._adaptiveMultiRate){this._manifest.adaptationSet.representation.sort(function(e,t){return e.bitrate-t.bitrate}),this._bitrates=[];var e=!0,t=!1,r=void 0;try{for(var i,a=this._manifest.adaptationSet.representation[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var n=i.value;this._bitrates.push(n.bitrate)}}catch(e){t=!0,r=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw r}}if(this._config.bitrateStart){for(var s=this._bitrates.length-1;s>=0;s--)if(this._bitrates[s]<=this._config.bitrateStart){this._representationIndex=s;break}}else this._createAdaptiveMultiRate(!0),this._representationIndex=this._multiRateAdaption.nextBitrateIndex({buffered:0,details:[],download:{size:0,duration:0}})||0;this._config.src=this._handleRequestUrl(this._manifest.adaptationSet.representation[this._representationIndex].url,this._referenceTime.requestStartTime),this._adaptiveQosStat={},this._adaptiveQosStat.playStartTime=this._adaptiveQosStat.tickStart=Date.now()}}},{key:"_sendAdaptiveQosStat",value:function(){var e=this._multiRateAdaption.getQos();l.Log.v("alg::qos",e);var t=i({type:u.REPORT_TYPES.LIVE_ADAPTIVE_QOS_STAT,play_url:this._currentUrl,play_start_time:this._adaptiveQosStat.playStartTime,tick_start:this._adaptiveQosStat.tickStart,current_gop_duration:this._currentGopDuration,buffer_time:Math.floor(this._getBufferedLength())},e);this._adaptiveQosStat.tickStart=Date.now(),this.emit(d.default.REPORT,t)}},{key:"_getBufferedInfo",value:function(){var e={currentTime:Math.floor(this._getCurrentTime()),buffered:Math.floor(this._getBufferedLength()),download:{size:this._downloadSize,duration:Date.now()-this._downloadStartTime}};return this._downloadStartTime=Date.now(),this._downloadSize=0,e}},{key:"bufferedLengthFun",set:function(e){this._bufferedLength=e}},{key:"currentTimeFun",set:function(e){this._getCurrentTime=e}}]),t}();t.default=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=d(r(2)),n=d(r(12)),s=r(0),o=r(4),u=d(r(1)),l=r(3),f=d(r(13));function d(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.tag="transmuxer",r._config=e||{},r._config.multipart&&(r._keyframesIndex=r._config.src.keyframesIndex),r._keyframePoint=!1,r._w=null;var i=r._observer=new a.default;i.trigger=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];i.emit.apply(i,[e,e].concat(r))},i.off=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];i.removeListener.apply(i,[e].concat(r))};var o=r._onMessage.bind(r);return i.on(u.default.METADATA,o),i.on(u.default.MEDIA_INFO,o),i.on(u.default.PARSING_INIT_SEGMENT,o),i.on(u.default.PARSING_DATA,o),i.on(u.default.ERROR,o),i.on(u.default.SCRIPT_PARSED,o),i.on(u.default.LOST_FRAMES,o),i.on(u.default.REPORT,o),i.on(u.default.IDR,o),r._config.webWorker?(s.Log.i(r.tag,"webWorker"),r._onWorkMessage=r._onWorkMessage.bind(r),r._w=(0,n.default)(36),r._w.addEventListener("message",r._onWorkMessage),r._w.postMessage(JSON.parse(JSON.stringify({cmd:"init",config:e})))):(r._flv=new f.default,r._flv.init()),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"_onWorkMessage",value:function(e){var t=e.data;e.data.event===u.default.PARSING_DATA&&(t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2))),this._onMessage(e.data.event,t.data)}},{key:"switchStream",value:function(e){this._config.webWorker?this._w.postMessage({cmd:"switchStream",data:e}):this._flv.switchStream(e)}},{key:"loadSource",value:function(){this._config.webWorker?this._w.postMessage({cmd:"loadSource"}):this._flv.loadSource()}},{key:"_onMessage",value:function(e,t){switch(e){case u.default.MEDIA_INFO:this._mediaInfo=t,this.emit(u.default.MEDIA_INFO,t);break;case u.default.PARSING_INIT_SEGMENT:if(Array.isArray(t)){var r=!0,i=!1,a=void 0;try{for(var n,s=t[Symbol.iterator]();!(r=(n=s.next()).done);r=!0){var l=n.value;this.emit(u.default.PARSING_INIT_SEGMENT,l)}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}}break;case u.default.PARSING_DATA:var f={type:o.REPORT_TYPES.MEDIA_SEGMENT,ts:Date.now(),byteLength:t.data1.byteLength,segmentType:t.type,pts:Math.floor(1e3*t.startPTS),keyFrame:!1,streamDts:1e3*t.streamDTS,endStreamDts:Math.floor(1e3*t.endStreamDts),startPts:Math.floor(1e3*t.startPTS),startDts:Math.floor(1e3*t.startDTS),endDts:Math.floor(1e3*t.endDTS),key:!!t.key};t.data2?(f.byteLength+=t.data2.byteLength,this.emit(u.default.PARSING_DATA,{data:this._mergeBoxes(t.data1,t.data2),type:t.type,info:f})):this.emit(u.default.PARSING_DATA,{data:t.data1,type:t.type,info:f}),this.emit(u.default.REPORT,f);break;case u.default.LOST_FRAMES:this.emit(u.default.LOST_FRAMES,t);break;case u.default.SCRIPT_PARSED:this.emit(u.default.SCRIPT_PARSED,t);break;case u.default.REPORT:this.onReport(t);break;case u.default.IDR:this.emit(u.default.IDR);break;case u.default.ERROR:this.emit(u.default.ERROR,t);break;case u.default.END:this.emit(u.default.END)}}},{key:"_mergeBoxes",value:function(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r}},{key:"_discontinuityCallback",value:function(e){this._baseTime=e,this._discontinuity=!0}},{key:"onReport",value:function(e){"demux"===e.type?this.emit(u.default.REPORT,{type:o.REPORT_TYPES.MEDIA_DEMUX_FLV,ts:e.ts}):this.emit(u.default.REPORT,e)}},{key:"pause",value:function(){this._config.webWorker?this._w.postMessage({cmd:"pause"}):this._flv.pause()}},{key:"resume",value:function(){this._config.webWorker?this._w.postMessage({cmd:"resume"}):this._flv.resume()}},{key:"isSeekable",value:function(){return!!this._keyframesIndex}},{key:"seek",value:function(e){this.isSeekable()?this._config.webWorker?this._w.postMessage({cmd:"seek",keyframe:e}):this._flv.seek(e):this.emit(u.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.CANNOT_SEEK,fatal:!0,reason:"can not seek"})}},{key:"destroy",value:function(){this._config.webWorker&&(this._w.postMessage({cmd:"destroy"}),this._w.removeEventListener("message",this._onWorkMessage),this._w.terminate()),this._flv&&(this._flv=null);var e=this._observer;e&&(e.removeAllListeners(),this._observer=null)}},{key:"getNearestKeyframe",value:function(e){if(this._keyframesIndex){var t=this._keyframesIndex.times,r=this._keyframesIndex.filepositions;return function e(i,a){var n=i.length,s=Math.floor(n/2);if(1===n){var o=t.indexOf(i[0]);return{keyframetime:i[0],keyframePoint:r[o]}}if(i[s]>a)return e(i.slice(0,s),a);if(i[s]<a)return e(i.slice(s),a);var u=t.indexOf(i[0]);return{keyframetime:i[0],keyframePoint:r[u]}}(t,e)}return 0}}]),t}();t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=p(r(14)),s=p(r(29)),o=p(r(6)),u=p(r(30)),l=p(r(32)),f=p(r(1)),d=r(0),c=p(r(15)),h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(17)),_=r(3);function p(e){return e&&e.__esModule?e:{default:e}}var v=13,m=function(){function e(t,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mediaInfo=new l.default,this._requestLen=v,this._parseFun=this._parseFlvHead,this._cache=new o.default,this._observer=t,this._remux=r,this._config=i,this._needAlignment=!!i.alignBase,this._duration=0,this._naluLengthSize=4,this._dtsOffset=0,this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],len:0,timescale:9e4,inputTimeScale:9e4},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],len:0,timescale:9e4,inputTimeScale:9e4},this._firstTag=!0,this._skipLostFrame=i.skipLostFrame||!1,this._contiguous=!1,this._accurateTimeOffset=!0,this._syncCache=[],this._syncCacheMinSize=25,this._syncCacheSize=25,this._resetSyncInfo(),this._firstRemux=!0}return a(e,[{key:"setFlv",value:function(e,t,r,i){for(this._cache.pushData(e),this._contiguous=r,this._accurateTimeOffset=i,t&&(this._dtsOffset=t);this._cache.unreadLen>=this._requestLen;)this._parseFun();this._flushTag()}},{key:"seek",value:function(e){this._dtsOffset=e||0,this.flush()}},{key:"destroy",value:function(){}},{key:"flush",value:function(){this._firstRemux=!0,this._requestLen=11,this._parseFun=this._parseFlvTagHead,this._cache.flush(),this._videoTrack.samples=[],this._videoTrack.len=0,this._audioTrack.samples=[],this._audioTrack.len=0,this._syncCache=[],this._resetSyncInfo()}},{key:"_parseFlvHead",value:function(){var e=this._cache.readData(v);70===e[0]&&76===e[1]&&86===e[2]&&1===e[3]||this._observer.trigger(f.default.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: wrong head"}),this._mediaInfo.hasAudio=(4&e[4])>>>2!=0,this._mediaInfo.hasVideo=0!=(1&e[4]),this._cache.skip(v),this._requestLen=11,this._parseFun=this._parseFlvTagHead}},{key:"_parseFlvTagHead",value:function(){this._tag=new s.default;var e=this._cache.readData(11);this._tag.tagType=e[0],this._tag.dataSize=((255&e[1])<<16)+((255&e[2])<<8)+(255&e[3]),this._tag.timestamp=((255&e[7])<<24)+((255&e[4])<<16)+((255&e[5])<<8)+(255&e[6]),this._currentTimestamp=this._tag.timestamp,this._cache.skip(11),9===this._tag.tagType?(this._parseFun=this._checkVideoTagType,this._requestLen=2):(this._parseFun=this._parseFlvTag,this._requestLen=this._tag.dataSize+4)}},{key:"_checkVideoTagType",value:function(){var e=this._cache.readData(2),t=(240&e[0])>>>4,r=e[1];1===t&&1===r&&(this._flushTag(),this._observer.trigger(f.default.IDR)),this._parseFun=this._parseFlvTag,this._requestLen=this._tag.dataSize+4}},{key:"_parseFlvTag",value:function(){this._firstTag&&(this._observer.trigger(f.default.REPORT,{type:"demux",ts:Date.now()}),this._firstTag=!1);var e=this._tag;18===e.tagType||8===e.tagType||9===e.tagType?(e.body=this._cache.getData(e.dataSize),this._cache.skip(4),9===e.tagType&&this._mediaInfo.hasVideo&&this._parseVideoData(e),8===e.tagType&&this._mediaInfo.hasAudio&&this._parseAudioData(e),18===e.tagType&&this._parseScriptTag(e)):this._observer.trigger(f.default.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.PARSING_ERROR,fatal:!1,reason:"Flv: wrong tagType: "+e.tagType}),this._requestLen=11,this._parseFun=this._parseFlvTagHead}},{key:"_parseScriptTag",value:function(e){var t=u.default.parseMetadata(e.body);if(t.timestamp=this._currentTimestamp||0,t.hasOwnProperty("onMetaData")){this._metadata=t;var r=this._metadata.onMetaData;if(this._mediaInfo.audioDataRate=r.audiodatarate,this._mediaInfo.videoDataRate=r.videodatarate,this._mediaInfo.width=r.width,this._mediaInfo.height=r.height,this._mediaInfo.duration=r.duration,this._duration=this._flvDuration?this._flvDuration:r.duration,this._mediaInfo.fps=r.framerate,"object"===i(r.keyframes)){this._mediaInfo.hasKeyframesIndex=!0;var a=r.keyframes;a.times=r.times,a.filepositions=r.filepositions,this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(a),r.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;d.Log.i(this.tag,"Parsed onMetaData")}this._observer.trigger(f.default.SCRIPT_PARSED,t)}},{key:"_parseVideoData",value:function(e){var t=e.body[0];e.frameType=(240&t)>>>4;var r=15&t;if(7===r){var i=e.body[1];if(e.cts=((255&e.body[2])<<16)+((255&e.body[3])<<8)+(255&e.body[4]),0===i)this._parseAVCDecoderConfigurationRecord(e,5);else if(1===i)this._parseAVCVideoData(e,5);else if(2!==i)return void this._observer.trigger(f.default.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid video packet type "+i})}else this._observer.trigger(f.default.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Unsupported codec in video frame: "+r})}},{key:"_parseAVCDecoderConfigurationRecord",value:function(e,t){var r=this._videoTrack,i=e.body.buffer,a=e.body.byteLength-t,n=new DataView(i,t,a),s=this._mediaInfo,o=n.getUint8(0),u=n.getUint8(1);if(1===o&&0!==u)if(this._naluLengthSize=1+(3&n.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var l=31&n.getUint8(5);if(0===l||l>1)this._observer.trigger(f.default.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid H264 SPS count: "+l});else{var h=6;r.sps=[];for(var p=0;p<l;p++){var v=n.getUint16(h);if(h+=2,0!==v){var m=new Uint8Array(i,t+h,v);h+=v,r.sps.push(m);var y=c.default.parseSPS(m);r.width=y.codec_size.width,r.height=y.codec_size.height,r.pixelRatio=[y.sar_ratio.width,y.sar_ratio.height],y.frame_rate.fixed&&0!==y.frame_rate.fps&&(s.fps=y.frame_rate.fps);for(var g=m.subarray(1,4),b="avc1.",E=0;E<3;E++){var R=g[E].toString(16);R.length<2&&(R="0"+R),b+=R}r.codec=b,this._syncCacheSize=Math.max(5*s.fps,this._syncCacheMinSize),this._timeInfo.avcSampleDuration=Math.ceil(1e3/s.fps)||40,s.videoCodec=b,s.width=r.width,s.height=r.height,s.profile=y.profile_string,s.level=y.level_string,s.chromaFormat=y.chroma_format_string,s.hasAudio?s.audioCodec&&(s.mimeType='video/x-flv; codecs="'+s.videoCodec+","+s.audioCodec+'"'):s.mimeType='video/x-flv; codecs="'+s.videoCodec+'"'}}var S=n.getUint8(h);if(0===S||S>1)this._observer.trigger(f.default.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid H264 PPS count: "+S});else{h++,r.pps=[];for(var k=0;k<S;k++){var T=n.getUint16(h);h+=2;var L=new Uint8Array(i,t+h,T);r.pps.push(L),0!==T&&(h+=T)}d.Log.v(this.tag,"Parsed AVCDecoderConfigurationRecord"),r.duration=this._duration,r.container="video/mp4",s.fps?r.refSampleDuration=Math.floor(r.timescale/s.fps):r.refSampleDuration=Math.floor(r.timescale/30),this._onTrackMetadata("video",r)}}}else this._observer.trigger(f.default.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1)});else this._observer.trigger(f.default.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid AVCDecoderConfigurationRecord"})}},{key:"_updateSyncCache",value:function(){if(this._syncCache.length>0){if(this._timeInfo.aacCurrentDts>this._syncCache[0].tag.timestamp){var e=this._syncCache.shift();this._parseAVCVideoData(e.tag,e.dataOffset,!0),this._updateSyncCache()}if(this._syncCache.length>this._syncCacheSize){d.Log.w(this.tag,"out of sync cache!!");var t=this._syncCache.shift();this._parseAVCVideoData(t.tag,t.dataOffset,!0)}}}},{key:"_parseAVCVideoData",value:function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.body.buffer,a=e.body.byteLength-t,n=new DataView(i,t,a),s=[],o=0,u=0,l=this._naluLengthSize,f=e.timestamp,c=1===e.frameType,h=f,_=0;_<this._timeInfo.aacFixedRecord.length;_++)if(f>this._timeInfo.aacFixedRecord[_].ed){this._timeInfo.aacFixedRecord.splice(0,_);break}if(this._timeInfo.avcLastDemuxedDts&&this._skipLostFrame&&this._mediaInfo.hasAudio&&h-this._timeInfo.avcLastDemuxedDts>2*this._timeInfo.avcSampleDuration){for(var p=!1,v=0;v<this._timeInfo.aacFixedRecord.length;v++)if(h<this._timeInfo.aacFixedRecord[v].ed){h-=this._timeInfo.aacFixedRecord[v].fix,p=!0,this._timeInfo.aacFixedRecord[v].ed===Number.POSITIVE_INFINITY&&f>this._timeInfo.aacCurrentDts&&(h=f,p=!1);break}if(!r&&(!p&&f>this._timeInfo.aacCurrentDts||this._syncCache.length>0))return this._syncCache.push({tag:e,dataOffset:t}),void this._updateSyncCache()}h<=this._timeInfo.avcLastDemuxedDts&&(h=this._timeInfo.avcLastDemuxedDts+1);for(var m=h+e.cts;u<a;){if(u+4>=a){d.Log.v(this.tag,"Malformed Nalu near timestamp "+f+", offset = "+u+", dataSize = "+a);break}var y=n.getUint32(u);if(3===l&&(y>>>=8),y>a-l)return void d.Log.v(this.tag,"Malformed Nalus near timestamp "+f+", NaluSize > DataSize!");var g=31&n.getUint8(u+l);5===g&&(c=!0);var b=new Uint8Array(i,t+u+4,l+y-4),E={type:g,data:b};s.push(E),o+=b.byteLength,u+=l+y}if(s.length){var R=this._videoTrack,S={units:s,length:o,dts:90*h,cts:90*e.cts,pts:90*m,streamDts:f,key:c};R.samples.push(S),R.len+=o}this._timeInfo.avcLastDemuxedDts=h}},{key:"_parseAudioData",value:function(e){var t=e.body.byteLength,r=this._timeInfo;if(t<=1)d.Log.v(this.tag,"Flv: Invalid audio packet, missing SoundData payload!");else{var i=this._audioTrack,a=e.body[1];if(0===a){if(e.body.byteLength<4)return;h.initTrackConfig(i,this._observer,e.body,0,null,"flv"),i.isAAC=!0,i.duration=this._duration,i.timescale=i.samplerate;var n=this._mediaInfo;return n.audioCodec=i.codec,n.audioSampleRate=i.samplerate,n.audioChannelCount=i.channelCount,void this._onTrackMetadata("audio",i)}if(1===a){var s=e.body.subarray(2),o=e.timestamp;r.aacFirstDts||(r.aacFirstDts=o);var u=o-Math.floor(r.aacFirstDts+r.aacCurrentDtsOffset)-r.aacCurrentFixedLen;u>Math.max(r.aacFrameLen-1,1)&&(r.aacCurrentFixedLen+=u,r.aacFixedRecord.length&&(r.aacFixedRecord[r.aacFixedRecord.length-1].ed=o-u),r.aacFixedRecord.push({st:o,fix:r.aacCurrentFixedLen,ed:Number.POSITIVE_INFINITY}),this._observer.trigger(f.default.LOST_FRAMES,{drop:u,fix:r.aacCurrentFixedLen}),d.Log.i(this.tag,"lost aac frame. aac dts diff:",u,r.aacCurrentFixedLen)),r.aacFrameLen=1024e3/i.samplerate;var l=o;this._skipLostFrame&&(l=Math.floor(r.aacFirstDts+r.aacCurrentDtsOffset));var c=l*i.inputTimeScale/1e3,_={unit:s,dts:c,pts:c,streamDts:o};r.aacCurrentDtsOffset+=r.aacFrameLen,r.aacCurrentDts=o,this._updateSyncCache(),i.samples.push(_),i.len+=s.length}else d.Log.v(this.tag,"Flv: Unsupported AAC data type "+a)}}},{key:"_resetSyncInfo",value:function(){this._timeInfo={aacFirstDts:0,aacCurrentDtsOffset:0,aacCurrentFixedLen:0,aacFixedRecord:[],aacFrameLen:0,aacCurrentDts:0,avcSampleDuration:40,avcLastDemuxedDts:0}}},{key:"_onTrackMetadata",value:function(e,t){var r=void 0,i=void 0,a=[],s=this._mediaInfo,o={width:s.width,height:s.height,hasAudio:s.hasAudio,audioCodec:s.audioCodec,audioSampleRate:s.audioSampleRate,hasVideo:s.hasVideo,videoCodec:s.videoCodec,fps:s.fps,chromaFormat:s.chromaFormat,profile:s.profile};switch(this._observer.trigger(f.default.MEDIA_INFO,o),e){case"video":this._remux._videoMeta=t,r=n.default.initSegment([t]),a.push({type:"video",data:r});break;case"audio":this._remux._audioMeta=t,i=n.default.initSegment([t]),a.push({type:"audio",data:i})}this._flushTag(),this._observer.trigger(f.default.PARSING_INIT_SEGMENT,a)}},{key:"_flushTag",value:function(){var e=this._audioTrack,t=this._videoTrack,r=this._mediaInfo;if(!(r.hasVideo&&t.samples.length<5||0===e.samples.length&&0===t.samples.length||this._firstRemux&&r.hasAudio&&r.hasVideo&&(0===e.samples.length||0===t.samples.length))){this._firstRemux=!1,this._needAlignment&&(this._dtsOffset=this._config.alignBase/1e3,this._needAlignment=!1);try{this._remux.remux(e,t,this._dtsOffset,this._contiguous,this._accurateTimeOffset)}catch(e){d.Log.v(this.tag,e),this._observer.trigger(f.default.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.REMUX_ERROR,fatal:!0,reason:e.message})}}}},{key:"duration",set:function(e){this._flvDuration=e/1e3,this._duration=this._duration|this._flvDuration}},{key:"mediaInfo",get:function(){return this._mediaInfo}}]),e}();t.default=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tagType=-1,this.dataSize=-1,this.timestamp=-1,this.body=-1,this.size=-1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(r(31)),n=r(0),s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tag="AMF"}return i(e,null,[{key:"parseObject",value:function(t,r,i){var a=e.parseString(t,r,i),n=e.parseScript(t,r+a.size),s=n.objectEnd;return{data:{name:a.data,value:n.data},size:n.size,objectEnd:s}}},{key:"parseVariable",value:function(t,r,i){return e.parseObject(t,r,i)}},{key:"parseLongString",value:function(e,t,r){var i=new DataView(e,t).getUint32(0);return{data:i>0?(0,a.default)(new Uint8Array(e,t+4,i)):"",size:4+i}}},{key:"parseDate",value:function(e,t,r){var i=new DataView(e,t),a=i.getFloat64(0),n=i.getInt16(8);return{data:new Date(a+=60*n*1e3),size:10}}},{key:"parseString",value:function(e,t,r){var i=new DataView(e,t).getUint16(0);return{data:i>0?(0,a.default)(new Uint8Array(e,t+2,i)):"",size:2+i}}},{key:"parseMetadata",value:function(t){var r=e.parseScript(t,0),i=e.parseScript(t,r.size,t.length-r.size),a={};return a[r.data]=i.data,a}},{key:"parseScript",value:function(t,r,i){var a=r,s=new Uint8Array(t).buffer,o=new DataView(s,0,i),u=null,l=o.getUint8(a);switch(a+=1,l){case 0:u=o.getFloat64(a),a+=8;break;case 1:u=!!o.getUint8(a),a+=1;break;case 2:var f=e.parseString(s,a);u=f.data,a+=f.size;break;case 3:u={};var d=0;for(9==(16777215&o.getUint32(i-4))&&(d=3);a<i-4;){var c=e.parseObject(s,a,i-r-d);if(c.objectEnd)break;u[c.data.name]=c.data.value,a=c.size}a<=i-3&&9==(16777215&v.getUint32(a-1))&&(a+=3);break;case 8:for(u={},a+=4,o.getUint32(i-4);a<i-8;){var h=e.parseVariable(s,a);if(h.objectEnd)break;u[h.data.name]=h.data.value,a=h.size}a<=i-3&&9==(16777215&o.getUint32(a-1))&&(a+=3);break;case 9:u=void 0,a=1,objectEnd=!0;break;case 10:u=[];var _=o.getUint32(a);a+=4;for(var p=0;p<_;p++){var m=e.parseScript(s,a);u.push(m.data),a=m.size}break;case 11:var y=e.parseDate(s,a+1,i-1);u=y.data,a+=y.size;break;case 12:var g=e.parseString(s,a+1,i-1);u=g.data,a+=g.size;break;default:a=i,n.Log.v(this.tag,"AMF","Unsupported AMF value type "+l)}return{data:u,size:a}}}]),e}();t.default=s},function(e,t,r){"use strict";function i(e,t,r){var i=e;if(t+r<i.length){for(;r--;)if(128!=(192&i[++t]))return!1;return!0}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=[],r=e,a=0,n=e.length;a<n;)if(r[a]<128)t.push(String.fromCharCode(r[a])),++a;else{if(r[a]<192);else if(r[a]<224){if(i(r,a,1)){var s=(31&r[a])<<6|63&r[a+1];if(s>=128){t.push(String.fromCharCode(65535&s)),a+=2;continue}}}else if(r[a]<240){if(i(r,a,2)){var o=(15&r[a])<<12|(63&r[a+1])<<6|63&r[a+2];if(o>=2048&&55296!=(63488&o)){t.push(String.fromCharCode(65535&o)),a+=3;continue}}}else if(r[a]<248&&i(r,a,3)){var u=(7&r[a])<<18|(63&r[a+1])<<12|(63&r[a+2])<<6|63&r[a+3];if(u>65536&&u<1114112){u-=65536,t.push(String.fromCharCode(u>>>10|55296)),t.push(String.fromCharCode(1023&u|56320)),a+=4;continue}}t.push(String.fromCharCode(65533)),++a}return t.join("")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,null,[{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=l(r(7)),n=l(r(9)),s=l(r(10)),o=l(r(35)),u=r(4);function l(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tag="Ioloader",this._loader=null,this._config=t||{},this._totalReceive=0,this._seekPoint=-1,this._selectLoader()}return i(e,[{key:"onLoaderChunkArrival",value:function(e,t){this._totalReceive+=t.byteLength,this._callbacks&&(e.ts=Date.now(),-1!==this._seekPoint?(this._callbacks.onProgress(e,t,this._seekPoint),this._seekPoint=-1):this._callbacks.onProgress(e,t))}},{key:"pause",value:function(){this.paused=!0,this._loader.pause()}},{key:"open",value:function(e,t,r){this._callbacks=e,this._callbacks.onInfo({type:"loadInfo",data:{type:u.REPORT_TYPES.LOADER_OPEN,ts:Date.now()}}),void 0===r&&(this._seekPoint=-1),this._loaderCallbacks=Object.assign([],this._callbacks),this._loaderCallbacks.onProgress=this.onLoaderChunkArrival.bind(this),this._loader.open({src:this._config.src,range:{from:t||0,to:-1},progress:!0,responseType:"arraybuffer"},this._loaderCallbacks,this._config)}},{key:"resume",value:function(){this.paused=!1;var e=this._totalReceive;this._config.multipart?this._loader.resume():this.open(this._callbacks,e)}},{key:"seek",value:function(e,t){this._loader.destroy(),this._seekPoint=t,this._totalReceive=e,this.open(this._callbacks,e,t)}},{key:"destroy",value:function(){this._callbacks=null,this._loaderCallbacks=null,this.pause()}},{key:"_selectLoader",value:function(){var e=this._config,t=this._config.src;this._config.multipart?this._loader=new o.default(t,e,this.queryHandle):a.default.isSupport()?this._loader=new a.default:s.default.isSupport()?this._loader=new s.default:n.default.isSupport()&&(this._loader=new n.default)}}]),e}();t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=c(r(2)),n=c(r(7)),s=c(r(9)),o=c(r(10)),u=r(0),l=r(4),f=c(r(6)),d=c(r(5));function c(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.tag="MultiPartLoader",i._manifest=e,i._config=r,i._loaderClass=null,i._loader=null,i._segmentIndex=0,i._autoNext=!0,i._sliceFlvHead=!1,i._paused=!1,i._firstOpen=!0,i._periodId=NaN,i._segmentLoadSize=0,i._segmentLoadTime=0,i._partContext=null,i._cache=new f.default,i._selectLoader(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"open",value:function(e,t,r){this._context=e,this._callbacks=t,this._initLoaderCallback();var i=void 0;this._autoNext=!0,this._seek=void 0!==r&&!this._firstOpen,this._paused=!1,this._seek?(this._sliceFlvHead=this._seek,i=this._firstOpen?this._seekByTime(this._config.startFromKeyframePoint||0):this._seekByBytes(this._context.range.from||0),this._nextSegment()):i=this._nextSegment(),this._firstOpen=!1,this._cache.flush(),this._loadSegment(i)}},{key:"pause",value:function(){u.Log.v(this.tag,"pause"),this._autoNext=!1,this._paused=!0,this._downloadReport("cancel",0)}},{key:"resume",value:function(){if(this._paused=!1,this._autoNext=!0,this._cache&&this._cache.unreadLen){var e=this._cache.getData(this._cache.unreadLen).buffer;this._callbacks.onProgress(this._partContext,e)}var t=this._nextSegment();this._loadSegment(t)}},{key:"destroy",value:function(){this._callbacks=null,this._disposeLoader(),this.loader=null}},{key:"_initLoaderCallback",value:function(){var e=this;this._loaderCallbacks={onProgress:this._onLoaderChunkArrival.bind(this),onEnd:function(){e._downloadReport("success",200),e._sliceFlvHead=!0,e._hasNextSegment()?e._autoNext&&e._loadSegment(e._nextSegment()):e._callbacks.onEnd()},onError:function(t,r){e._downloadReport("fail",r.status),e._callbacks.onError(t,r)}},this._loaderCallbacks.onInfo=this._callbacks.onInfo}},{key:"_selectLoader",value:function(){n.default.isSupport()?this._loaderClass=n.default:o.default.isSupport()?this._loaderClass=o.default:s.default.isSupport()&&(this._loaderClass=s.default)}},{key:"_onLoaderChunkArrival",value:function(e,t){this._partContext=e,this._segmentLoadSize+=t.byteLength,this._callbacks&&(this._sliceFlvHead&&(t=t.slice(13,t.byteLength),this._sliceFlvHead=!1),this._paused?this._cache.pushData(t):this._callbacks.onProgress(e,t))}},{key:"_loadSegment",value:function(e){this._disposeLoader(this._loader),this._loader=null,e&&(this._segment=e,this._config.baseURL&&(this._segment.url=d.default.buildAbsoluteURL(this._config.baseURL,this._segment.url,{alwaysNormalize:!0})),this._segmentLoadSize=0,this._segmentLoadTime=Date.now(),this._loader=new this._loaderClass(e.url,this._config),isNaN(this._periodId)||this._periodId===e.periodId||this._seek||(u.Log.v(this.tag,"DISCONTINUITY"),this._callbacks.onInfo({type:"discontinuity",data:e.time})),this._periodId=e.periodId,this._seek&&(this._seek=!1),this._loader.open({src:e.url,responseType:"arraybuffer",progress:!0},this._loaderCallbacks,this._config))}},{key:"_disposeLoader",value:function(e){e&&(e.arrivalDataCallback=null,e.destroy())}},{key:"_seekByBytes",value:function(e){var t=0;for(t=0;t<this._manifest.segments.length&&!(this._manifest.segments[t].fileposition>e);t++);return this._segmentIndex=Math.max(0,t-1),this._manifest.segments[this._segmentIndex]}},{key:"_seekByTime",value:function(e){var t=0;for(t=0;t<this._manifest.segments.length&&!(this._manifest.segments[t].time>e);t++);return this._segmentIndex=Math.max(0,t-1),this._manifest.segments[this._segmentIndex]}},{key:"_hasNextSegment",value:function(){return this._manifest.segments&&this._manifest.segments.length>this._segmentIndex}},{key:"_nextSegment",value:function(){var e=null;return this._manifest.segments&&this._manifest.segments.length>this._segmentIndex&&(e=this._manifest.segments[this._segmentIndex],this._segmentIndex++),e}},{key:"_downloadReport",value:function(e,t){var r=this._segment;this._callbacks.onInfo({type:"loadInfo",data:{type:l.REPORT_TYPES.MP_SLICE_LOAD_STAT,url:r.url,resourceType:this._manifest.type,downloaded:this._segmentLoadSize,filesize:r.filesize,cost:Date.now()-this._segmentLoadTime,stat:e,errorCode:t||0}})}}]),t}();t.default=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=void 0,r=this._observer=new i.default;r.trigger=function(e){for(var t,i=arguments.length,a=Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];(t=r).emit.apply(t,[e,e].concat(a))},r.off=function(e){for(var t,i=arguments.length,a=Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];(t=r).removeListener.apply(t,[e].concat(a))};var o=function(e,t){self.postMessage({event:e,data:t})};r.on(a.default.METADATA,o),r.on(a.default.MEDIA_INFO,o),r.on(a.default.PARSING_INIT_SEGMENT,o),r.on(a.default.ERROR,o),r.on(a.default.SCRIPT_PARSED,o),r.on(a.default.LOST_FRAMES,o),r.on(a.default.REPORT,o),r.on(a.default.IDR,o),r.on(a.default.END,o),r.on(a.default.PARSING_DATA,function(e,t){var r=[],i={event:e,data:t};t.data1&&(i.data1=t.data1.buffer,r.push(t.data1.buffer),delete t.data1),t.data2&&(i.data2=t.data2.buffer,r.push(t.data2.buffer),delete t.data2),self.postMessage(i,r)}),e.addEventListener("message",function(e){switch(e.data.cmd){case"init":var i=e.data.config;n.Log.level(i.kwaiKernelLog),function(e){(t=new s.default(r,e)).init()}(i);break;case"loadSource":t.loadSource();break;case"pause":t.pause();break;case"seek":t.seek(e.data.keyframe);break;case"resume":t.resume();break;case"destroy":t&&(t.destroy(),t=null),r&&(r.removeAllListeners(),r=null);break;case"switchStream":t.switchStream(e.data.data)}})};var i=o(r(2)),a=o(r(1)),n=r(0),s=o(r(13));function o(e){return e&&e.__esModule?e:{default:e}}r(37)},function(e,t,r){"use strict";ArrayBuffer.transfer||(ArrayBuffer.transfer=function(e,t){e=Object(e);var r=new ArrayBuffer(t);if(!(e instanceof ArrayBuffer&&r instanceof ArrayBuffer))throw new TypeError("Source and destination must be ArrayBuffer instances");if(r.byteLength>=e.byteLength){var i=0,a=e.byteLength;[8,4,2,1].forEach(function(t){if(a>=t){var n=function(e,t,r,i,a){var n=Uint8Array;switch(e){case 8:n=Float64Array;break;case 4:n=Float32Array;break;case 2:n=Uint16Array;break;case 1:default:n=Uint8Array}for(var s=new n(t,i,Math.trunc(a/e)),o=new n(r,i,Math.trunc(a/e)),u=0;u<o.length;u++)o[u]=s[u];return{nextOffset:s.byteOffset+s.byteLength,leftBytes:t.byteLength-(s.byteOffset+s.byteLength)}}(t,e,r,i,a);i=n.nextOffset,a=n.leftBytes}})}return r})},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";e.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},function(e,t,r){"use strict";var i=Object.prototype.hasOwnProperty;function a(e){return decodeURIComponent(e.replace(/\+/g," "))}t.stringify=function(e,t){t=t||"";var r=[];for(var a in"string"!=typeof t&&(t="?"),e)i.call(e,a)&&r.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return r.length?t+r.join("&"):""},t.parse=function(e){for(var t,r=/([^=?&]+)=?([^&]*)/g,i={};t=r.exec(e);){var n=a(t[1]),s=a(t[2]);n in i||(i[n]=s)}return i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=f(r(2)),n=f(r(12)),s=f(r(21)),o=f(r(1)),u=r(0),l=r(4);function f(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.tag="TransmuxerHls",r._config=e,r._typeSupported={mp4:MediaSource.isTypeSupported("video/mp4")},r._config.forceKeyFrameOnDiscontinuity=!1,r._frag=null,r._lastFrag=null,r._totalduration=0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"init",value:function(){if(this._config.webWorker)u.Log.i(this.tag,"webWorker"),this._w=(0,n.default)(51),this._onWorkerMessage=this._onWorkerMessage.bind(this),this._w.addEventListener("message",this._onWorkerMessage),this._w.postMessage(JSON.parse(JSON.stringify({cmd:"init",config:this._config,typeSupported:this._typeSupported})));else{var e=this._observer=new a.default;e.trigger=function(t){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];e.emit.apply(e,[t,t].concat(i))},e.off=function(t){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];e.removeListener.apply(e,[t].concat(i))};var t=this._onMessage.bind(this);e.on(o.default.PARSING_INIT_SEGMENT,t),e.on(o.default.PARSING_DATA,t),e.on(o.default.ERROR,t),e.on(o.default.LEVEL_UPDATED,t),e.on(o.default.LEVEL_SWITCHED,t),e.on(o.default.MANIFEST_PARSED,t),e.on(o.default.LEVEL_LOADED,t),e.on(o.default.REPORT,t),e.on(o.default.END,t),this._hls=new s.default(e,this._config,this._typeSupported),this._hls.init()}}},{key:"destroy",value:function(){var e=this._w;if(e)e.postMessage({cmd:"destroy"}),e.removeEventListener("message",this._onWorkerMessage),e.terminate(),this._w=null;else{var t=this._hls;t&&(t.destroy(),this.hls=null)}var r=this.observer;r&&(r.removeAllListeners(),this.observer=null)}},{key:"loadSource",value:function(){this.emit(o.default.REPORT,{type:l.REPORT_TYPES.NEW_SOURCE,index:0,sync:0,url:this._config.url}),this.emit(o.default.REPORT,{type:l.REPORT_TYPES.LOADER_OPEN,ts:Date.now()}),this._config.webWorker?this._w.postMessage({cmd:"loadSource"}):this._hls.loadSource()}},{key:"pause",value:function(){this._config.webWorker?this._w.postMessage({cmd:"pause"}):this._hls.pause()}},{key:"resume",value:function(){this._config.webWorker?this._w.postMessage({cmd:"resume"}):this._hls.resume()}},{key:"seek",value:function(e){this._config.webWorker?this._w.postMessage({cmd:"seek",data:e.keyframetime/1e3}):(this._hls&&this._hls.seek(e.keyframetime/1e3),this._seek=!0)}},{key:"heartbeat",value:function(){}},{key:"getStreamTime",value:function(e){}},{key:"getNearestKeyframe",value:function(e){var t=this._getFragInfo(e/1e3);return t?{keyframetime:1e3*t.start}:null}},{key:"getCurrentUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this._getFragInfo(e/1e3);return t?t.url:""}},{key:"waitingBuffered",value:function(){}},{key:"isSeekable",value:function(){return!this._config.isLive&&this._fragsInfo}},{key:"getBitrates",value:function(){return this._bitrates}},{key:"selectBitrate",value:function(e){var t=this._getCurrentTime();this._config.webWorker?this._w.postMessage({cmd:"selectBitrate",data:{bitrate:e,currentTime:t/1e3}}):this._hls&&this._hls.selectBitrate(e,t/1e3)}},{key:"getCurrentBitrate",value:function(){return this._currentLevel?this._currentLevel.bitrate:0}},{key:"_getFragInfo",value:function(e){if(this._fragsInfo)for(var t=this._fragsInfo.length-1;t>=0;t--)if(e>=this._fragsInfo[t].start)return this._fragsInfo[t];return null}},{key:"_onWorkerMessage",value:function(e){var t=e.data;e.data.event===o.default.PARSING_DATA&&(t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2))),this._onMessage(e.data.event,t.data)}},{key:"_onMessage",value:function(e,t){switch(e){case o.default.REPORT:this.emit(o.default.REPORT,t);break;case o.default.PARSING_INIT_SEGMENT:var r={hasVideo:!1,hasAudio:!1};if(t.tracks.video&&(r.hasVideo=!0,r.videoCodec=t.tracks.video.codec,r.width=t.tracks.video.metadata.width,r.height=t.tracks.video.metadata.height,r.fps=t.tracks.video.metadata.fps),t.tracks.audio&&(r.hasAudio=!0,r.audioCodec=t.tracks.audio.codec),this.emit(o.default.MEDIA_INFO,r),r.hasVideo){var i={type:"video",data:new Uint8Array(t.tracks.video.initSegment)};this.emit(o.default.PARSING_INIT_SEGMENT,i)}if(r.hasAudio){var a={type:"audio",data:new Uint8Array(t.tracks.audio.initSegment)};this.emit(o.default.PARSING_INIT_SEGMENT,a)}break;case o.default.PARSING_DATA:var n={type:l.REPORT_TYPES.MEDIA_SEGMENT,ts:Date.now(),byteLength:t.data1.byteLength,segmentType:t.type,pts:Math.floor(1e3*t.startPTS),keyFrame:!1};this.emit(o.default.PARSING_DATA,{data:t.data1,type:t.type}),t.data2&&(n.byteLength+=t.data2.byteLength,this.emit(o.default.PARSING_DATA,{data:t.data2,type:t.type})),this.emit(o.default.REPORT,n);break;case o.default.LEVEL_LOADED:this._currentLevel=t;break;case o.default.LEVEL_UPDATED:this._fragsInfo=t;break;case o.default.END:this.emit(o.default.END);break;case o.default.ERROR:this.emit(o.default.ERROR,t);break;case o.default.LEVEL_SWITCHED:this._currentLevel=t.level,this.emit(o.default.LEVEL_SWITCHED,t);break;case o.default.MANIFEST_PARSED:this._currentLevel=t,this._bitrates=t.bitrates,this.emit(o.default.MANIFEST_PARSED,t)}}},{key:"currentTimeFun",set:function(e){this._getCurrentTime=e}}]),t}();t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=d(r(2)),s=d(r(45)),o=d(r(1)),u=r(0),l=r(3),f=d(r(5));function d(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.tag="HLS",r._initConfig(e),r._manifest=null,r._fragPos=0,r._fragCallback={onProgress:r._onProgress.bind(r),onEnd:r._onEnd.bind(r),onError:r._onError.bind(r),onInfo:r._onInfo.bind(r)},r._canload=!1,r._canloadFrag=!1,r._firstLevel=0,r._currentLevelIndex=0,r._startTime=e.startFrom/1e3||null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.default),a(t,[{key:"init",value:function(){var e=this;this._playlistLoader=new s.default(this._config),this._playlistLoader.on(o.default.HLS_MANIFEST_LOADED,this._onManifestLoaded.bind(this)),this._playlistLoader.on(o.default.LEVEL_LOADED,this._onLevelLoaded.bind(this)),this._playlistLoader.on(o.default.ERROR,function(t){e.emit(o.default.ERROR,t)})}},{key:"destroy",value:function(){this._canload=this._canloadFrag=!1;var e=this._fragLoader;e&&(e.destroy(),this._fragLoader=null),this._playlistLoader&&(this._playlistLoader.removeAllListeners(),this._playlistLoader.destroy(),this._playlistLoader=null)}},{key:"loadSource",value:function(){var e={url:this._config.url};this._canload=!0,this._canloadFrag=!0,this._playlistLoader.loadManifest(e)}},{key:"pause",value:function(){this._canloadFrag=!1}},{key:"resume",value:function(){this._canloadFrag=!0,this._checkloadFrag()}},{key:"seek",value:function(e){var t=this.currentLevel;if(this._canloadFrag=!0,t&&t.details){this._fragLoader&&(this._fragLoader.destroy(),this._fragLoader=null),this._fragPos=this._getFragIndexByTime(e);var r=this.currentLevel.details.fragments[this._fragPos];return this._checkloadFrag(),this._startTime=null,r.start}return this._startTime=e,0}},{key:"getBitrates",value:function(){var e=[];if(this._levels){var t=!0,r=!1,i=void 0;try{for(var a,n=this._levels[Symbol.iterator]();!(t=(a=n.next()).done);t=!0){var s=a.value;e.push(s.bitrate)}}catch(e){r=!0,i=e}finally{try{!t&&n.return&&n.return()}finally{if(r)throw i}}}return e}},{key:"selectBitrate",value:function(e,t){var r=this.getBitrates().indexOf(e);-1!==r&&(this._fragLoader&&(this._fragLoader.destroy(),this._fragLoader=null),this._clearTimer(),this._currentLevelIndex=r,this.currentLevel&&this.currentLevel.details&&!this.currentLevel.details.live||this._loadLevel(),this.seek(t),this.emit(o.default.LEVEL_SWITCHED))}},{key:"_getFragByTime",value:function(e){return this.currentLevel.details.fragments[this._getFragIndexByTime(e)]}},{key:"_getFragIndexByTime",value:function(e){var t=this.currentLevel.details;if(t)for(var r=t.fragments.length-1;r>=0;r--)if(t.fragments[r].start<=e)return r;return 0}},{key:"_onManifestLoaded",value:function(e){u.Log.v(this.tag,"_onManifestLoaded",e);var t=[],r=void 0,i={},a=null,n=!1,s=!1,f=/chrome|firefox/.test(navigator.userAgent.toLowerCase());if(e.levels.forEach(function(e){e.loadError=0,e.fragmentError=!1,n=n||!!e.videoCodec,s=s||!!e.audioCodec||!(!e.attrs||!e.attrs.AUDIO),f&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(a=i[e.bitrate])?a.url.push(e.url):(e.url=[e.url],e.urlId=0,i[e.bitrate]=e,t.push(e))}),n&&s&&(t=t.filter(function(e){return!!e.videoCodec})),t.length>0){void 0===this._config.bitrateStart?(r=this._config.bitrateStart||t[0].bitrate,t=t.sort(function(e,t){return e.bitrate-t.bitrate})):(t=t.sort(function(e,t){return e.bitrate-t.bitrate}),r=this._config.bitrateStart||t[0].bitrate),this._levels=t;for(var d=t.length-1;d>=0;d--)if(t[d].bitrate<=r){this._firstLevel=d,this._currentLevelIndex=this._firstLevel,u.Log.v("manifest loaded,"+t.length+" level(s) found, first bitrate:"+r);break}this.emit(o.default.MANIFEST_PARSED,{bitrates:this.getBitrates(),bitrate:this.currentLevel.bitrate}),this._levels[this._currentLevelIndex].details?this._levelUpdated():this._loadLevel()}else this.emit(o.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.HLS_MANIFEST_PARSING_ERROR,fatal:!0,reason:"manifest parsing error"})}},{key:"_onLevelLoaded",value:function(e){var t=this,r=e.level;if(r===this._currentLevelIndex){var i=this._levels[r];i.fragmentError||(i.loadError=0,this.levelRetryCount=0);var a=e.details;if(a.live){var n=1e3*(a.averagetargetduration?a.averagetargetduration:a.targetduration),s=n,l=i.details;l&&a.endSN===l.endSN?(s/=2,u.Log.v("same live playlist, reload twice faster")):(this._mergeDetails(l,a),this._levelUpdated()),this._checkloadFrag(),s-=performance.now()-e.stats.trequest,s=Math.max(n/2,Math.round(s)),u.Log.v("live playlist, reload in "+Math.round(s)+" ms"),this._timer=setTimeout(function(){return t._loadLevel()},s)}else this._clearTimer(),i.details?this._mergeDetails(i.details,a):i.details=a,this._levelUpdated(),this._checkloadFrag();this.emit(o.default.LEVEL_LOADED,{bitrate:this.currentLevel.bitrate})}}},{key:"_levelUpdated",value:function(){this._startTime&&this.seek(this._startTime),this.emit(o.default.LEVEL_UPDATED,{details:this._levels[this._currentLevelIndex].details,level:this._currentLevelIndex})}},{key:"_mergeDetails",value:function(e,t){if(!(e.endSN>=t.endSN)){for(var r=0;r<t.fragments.length;r++)if(t.fragments[r].sn>e.endSN){var i=t.fragments[r];i.start=e.totalduration,e.totalduration+=i.duration,e.fragments.push(t.fragments[r])}e.endSN=t.endSN,e.endCC=t.endCC,e.averagetargetduration=e.totalduration/e.fragments.length}}},{key:"_loadLevel",value:function(){if(u.Log.v("call to loadLevel"),null!==this._currentLevelIndex&&this._canload){var e=this._levels[this._currentLevelIndex];if("object"===(void 0===e?"undefined":i(e))&&e.url.length>0){var t=this._currentLevelIndex,r=e.urlId,a=e.url[r];this._playlistLoader.loadLevel({url:a,level:t,id:r})}}}},{key:"_clearTimer",value:function(){null!==this._timer&&(clearTimeout(this._timer),this._timer=null)}},{key:"_selectLevel",value:function(){this._currentLevelIndex=0}},{key:"_checkloadFrag",value:function(){if(this._canloadFrag&&!this._fragLoader){var e=this._nextFragment(),t=this._levels[this._currentLevelIndex];e?this._loadFrag(e):t.details&&!t.details.live&&this.emit(o.default.END)}}},{key:"_loadFrag",value:function(e){if(e){var t=this._config.hlsStreamingMux,r=this._config.fragLoader,i={src:e.url,responseType:"arraybuffer",progress:t,frag:e};this._fragLoader=new r,this._fragLoader.open(i,this._fragCallback,this._fragLoadConfig)}}},{key:"_nextFragment",value:function(){var e=this._levels[this._currentLevelIndex];if(e&&e.details&&e.details.fragments.length>this._fragPos){var t=e.details.fragments[this._fragPos];return this._fragPos++,t}return null}},{key:"_onProgress",value:function(e,t,r){this.emit(o.default.HLS_FRAG_LOAD_PROGRESS,{context:e,data:t,stats:r})}},{key:"_onEnd",value:function(e,t,r){this._fragLoader=null,this.emit(o.default.HLS_FRAG_LOADED,{context:e,data:t,stats:r}),this._checkloadFrag()}},{key:"_onError",value:function(e,t){this.emit(o.default.ERROR,{type:l.ErrorTypes.NETWORK_ERROR,details:"timeout"===t.text?l.ErrorDetails.LOAD_TIMEOUT:l.ErrorDetails.LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code,url:e.src})}},{key:"_onInfo",value:function(){}},{key:"_initConfig",value:function(e){this._config={},this._config.pLoader=e.pLoader,this._config.loader=e.pLoader,this._config.fragLoader=e.fragLoader,this._config.manifestLoadingMaxRetry=3,this._config.manifestLoadingTimeOut=6e3,this._config.manifestLoadingRetryDelay=200,this._config.manifestLoadingMaxRetryTimeout=3e3,this._config.levelLoadingMaxRetry=3,this._config.levelLoadingTimeOut=6e3,this._config.levelLoadingRetryDelay=200,this._config.levelLoadingMaxRetryTimeout=3e3;var t=location.href;0===t.indexOf("blob:")&&(t=t.slice(5)),this._config.url=f.default.buildAbsoluteURL(t,e.src,{alwaysNormalize:!0}),this._config.bitrateStart=e.bitrateStart,this._config.credentials=e.credentials,this._config.hlsStreamingMux=e.hlsStreamingMux,this._fragLoadConfig={timeout:0,maxRetry:3,retryDelay:200,maxRetryDelay:6e3,credentials:e.credentials}}},{key:"currentLevel",get:function(){return!!this._levels&&this._levels[this._currentLevelIndex]}}]),t}();t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=l(r(2)),n=l(r(1)),s=r(3),o=r(0),u=l(r(46));function l(e){return e&&e.__esModule?e:{default:e}}var f={MANIFEST:"manifest",LEVEL:"level"},d={MAIN:"main"},c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.tag="PlaylistLoader",r._config=e,r.loaders={},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"createInternalLoader",value:function(e){var t=this._config.pLoader,r=this._config.loader,i=new(t||r)(this._config);return e.loader=i,this.loaders[e.type]=i,i}},{key:"getInternalLoader",value:function(e){return this.loaders[e.type]}},{key:"resetInternalLoader",value:function(e){this.loaders[e]&&delete this.loaders[e]}},{key:"destroyInternalLoaders",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}},{key:"destroy",value:function(){this.destroyInternalLoaders()}},{key:"loadManifest",value:function(e){this.load(e.url,{type:f.MANIFEST,level:0,id:null})}},{key:"loadLevel",value:function(e){this.load(e.url,{type:f.LEVEL,level:e.level,id:e.id})}},{key:"load",value:function(e,t){o.Log.d(this.tag,"Loading playlist of type "+t.type+", level: "+t.level+", id: "+t.id);var r=this.getInternalLoader(t);if(r){var i=r.context;if(i&&i.url===e)return o.Log.i(this.tag,"playlist request ongoing"),!1;o.Log.w(this.tag,"aborting previous loader for type: "+t.type),r.abort()}var a=void 0,n=void 0,s=void 0,u=void 0;switch(t.type){case f.MANIFEST:a=this._config.manifestLoadingMaxRetry,n=this._config.manifestLoadingTimeOut,s=this._config.manifestLoadingRetryDelay,u=this._config.manifestLoadingMaxRetryTimeout;break;default:a=this._config.levelLoadingMaxRetry,n=this._config.levelLoadingTimeOut,s=this._config.levelLoadingRetryDelay,u=this._config.levelLoadingMaxRetryTimeout}r=this.createInternalLoader(t),t.src=e,t.responseType=t.responseType||"text";var l={timeout:n,maxRetry:a,retryDelay:s,maxRetryDelay:u,credentials:this._config.credentials},d={onEnd:this.loadsuccess.bind(this),onError:this.loaderror.bind(this)};return o.Log.d(this.tag,"Calling internal loader delegate for URL: "+e),r.open(t,d,l),!0}},{key:"loadsuccess",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.resetInternalLoader(e.type);var a=t;0===a.indexOf("#EXTM3U")?a.indexOf("#EXTINF:")>0||a.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,r,i):this._handleMasterPlaylist(e,t,r,i):this._handleManifestParsingError(t,e,"no EXTM3U delimiter",i)}},{key:"loaderror",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._handleNetworkError(e,t)}},{key:"_handleMasterPlaylist",value:function(e,t,r,i){var a=t,s=e.responseUrl,l=u.default.parseMasterPlaylist(a,s);if(l.length){var f=l.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),d=u.default.parseMasterPlaylistMedia(a,s,"AUDIO",f);if(d.length){var c=!1;d.forEach(function(e){e.url||(c=!0)}),!1===c&&l[0].audioCodec&&!l[0].attrs.AUDIO&&(o.Log.v(this.tag,"audio codec signaled in quality level, but no embedded audio track signaled, create one"),d.unshift({type:"main",name:"main"}))}this.emit(n.default.HLS_MANIFEST_LOADED,{levels:l,audioTracks:d,url:s,stats:r,networkDetails:i})}else this._handleManifestParsingError(t,e,"no level found in manifest",i)}},{key:"_handleTrackOrLevelPlaylist",value:function(e,r,i,a){var s=e.id,o=e.level,l=e.type,d=e.responseUrl,c=isNaN(s)?0:s,h=isNaN(o)?c:o,_=t.mapContextToLevelType(e),p=u.default.parseLevelPlaylist(r,d,h,_,c);if(l===f.MANIFEST){var v={url:d,details:p};this.emit(n.default.HLS_MANIFEST_LOADED,{levels:[v],singleLevel:!0,url:d,stats:i,networkDetails:a})}e.levelDetails=p,this._handlePlaylistLoaded(e,r,i,a)}},{key:"_handleManifestParsingError",value:function(e,t,r,i){this.emit(n.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.HLS_MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:r,statusCode:i.code})}},{key:"_handleNetworkError",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];o.Log.i(this.tag,"A network error occured while loading a "+e.type+"-type playlist");var i=void 0,a=void 0,u=this.getInternalLoader(e);switch(e.type){case f.MANIFEST:i=r?s.ErrorDetails.HLS_MANIFEST_LOAD_TIMEOUT:s.ErrorDetails.HLS_MANIFEST_LOAD_ERROR,a=!0;break;case f.LEVEL:i=r?s.ErrorDetails.HLS_LEVEL_LOAD_TIMEOUT:s.ErrorDetails.HLS_LEVEL_LOAD_ERROR,a=!1;break;default:a=!1}u&&(u.abort(),this.resetInternalLoader(e.type)),this.emit(n.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:i,fatal:a,url:e.src,reason:t.text,statusCode:t.code})}},{key:"_handlePlaylistLoaded",value:function(e,r,i,a){e.type;var s=e.level,o=e.id,u=e.levelDetails;u.targetduration?t.canHaveQualityLevels(e.type)&&this.emit(n.default.LEVEL_LOADED,{details:u,level:s||0,id:o||0,stats:i,networkDetails:a}):this._handleManifestParsingError(r,e,"invalid target duration",a)}}],[{key:"canHaveQualityLevels",value:function(e){return!0}},{key:"mapContextToLevelType",value:function(e){switch(e.type){case f.AUDIO_TRACK:return d.AUDIO;default:return d.MAIN}}},{key:"ContextType",get:function(){return f}},{key:"LevelType",get:function(){return d}}]),t}();t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=f(r(5)),n=f(r(47)),s=f(r(22)),o=f(r(48)),u=r(0),l=r(49);function f(e){return e&&e.__esModule?e:{default:e}}var d=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,c=/#EXT-X-MEDIA:(.*)/g,h=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),_=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,p=/\.(mp4|m4s|m4v|m4a)$/i,v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,null,[{key:"findGroup",value:function(e,t){if(!e)return null;for(var r=null,i=0;i<e.length;i++){var a=e[i];a.id===t&&(r=a)}return r}},{key:"convertAVC1ToAVCOTI",value:function(e){var t=void 0,r=e.split(".");return r.length>2?(t=r.shift()+".",t+=parseInt(r.shift(),10).toString(16),t+=("000"+parseInt(r.shift(),10).toString(16)).substr(-4)):t=e,t}},{key:"resolve",value:function(e,t){return a.default.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}},{key:"parseMasterPlaylist",value:function(t,r){var i=[],a=void 0;function n(e,t){["video","audio"].forEach(function(r){var i=e.filter(function(e){return(0,l.isCodecType)(e,r)});if(i.length){var a=i.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)});t[r+"Codec"]=a.length>0?a[0]:i[0],e=e.filter(function(e){return-1===i.indexOf(e)})}}),t.unknownCodecs=e}for(d.lastIndex=0;null!==(a=d.exec(t));){var s={},u=s.attrs=new o.default(a[1]);s.url=e.resolve(a[2],r);var f=u.decimalResolution("RESOLUTION");f&&(s.width=f.width,s.height=f.height),s.bitrate=u.decimalInteger("AVERAGE-BANDWIDTH")||u.decimalInteger("BANDWIDTH"),s.name=u.NAME,n([].concat((u.CODECS||"").split(/[ ,]+/)),s),s.videoCodec&&-1!==s.videoCodec.indexOf("avc1")&&(s.videoCodec=e.convertAVC1ToAVCOTI(s.videoCodec)),i.push(s)}return i}},{key:"parseMasterPlaylistMedia",value:function(t,r,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=void 0,s=[],u=0;for(c.lastIndex=0;null!==(n=c.exec(t));){var l={},f=new o.default(n[1]);if(f.TYPE===i){if(l.groupId=f["GROUP-ID"],l.name=f.NAME,l.type=i,l.default="YES"===f.DEFAULT,l.autoselect="YES"===f.AUTOSELECT,l.forced="YES"===f.FORCED,f.URI&&(l.url=e.resolve(f.URI,r)),l.lang=f.LANGUAGE,l.name||(l.name=l.lang),a.length){var d=e.findGroup(a,l.groupId);l.audioCodec=d?d.codec:a[0].codec}l.id=u++,s.push(l)}}return s}},{key:"parseLevelPlaylist",value:function(e,t,r,i,a){var l=0,f=0,d=new s.default,c=0,v=null,m=new n.default,y=void 0,g=void 0,b={type:null,version:null,url:t,fragments:[],live:!0,startSN:0};for(h.lastIndex=0;null!==(y=h.exec(e));){var E=y[1];if(E){m.duration=parseFloat(E);var R=(" "+y[2]).slice(1);m.title=R||null,m.tagList.push(R?["INF",E,R]:["INF",E])}else if(y[3]){if(!isNaN(m.duration)){var S=l++;m.type=i,m.start=f,m.levelkey=d,m.sn=S,m.level=r,m.cc=c,m.urlId=a,m.baseurl=t,m.relurl=(" "+y[3]).slice(1),b.programDateTime&&(v?m.rawProgramDateTime?m.pdt=Date.parse(m.rawProgramDateTime):m.pdt=v.pdt+1e3*v.duration:m.pdt=Date.parse(b.programDateTime),m.endPdt=m.pdt+1e3*m.duration),b.fragments.push(m),v=m,f+=m.duration,m=new n.default}}else if(y[4]){if(m.rawByteRange=(" "+y[4]).slice(1),v){var k=v.byteRangeEndOffset;k&&(m.lastByteRangeEndOffset=k)}}else if(y[5])m.rawProgramDateTime=(" "+y[5]).slice(1),m.tagList.push(["PROGRAM-DATE-TIME",m.rawProgramDateTime]),void 0===b.programDateTime&&(b.programDateTime=new Date(new Date(Date.parse(y[5]))-1e3*f));else{for(y=y[0].match(_),g=1;g<y.length&&void 0===y[g];g++);var T=(" "+y[g+1]).slice(1),L=(" "+y[g+2]).slice(1);switch(y[g]){case"#":m.tagList.push(L?[T,L]:[T]);break;case"PLAYLIST-TYPE":b.type=T.toUpperCase();break;case"MEDIA-SEQUENCE":l=b.startSN=parseInt(T,10);break;case"TARGETDURATION":b.targetduration=parseFloat(T);break;case"VERSION":b.version=parseInt(T,10);break;case"EXTM3U":break;case"ENDLIST":b.live=!1;break;case"DIS":c++,m.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":c=parseInt(T,10);break;case"KEY":var w=T,O=new o.default(w),A=O.enumeratedString("METHOD"),D=O.URI,x=O.hexadecimalInteger("IV");A&&(d=new s.default,D&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(A)>=0&&(d.method=A,d.baseuri=t,d.reluri=D,d.key=null,d.iv=x));break;case"START":var I=T,P=new o.default(I).decimalFloatingPoint("TIME-OFFSET");isNaN(P)||(b.startTimeOffset=P);break;case"MAP":var M=new o.default(T);m.relurl=M.URI,m.rawByteRange=M.BYTERANGE,m.baseurl=t,m.level=r,m.type=i,m.sn="initSegment",b.initSegment=m,m=new n.default;break;default:u.Log.w("line parsed but not handled: "+y)}}}return(m=v)&&!m.relurl&&(b.fragments.pop(),f-=m.duration),b.totalduration=f,b.averagetargetduration=f/b.fragments.length,b.endSN=l-1,b.startCC=b.fragments[0]?b.fragments[0].cc:0,b.endCC=c,!b.initSegment&&b.fragments.length&&b.fragments.every(function(e){return p.test(e.relurl)})&&(logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(m=new n.default).relurl=b.fragments[0].relurl,m.baseurl=t,m.level=r,m.type=i,m.sn="initSegment",b.initSegment=m,b.needSidxRanges=!0),b}}]),e}();t.default=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=s(r(5)),n=s(r(22));function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var u=function(){function e(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this._elementaryStreams=(o(t={},e.ElementaryStreamTypes.AUDIO,!1),o(t,e.ElementaryStreamTypes.VIDEO,!1),t)}return i(e,[{key:"addElementaryStream",value:function(e){this._elementaryStreams[e]=!0}},{key:"hasElementaryStream",value:function(e){return!0===this._elementaryStreams[e]}},{key:"createInitializationVector",value:function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}},{key:"fragmentDecryptdataFromLevelkey",value:function(e,t){var r=e;return e&&e.method&&e.uri&&!e.iv&&((r=new n.default).method=e.method,r.baseuri=e.baseuri,r.reluri=e.reluri,r.iv=this.createInitializationVector(t)),r}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=a.default.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var e=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var r=this.lastByteRangeEndOffset;e[0]=r||0}else e[0]=parseInt(t[1],10);e[1]=parseInt(t[0],10)+e[0],this._byteRange=e}return e}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}],[{key:"ElementaryStreamTypes",get:function(){return{AUDIO:"audio",VIDEO:"video"}}}]),e}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=/^(\d+)x(\d+)$/,n=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,s=function(){function e(t){for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(r)&&(this[r]=t[r])}return i(e,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(e){var t=a.exec(this[e]);return null===t?null:{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){var t=void 0,r={};for(n.lastIndex=0;null!==(t=n.exec(e));){var i=t[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[t[1]]=i}return r}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};t.isCodecType=function(e,t){var r=i[t];return!!r&&!0===r[e.slice(0,4)]},t.isCodecSupportedInMp4=function(e,t){return window.MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(17)),n=f(r(1)),s=f(r(16)),o=f(r(15)),u=r(0),l=r(3);function f(e){return e&&e.__esModule?e:{default:e}}var d={video:1,audio:2,id3:3,text:4},c=function(){function e(t,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=i,this.typeSupported=a,this.remuxer=r,this.sampleAes=null,this.remuxStat=null,this.remuxContiguous=null}return i(e,[{key:"setDecryptData",value:function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method||(this.sampleAes=null)}},{key:"resetInitSegment",value:function(t,r,i,a){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",a),this._audioTrack=e.createTrack("audio",a),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=r,this.videoCodec=i,this._duration=a}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(t,r,i,a){this.contiguous=i,this.timeOffset=r,this.accurateTimeOffset=a,null===this.remuxStat&&(this.remuxStat={timeOffset:r,contiguous:i,accurateTimeOffset:a});var s=void 0,o=t.length,f=void 0,d=void 0,c=void 0,h=void 0,_=!1,p=this.remuxStat,v=this.pmtParsed,m=this._avcTrack,y=this._audioTrack,g=m.pid,b=y.pid,E=this._pmtId,R=m.pesData,S=y.pesData,k=this._parsePAT,T=this._parsePMT,L=this._parsePES,w=this._parseAVCPES.bind(this),O=this._parseAACPES.bind(this),A=e._syncOffset(t);for(o-=(o+A)%188,s=A;s<o;s+=188)if(71===t[s]){if(f=!!(64&t[s+1]),d=((31&t[s+1])<<8)+t[s+2],(48&t[s+3])>>4>1){if((c=s+5+t[s+4])===s+188)continue}else c=s+4;switch(!f||d!==g&&d!==b||R&&(h=L(R,!0))&&void 0!==h.pts&&(w(h,!0),R={data:[],size:0}),d){case g:f&&(R&&(h=L(R,!0))&&void 0!==h.pts&&w(h,!1),R={data:[],size:0}),R&&(R.data.push(t.subarray(c,s+188)),R.size+=s+188-c);break;case b:f&&(S&&(h=L(S))&&void 0!==h.pts&&(y.isAAC?O(h):parseMPEGPES(h)),S={data:[],size:0}),S&&(S.data.push(t.subarray(c,s+188)),S.size+=s+188-c);break;case 0:f&&(c+=t[c]+1),E=this._pmtId=k(t,c);break;case E:f&&(c+=t[c]+1);var D=T(t,c,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(g=D.avc)>0&&(m.pid=g),(b=D.audio)>0&&(y.pid=b,y.isAAC=D.isAAC),_&&!v&&(u.Log.v("reparse from beginning"),_=!1,s=A-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:_=!0}}else this.observer.trigger(n.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});R&&(h=L(R,!1))&&void 0!==h.pts?(w(h,!0),m.pesData=null):m.pesData=R,S&&(h=L(S))&&void 0!==h.pts?(y.isAAC?O(h):parseMPEGPES(h),y.pesData=null):(S&&S.size,y.pesData=S),b&&0===y.samples.length||g&&0===m.samples.length||(null==this.sampleAes?this.remuxer.remux(y,m,p.timeOffset,p.contiguous,p.accurateTimeOffset):this.decryptAndRemux(y,m,p.timeOffset,p.contiguous,p.accurateTimeOffset),this.remuxStat=null)}},{key:"flush",value:function(){var e=void 0,t=this._avcTrack,r=this._audioTrack,i=t.pesData,a=r.pesData,n=this._parsePES,s=this._parseAVCPES.bind(this),o=this._parseAACPES.bind(this);i&&(e=n(i,!1))&&void 0!==e.pts&&s(e,!0),t.pesData=null,a&&(e=n(a))&&void 0!==e.pts&&r.isAAC&&o(e),r.pesData=null,null==this.sampleAes?this.remuxer.remux(r,t,this.timeOffset,!0,this.accurateTimeOffset):this.decryptAndRemux(r,t,this.timeOffset,!0,this.accurateTimeOffset),this.remuxStat=null}},{key:"reset",value:function(){var e=this._avcTrack,t=this._audioTrack;e.pesData=null,e.samples=[],e.len=0,e.audFound=!1,e.nbSamples=0,e.nbNalu=0,t.pesData=null,t.samples=[],t.len=0,this.remuxStat=null}},{key:"decryptAndRemux",value:function(e,t,r,i,a,n){if(e.samples&&e.isAAC){var s=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){s.decryptAndRemuxAvc(e,t,r,i,a,n)})}else this.decryptAndRemuxAvc(e,t,r,i,a,n)}},{key:"decryptAndRemuxAvc",value:function(e,t,r,i,a,n){if(t.samples){var s=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){s.remuxer.remux(e,t,r,i,a,n)})}else this.remuxer.remux(e,t,r,i,a,n)}},{key:"destroy",value:function(){this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){return(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(e,t,r,i){var a,n=void 0,s={audio:-1,avc:-1,id3:-1,isAAC:!0};for(a=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<a;){switch(n=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!i){u.Log.v("unkown stream type:"+e[t]);break}case 15:-1===s.audio&&(s.audio=n);break;case 21:-1===s.id3&&(s.id3=n);break;case 219:if(!i){u.Log.v("unkown stream type:"+e[t]);break}case 27:-1===s.avc&&(s.avc=n);break;case 3:case 4:r?-1===s.audio&&(s.audio=n,s.isAAC=!1):u.Log.v("MPEG audio found, not supported in this browser for now");break;case 36:u.Log.w("HEVC stream type found, not supported for now");break;default:u.Log.v("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return s}},{key:"_parsePES",value:function(e,t){var r=0,i=void 0,a=void 0,n=void 0,s=void 0,o=void 0,l=void 0,f=void 0,d=void 0,c=e.data;if(!e||0===e.size)return null;for(;c[0].length<19&&c.length>1;){var h=new Uint8Array(c[0].length+c[1].length);h.set(c[0]),h.set(c[1],c[0].length),c[0]=h,c.splice(1,1)}if(1===((i=c[0])[0]<<16)+(i[1]<<8)+i[2]){if((n=(i[4]<<8)+i[5])&&n>e.size-6)return null;if(0===n&&!t)return null;192&(a=i[7])&&((l=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2)>4294967295&&(l-=8589934592),64&a?((f=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2)>4294967295&&(f-=8589934592),l-f>54e5&&(u.Log.w(Math.round((l-f)/9e4)+"s delta between PTS and DTS, align them"),l=f)):f=l),d=(s=i[8])+9,e.size-=d,o=new Uint8Array(e.size);for(var _=0,p=c.length;_<p;_++){var v=(i=c[_]).byteLength;if(d){if(d>v){d-=v;continue}i=i.subarray(d),v-=d,d=0}o.set(i,r),r+=v}return n&&(n-=s+3),{data:o,pts:l,dts:f,len:n}}return null}},{key:"pushAccesUnit",value:function(e,t){if(e.units.length&&e.frame){var r=t.samples,i=r.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(i||this.contiguous)?(e.id=i,r.push(e)):t.dropped++}e.debug.length&&u.Log.v(e.pts+"/"+e.dts+":"+e.debug)}},{key:"_parseAVCPES",value:function(e,t){var r=this,i=this._avcTrack,a=this._parseAVCNALu(e.data),n=void 0,u=this.avcSample,l=void 0,f=!1,d=void 0,c=this.pushAccesUnit.bind(this),h=function(e,t,r,i){return{key:e,pts:t,dts:r,units:[],debug:i}};e.data=null,u&&a.length&&!i.audFound&&(c(u,i),u=this.avcSample=h(!1,e.pts,e.dts,"")),a.forEach(function(t){switch(t.type){case 1:l=!0,u||(u=r.avcSample=h(!0,e.pts,e.dts,"")),u.frame=!0;var a=t.data;if(f&&a.length>4){var _=new s.default(a).readSliceType();2!==_&&4!==_&&7!==_&&9!==_||(u.key=!0)}break;case 5:l=!0,u||(u=r.avcSample=h(!0,e.pts,e.dts,"")),u.key=!0,u.frame=!0;break;case 6:l=!0,(n=new s.default(r.discardEPB(t.data))).readUByte();for(var p=0,v=0,m=!1,y=0;!m&&n.bytesAvailable>1;){p=0;do{p+=y=n.readUByte()}while(255===y);v=0;do{v+=y=n.readUByte()}while(255===y);if(4===p&&0!==n.bytesAvailable){if(m=!0,181===n.readUByte()&&49===n.readUShort()&&1195456820===n.readUInt()&&3===n.readUByte()){var g=n.readUByte(),b=31&g,E=[g,n.readUByte()];for(d=0;d<b;d++)E.push(n.readUByte()),E.push(n.readUByte()),E.push(n.readUByte())}}else if(v<n.bytesAvailable)for(d=0;d<v;d++)n.readUByte()}break;case 7:if(l=!0,f=!0,!i.sps){var R=o.default.parseSPS(t.data);i.width=R.codec_size.width,i.height=R.codec_size.height,i.pixelRatio=[R.sar_ratio.width,R.sar_ratio.height],i.sps=[t.data],i.duration=r._duration,i.fps=R.frame_rate.fps;var S=t.data.subarray(1,4),k="avc1.";for(d=0;d<3;d++){var T=S[d].toString(16);T.length<2&&(T="0"+T),k+=T}i.codec=k}break;case 8:l=!0,i.pps||(i.pps=[t.data]);break;case 9:l=!1,i.audFound=!0,u&&c(u,i),u=r.avcSample=h(!1,e.pts,e.dts,"");break;case 12:l=!1;break;default:l=!1,u&&(u.debug+="unknown NAL "+t.type+" ")}u&&l&&u.units.push(t)}),t&&u&&(c(u,i),this.avcSample=null)}},{key:"_insertSampleInOrder",value:function(e,t){var r=e.length;if(r>0){if(t.pts>=e[r-1].pts)e.push(t);else for(var i=r-1;i>=0;i--)if(t.pts<e[i].pts){e.splice(i,0,t);break}}else e.push(t)}},{key:"_getLastNalUnit",value:function(){var e=this.avcSample,t=void 0;if(!e||0===e.units.length){var r=this._avcTrack.samples;e=r[r.length-1]}if(e){var i=e.units;t=i[i.length-1]}return t}},{key:"_parseAVCNALu",value:function(e){var t=0,r=e.byteLength,i=void 0,a=void 0,n=this._avcTrack,s=n.naluState||0,o=s,u=[],l=void 0,f=-1,d=void 0;for(-1===s&&(f=0,d=31&e[0],s=0,t=1);t<r;)if(i=e[t++],s)if(1!==s)if(i)if(1===i){if(f>=0)l={data:e.subarray(f,t-s-1),type:d},u.push(l);else{var c=this._getLastNalUnit();if(c&&(o&&t<=4-o&&c.state&&(c.data=c.data.subarray(0,c.data.byteLength-o)),(a=t-s-1)>0)){var h=new Uint8Array(c.data.byteLength+a);h.set(c.data,0),h.set(e.subarray(0,a),c.data.byteLength),c.data=h}}t<r?(f=t,d=31&e[t],s=0):s=-1}else s=0;else s=3;else s=i?0:2;else s=i?0:1;if(f>=0&&s>=0&&(l={data:e.subarray(f,r),type:d,state:s},u.push(l)),0===u.length){var _=this._getLastNalUnit();if(_){var p=new Uint8Array(_.data.byteLength+e.byteLength);p.set(_.data,0),p.set(e,_.data.byteLength),_.data=p}}return n.naluState=s,u}},{key:"discardEPB",value:function(e){for(var t,r=e.byteLength,i=[],a=1,n=void 0;a<r-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(i.push(a+2),a+=2):a++;if(0===i.length)return e;t=r-i.length,n=new Uint8Array(t);var s=0;for(a=0;a<t;s++,a++)s===i[0]&&(s++,i.shift()),n[a]=e[s];return n}},{key:"_parseAACPES",value:function(e){var t,r,i=this._audioTrack,s=e.data,o=e.pts,f=this.aacOverFlow,d=this.aacLastPTS,c=void 0,h=void 0,_=void 0;if(f){var p=new Uint8Array(f.byteLength+s.byteLength);p.set(f,0),p.set(s,f.byteLength),s=p}for(h=0,r=s.length;h<r-1&&!a.isHeader(s,h);h++);if(h){var v=void 0,m=void 0;if(h<r-1?(v="AAC PES did not start with ADTS header,offset:"+h,m=!1):(v="no ADTS header found in AAC PES",m=!0),u.Log.w("parsing error:"+v),this.observer.trigger(n.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:m,reason:v}),m)return}if(a.initTrackConfig(i,this.observer,s,h,this.audioCodec),c=0,t=a.getFrameDuration(i.samplerate),f&&d){var y=d+t;Math.abs(y-o)>1&&(u.Log.v("AAC: align PTS for overlapping frames by "+Math.round((y-o)/90)),o=y)}for(;h<r;)if(a.isHeader(s,h)&&h+5<r){var g=a.appendFrame(i,s,h,o,c);if(!g)break;h+=g.length,_=g.sample.pts,c++}else h++;f=h<r?s.subarray(h,r):null,this.aacOverFlow=f,this.aacLastPTS=_}}],[{key:"probe",value:function(t){var r=e._syncOffset(t);return!(r<0||(r&&u.Log.w("MPEG2-TS detected but first sync word found @ offset "+r+", junk ahead ?"),0))}},{key:"_syncOffset",value:function(e){for(var t=Math.min(1e3,e.length-564),r=0;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1}},{key:"createTrack",value:function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:d[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}}}]),e}();t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=void 0,r=new i.default;r.trigger=function(e){for(var t,i=arguments.length,a=Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];(t=r).emit.apply(t,[e,e].concat(a))},r.off=function(e){for(var t,i=arguments.length,a=Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];(t=r).removeListener.apply(t,[e].concat(a))};var o=function(e,t){self.postMessage({event:e,data:t})};r.on(n.default.MANIFEST_PARSED,o),r.on(n.default.PARSING_INIT_SEGMENT,o),r.on(n.default.HLS_FRAG_PARSED,o),r.on(n.default.ERROR,o),r.on(n.default.LEVEL_UPDATED,o),r.on(n.default.LEVEL_SWITCHED,o),r.on(n.default.LEVEL_LOADED,o),r.on(n.default.REPORT,o),r.on(n.default.END,o),r.on(n.default.PARSING_DATA,function(e,t){var r=[],i={event:e,data:t};t.data1&&(i.data1=t.data1.buffer,r.push(t.data1.buffer),delete t.data1),t.data2&&(i.data2=t.data2.buffer,r.push(t.data2.buffer),delete t.data2),self.postMessage(i,r)}),e.addEventListener("message",function(e){switch(e.data.cmd){case"init":var i=e.data.config,n=e.data.typeSupported;s.Log.level(i.kwaiKernelLog),function(e,i){(t=new a.default(r,e,i)).init()}(i,n);break;case"loadSource":t.loadSource();break;case"pause":t.pause();break;case"seek":t.seek(e.data.data);break;case"resume":t.resume();break;case"destroy":t&&(t.destroy(),t=null),r&&(r.removeAllListeners(),r=null);break;case"selectBitrate":t.selectBitrate(e.data.data.bitrate,e.data.data.currentTime)}})};var i=o(r(2)),a=o(r(21)),n=o(r(1)),s=r(0);function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n={isLive:!1,box:"flv",alwaysSeekKeyframe:!1,lazyLoadMaxDuration:120,lazyLoadRecoverDuration:30,debug:!0,webWorker:!0,autoCleanupSourceBuffer:!0,autoCleanupMaxBackwardDuration:60,autoCleanupMinBackwardDuration:15,seekType:"range",bufferStrategyLimit:5e3,bufferStrategyFirst:1500,bufferStrategyIncrementStep:200,skipLostFrame:!0,appendErrorMaxRetry:3,credentials:!1,hlsStreamingMux:!0},s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return a(e,null,[{key:"processConfig",value:function(t){var r=Object.assign({},n);return Object.assign(r,t),r.skipLostFrame=!!r.isLive&&r.skipLostFrame,e.setSrc(r)}},{key:"setSrc",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r&&(t.src=r),"object"===i(t.src)?(t.adaptiveMultiRate=e._multiratePreProcessing(t),t.adaptiveMultiRate?t:(t.multipart=e._multipartDataPreProcessing(t),t.multipart?t:null)):t}},{key:"_multiratePreProcessing",value:function(e){var t=e.src;return!!(t&&t.hasOwnProperty("adaptationSet")&&t.adaptationSet.hasOwnProperty("representation")&&Array.isArray(t.adaptationSet.representation)&&t.adaptationSet.representation.length>0)&&(e.manifest=t,!0)}},{key:"_multipartDataPreProcessing",value:function(e){var t=e.src;if(!(t.segments&&Array.isArray(t.segments)&&t.segments.length>0))return!1;var r=0,i=0,a=-1;t.keyframesIndex={times:[],filepositions:[]},e.duration=e.src.duration||0;for(var n=0;n<t.segments.length;n++){if(!t.segments[n].hasOwnProperty("duration")||!t.segments[n].hasOwnProperty("filesize"))return!1;t.keyframesIndex.times.push(r),t.keyframesIndex.filepositions.push(i),t.segments[n].time=r,t.segments[n].fileposition=i,i+=t.segments[n].filesize,r+=t.segments[n].duration,-1===a&&r>e.startFrom&&(a=n,e.startFromKeyframePoint=t.segments[n].time)}return-1===a&&(e.startFrom=0,e.startFromKeyframePoint=0),!0}}]),e}();t.defaultConfig=n,t.ConfigHelper=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=o(r(2)),n=r(4),s=o(r(11));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a._version=e,a._video=r,a.reset(),a._data.manifest=i.src,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"reset",value:function(){this.loaderOpenTs=0,this.receiveFirstPackageTs=0,this.firstDemuxFlvTs=0,this.firstSegmentTs=0,this.firstPlay=0,this._data={version:this._version,records:[],manifest:{},buffered:0,loading:0,playing:0,totalLoaded:0,segmentLog:{video:[],audio:[]},videoDataRate:0,audioDataRate:0,decodedFPS:0,droppedFPS:0,decodedFrames:0,droppedFrames:0,refresh:this.refresh.bind(this)}}},{key:"record",value:function(e){e.ts=e.ts||Date.now(),this.firstPlay||this._processFirstPlayData(e),this._processPlayDataUsually(e)}},{key:"getLoadSpeed",value:function(){var e=this._data.records[this._data.records.length-1];if(e){var t=Date.now();e.speed=0;var r=!0,i=!1,a=void 0;try{for(var n,s=e.log[Symbol.iterator]();!(r=(n=s.next()).done);r=!0){var o=n.value;o.ts>t-1e3&&(e.speed+=o.byteLength)}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return e.speed}return 0}},{key:"setFPS",value:function(e){e&&(this._data.decodedFPS=e.decodedFPS,this._data.droppedFPS=e.droppedFPS,this._data.droppedFrames=e.droppedFrames,this._data.decodedFrames=e.decodedFrames)}},{key:"refresh",value:function(){for(var e=0;e<this._data.records.length;e++)"loading"!==this._data.records[e].statu&&"waiting"!==this._data.records[e].statu||this._video.currentTime>=this._data.records[e].sync/1e3&&(this._data.records[e].statu="playing",this._data.playing=e),"playing"===this._data.records[e].statu&&this._video.currentTime>=this._data.records[e].end/1e3&&(this._data.records[e].statu="stoped");this.getLoadSpeed(),this._video.buffered.length&&(this._data.buffered=Math.floor(1e3*(this._video.buffered.end(this._video.buffered.length-1)-this._video.currentTime)))}},{key:"_processFirstPlayData",value:function(e){switch(e.type){case n.REPORT_TYPES.LOADER_CHUNK_ARRIVAL:this.receiveFirstPackageTs||(this.receiveFirstPackageTs=e.ts,this._emitPerformance("receive-first-package-duration",this.receiveFirstPackageTs-this.loaderOpenTs));break;case n.REPORT_TYPES.MEDIA_DEMUX_FLV:this.firstDemuxFlvTs||(this.firstDemuxFlvTs=e.ts,this._emitPerformance("first-flv-package-duration",this.firstDemuxFlvTs-this.receiveFirstPackageTs));break;case n.REPORT_TYPES.MEDIA_SEGMENT:this.firstSegmentTs||(this.firstSegmentTs=e.ts,this._emitPerformance("first-flv-to-mp4",this.firstSegmentTs-this.firstDemuxFlvTs));break;case n.REPORT_TYPES.LOADER_OPEN:this.loaderOpenTs||(this.loaderOpenTs=e.ts,this._emitPerformance("first_loader_open_timestamp",this.loaderOpenTs));break;case n.REPORT_TYPES.PLAYING:case n.REPORT_TYPES.CANPLAY:case n.REPORT_TYPES.TIMEUPDATE:this.firstPlay||(this.firstPlay=e.ts,this._emitPerformance("first_video_frame_duration",this.firstPlay-this.firstSegmentTs))}}},{key:"_emitPerformance",value:function(e,t){this.emit("report",{type:"performance",value:{type:e,value:t}})}},{key:"_processPlayDataUsually",value:function(e){switch(e.type){case n.REPORT_TYPES.LOADER_CHUNK_ARRIVAL:this._loaderChunkArrival(e);break;case n.REPORT_TYPES.MP_SLICE_LOAD_STAT:this.emit("report",{type:"multipartDownloaded",value:{url:e.url,domain:new s.default(e.url).host,resource_type:e.resourceType,downloaded_size:e.downloaded,total_size:e.filesize,network_cost:e.cost,load_status:e.stat,error_code:e.errorCode}});break;case n.REPORT_TYPES.LIVE_ADAPTIVE_QOS_STAT:e.bitrate_playing=this.playingInfo?this.playingInfo.bitrate:0,e.bitrate_downloading=this.loadingInfo?this.loadingInfo.bitrate:0,this.emit("report",{type:"liveStreamAdaptiveQosStat",value:e});break;case n.REPORT_TYPES.NEW_SOURCE:this._newSource(e.index||0,0,e.sync,e.url);break;case n.REPORT_TYPES.MEDIA_INFO:Object.assign(this._data.records[this._data.records.length-1].mediaInfo,e.data);break;case n.REPORT_TYPES.MEDIA_SEGMENT:this._mediaSegment(e)}}},{key:"_mediaSegment",value:function(e){e.keyFrame&&this._data.records[this._data.records.length-1].key++;var t=this._data.segmentLog[e.segmentType];if(Array.isArray(t)){t.push({pts:e.pts,len:e.byteLength}),t.length>100&&t.shift();var r=t[t.length-1].pts-t[0].pts;if(r>0){for(var i=0,a=0;a<t.length-1;a++)i+=t[a].len;"video"===e.segmentType?this._data.videoDataRate=parseInt(8*i/r,10):"audio"===e.segmentType&&(this._data.audioDataRate=parseInt(8*i/r,10))}}}},{key:"_loaderChunkArrival",value:function(e){this._data.totalLoaded+=e.byteLength;var t=this._data.records[this._data.records.length-1];t.log.length>200&&t.log.pop(),t.log.unshift(e),t.len+=e.byteLength,t.connectionTime=Date.now()-t.startTs,t.avgSpeed=(t.len/t.connectionTime*1e3).toFixed(2)}},{key:"_newSource",value:function(e,t,r,i){if(this._data.records.length){var a=this._data.records[this._data.records.length-1];a.endTs=Date.now(),a.statu="waiting",a.end=r,a.url=i}var n=null;this._data.manifest&&this._data.manifest.hasOwnProperty("adaptationSet")&&(n=this._data.manifest.adaptationSet.representation[e]),this._data.records.length>10&&(this._data.playing--,this._data.loading--,this._data.records.shift()),this._data.records.push({statu:"loading",mediaInfo:{},key:0,log:[],speed:0,avgSpeed:0,len:0,i:e,bitrate:n?n.bitrate:null,id:n?n.id:0,time:t,sync:r,end:Number.MAX_SAFE_INTEGER,startTs:Date.now(),endTs:0,connectionTime:0,url:""}),this._data.loading=this._data.records.length-1}},{key:"playingInfo",get:function(){return this._data.records[this._data.playing]}},{key:"loadingInfo",get:function(){return this._data.records[this._data.loading]}},{key:"data",get:function(){return this._data}},{key:"dataJson",get:function(){return JSON.stringify(this._data)}}]),t}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=.9,n=1,s=1.1,o=1.2,u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._rules=[{playbackRate:o,lower:28,upper:Number.MAX_SAFE_INTEGER},{playbackRate:s,lower:16,upper:22},{playbackRate:n,lower:5,upper:10},{playbackRate:a,lower:Number.MIN_SAFE_INTEGER,upper:3}]}return i(e,[{key:"nextPlayBackRate",value:function(e,t){var r=n,i=0;for(i=0;i<this._rules.length&&!(t>=this._rules[i].playbackRate);i++);var a=i<this._rules.length-1?this._rules[i+1]:null,s=i>0?this._rules[i-1]:null;return r=this._rules[i].playbackRate,s&&e>s.lower&&(r=s.playbackRate),a&&e<a.upper&&(r=a.playbackRate),r}}]),e}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERRORNO={UNKNOW_ERROR:10,NET_ERROR:100,CODEC_ERROR:101,CANNOT_SEEK:102,ENDOFSTREAM_ERROR:103,MEDIASOURCE_ERROR:104,SOURCEBUFFER_ERROR:105,SBABORT_ERROR:106,APPENDBUFFER_ERROR:107,FORMAT_ERROR:108,CODEC_UNSUPPORTED:109,VIDEO_ELEMENT_PLAY_ERROR:110,CONFIG_DATA_ERROR:111}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(r(11)),n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._resetForNewSession(t),this._resetForNewInterval()}return i(e,[{key:"_resetForNewSession",value:function(e){this.currentPlaybackSpeed=1,this.lastDownloadedBytes=0,e&&(this.playUrl=e,this.domain=new a.default(e).host),this.playStartTimestampMillis=Date.now(),this.lastVideoBuffered={start:-1e9,end:-1e9},this.playbackSpeed=1}},{key:"_resetForNewInterval",value:function(){this.currentPlaybackSpeedTimestamp=Date.now(),this.playbackSpeedStat={},this.statTimestampMillis=Date.now(),this.bufferingCount=0,this.bufferingDurationMillis=0,this.bufferingStartTimestampMillis=this.bufferingStartTimestampMillis?Date.now():null,this.downloadedBytes=0,this.audioBufferedMillis=0,this.videoBufferedMillis=0,this.demuxedDurationSec=0,this.excessiveDataDroppedSec=0,this.blockCountWithBuffer=0,this.bufferDuringBlockSum=0,this.cdnDropFrameCount=0,this.cdnDropFrameDuration=0}},{key:"_recordSpeedStat",value:function(){if(1!==this.playbackSpeed){var e=Date.now()-this.currentPlaybackSpeedTimestamp,t=this.playbackSpeed+"x";this.playbackSpeedStat[t]?this.playbackSpeedStat[t]+=e:this.playbackSpeedStat[t]=e}}},{key:"videoBufferedUpdated",value:function(e){if(0!==e.length){var t=e.start(e.length-1),r=e.end(e.length-1);t>this.lastVideoBuffered.end+.001?(this.demuxedDurationSec+=r-t,this.lastVideoBuffered={start:t,end:r}):(this.demuxedDurationSec+=Math.max(0,r-this.lastVideoBuffered.end),this.lastVideoBuffered.end=r)}}},{key:"playbackSpeedChanged",value:function(e){e!==this.playbackSpeed&&(this._recordSpeedStat(),this.currentPlaybackSpeedTimestamp=Date.now(),this.playbackSpeed=e)}},{key:"bufferingStarted",value:function(e){++this.bufferingCount,this.bufferingStartTimestampMillis=Date.now(),e>600&&(this.bufferDuringBlockSum+=e,this.blockCountWithBuffer++)}},{key:"bufferingEnded",value:function(){var e=Date.now();null!=this.bufferingStartTimestampMillis&&(this.bufferingDurationMillis+=e-this.bufferingStartTimestampMillis),this.bufferingStartTimestampMillis=null}},{key:"updateDownloadedBytes",value:function(e){var t=e-this.lastDownloadedBytes;this.downloadedBytes+=t,this.lastDownloadedBytes=e}},{key:"setAudioBufferedSec",value:function(e){this.audioBufferedMillis=Math.round(1e3*e)}},{key:"setVideoBufferedSec",value:function(e){this.videoBufferedMillis=Math.round(1e3*e)}},{key:"excessiveDataDropped",value:function(e){this.excessiveDataDroppedSec+=e}},{key:"lostFrame",value:function(e){this.cdnDropFrameCount+=1,this.cdnDropFrameDuration+=e}},{key:"setPlayUrl",value:function(e){this.playUrl=e,this.domain=new a.default(e).host}},{key:"buildAndStartNewInterval",value:function(){this._recordSpeedStat();var e=Date.now(),t=null==this.bufferingStartTimestampMillis?0:e-this.bufferingStartTimestampMillis,r=(this.bufferingStartTimestampMillis,{play_url:this.playUrl,domain:this.domain,play_start_time:this.playStartTimestampMillis,tick_start:this.statTimestampMillis,tick_duration:e-this.statTimestampMillis,block_count:this.bufferingCount,buffer_time:this.bufferingDurationMillis+t,kbytes_received:this.downloadedBytes>>10,played_video_duration:e-this.statTimestampMillis-(this.bufferingDurationMillis+t),demuxed_video_duration:Math.round(1e3*this.demuxedDurationSec),dropped_packet_duration:Math.round(1e3*this.excessiveDataDroppedSec),a_buf_len:this.audioBufferedMillis,v_buf_len:this.videoBufferedMillis,speed_chg_metric:this.playbackSpeedStat,block_count_with_buffer:this.blockCountWithBuffer,buffer_during_block:this.blockCountWithBuffer>0?Math.round(this.bufferDuringBlockSum/this.blockCountWithBuffer):0,skip_cnt:this.cdnDropFrameCount,skip_duration:this.cdnDropFrameDuration});return this._resetForNewInterval(),r}}]),e}();t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(r(2)),n=window.performance,s=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.tag="fps",e.lastDroppedFrames=0,e.lastDecodedFrames=0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"attachMedia",value:function(e){"function"==typeof(this.video=e instanceof window.HTMLVideoElement?e:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0)}},{key:"checkFPS",value:function(e,t,r){var i=n.now(),a=null;if(t){if(this.lastTime){var s=i-this.lastTime,o=r-this.lastDroppedFrames,u=t-this.lastDecodedFrames,l=(1e3*o/s).toFixed(2),f=(1e3*u/s).toFixed(2);this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t,a={droppedFrames:r,decodedFrames:t,decodedFPS:f,droppedFPS:l},this.lastDroppedFrames=r,this.lastDecodedFrames=t}this.lastTime=i}return a}},{key:"checkFPSInterval",value:function(){var e=this.video;if(e){if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();return this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}return this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}return null}}]),t}();t.default=s}]).default},379:function(e,t,r){"use strict";r.r(t);var i,a,n=r(217),s=r.n(n),o=r(92),u=(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});!function(e){e.LEVEL_SWITCHED="levelSwitched",e.ERROR="error",e.MAINFEST_PARSED="manifestParsed"}(a||(a={}));var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),Object.defineProperty(t.prototype,"currentLevel",{get:function(){return this.findBitrateIndex(this._currentLevel)},set:function(e){this._currentLevel=this.findBitrateIndex(e),this._kernel.selectBitrate(e),this.onSwitching()},enumerable:!0,configurable:!0}),t.prototype.load=function(e,t){this._kernel=new s.a(this._media,{src:e,credentials:!1,bitrateStart:0,webWorker:!0,box:"hls",isLive:!1,alwaysSeekKeyframe:!0,autoCleanupMaxBackwardDuration:90}),this.addListeners(),this._kernel.load()},t.prototype.attachMedia=function(e){this._media=e},t.prototype.destroy=function(){this._kernel.destroy()},t.prototype.findBitrateIndex=function(e){return this._levels.findIndex(function(t){return e===t})},t.prototype.addListeners=function(){var e=this;this._kernel.on(a.LEVEL_SWITCHED,function(t){e.onSwitched()}),this._kernel.on(a.ERROR,function(t){e._observer.emit(o.c.KERNEL_ERROR,t)}),this._kernel.on(a.MAINFEST_PARSED,function(t){e.setupBitrate(),e._inited=!0})},t.prototype.setupBitrate=function(){this._levels=this._kernel.getBitrates(),e.prototype.setupBitrate.call(this)},t}(o.d);t.default=l}}]);